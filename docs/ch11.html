<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kevin Markham">
<meta name="description" content="A practical guide to help you transition from Machine Learning beginner to skilled Machine Learning practitioner.">

<title>11&nbsp; Comparing linear and non-linear models – Master Machine Learning with scikit-learn</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ch12.html" rel="next">
<link href="./ch10.html" rel="prev">
<link href="./favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-211a06f58281a873233d4d02949b23e7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://cdn.usefathom.com/script.js" data-site="AWKMQOCB" defer=""></script>


<meta property="og:title" content="11&nbsp; Comparing linear and non-linear models – Master Machine Learning with scikit-learn">
<meta property="og:description" content="">
<meta property="og:image" content="https://mlbook.dataschool.io/logo.png">
<meta property="og:site_name" content="Master Machine Learning with scikit-learn">
<meta property="og:image:height" content="141">
<meta property="og:image:width" content="266">
<meta name="twitter:title" content="11&nbsp; Comparing linear and non-linear models – Master Machine Learning with scikit-learn">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://mlbook.dataschool.io/logo.png">
<meta name="twitter:image-height" content="141">
<meta name="twitter:image-width" content="266">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ch11.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing linear and non-linear models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Master Machine Learning with scikit-learn</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Review of the Machine Learning workflow</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Encoding categorical features</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Improving your workflow with ColumnTransformer and Pipeline</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Workflow review #1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Encoding text data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Handling missing values</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Fixing common workflow problems</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Workflow review #2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Evaluating and tuning a Pipeline</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch11.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing linear and non-linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Ensembling multiple models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Feature selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Feature standardization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Feature engineering with custom transformers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Workflow review #3</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">High-cardinality categorical features</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch18.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Class imbalance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch19.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Class imbalance walkthrough</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch20.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Going further</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#trying-a-random-forest-model" id="toc-trying-a-random-forest-model" class="nav-link active" data-scroll-target="#trying-a-random-forest-model"><span class="header-section-number">11.1</span> Trying a random forest model</a></li>
  <li><a href="#tuning-random-forests-with-randomized-search" id="toc-tuning-random-forests-with-randomized-search" class="nav-link" data-scroll-target="#tuning-random-forests-with-randomized-search"><span class="header-section-number">11.2</span> Tuning random forests with randomized search</a></li>
  <li><a href="#further-tuning-with-grid-search" id="toc-further-tuning-with-grid-search" class="nav-link" data-scroll-target="#further-tuning-with-grid-search"><span class="header-section-number">11.3</span> Further tuning with grid search</a></li>
  <li><a href="#qa-how-do-i-tune-two-models-with-a-single-grid-search" id="toc-qa-how-do-i-tune-two-models-with-a-single-grid-search" class="nav-link" data-scroll-target="#qa-how-do-i-tune-two-models-with-a-single-grid-search"><span class="header-section-number">11.4</span> Q&amp;A: How do I tune two models with a single grid search?</a></li>
  <li><a href="#qa-how-do-i-tune-two-models-with-a-single-randomized-search" id="toc-qa-how-do-i-tune-two-models-with-a-single-randomized-search" class="nav-link" data-scroll-target="#qa-how-do-i-tune-two-models-with-a-single-randomized-search"><span class="header-section-number">11.5</span> Q&amp;A: How do I tune two models with a single randomized search?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing linear and non-linear models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="trying-a-random-forest-model" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="trying-a-random-forest-model"><span class="header-section-number">11.1</span> Trying a random forest model</h2>
<p>So far, the only model we’ve used in this book is logistic regression. But what if you wanted to try a different model?</p>
<p>One great thing about the scikit-learn API is that once you’ve built a workflow, you can easily swap in a different model, usually without making any other changes to your workflow. This is a huge benefit of scikit-learn, since it’s not possible to know ahead of time which model is going to work best for a given problem and dataset. This is also known as the “no free lunch” theorem.</p>
<p>In this chapter, we’re going to try out the random forest model, which is one of the most well-known models in Machine Learning. Whereas logistic regression is a linear model, random forests is a non-linear model based on decision trees. These two types of models have different overall properties, thus it may turn out that one type is better suited to this particular problem.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Random forest model:</strong></p>
<ul>
<li>Non-linear model</li>
<li>Based on decision trees</li>
<li>Different properties from logistic regression</li>
</ul>
</div>
</div>
</div>
<p>We start out by importing the RandomForestClassifier class from the ensemble module, and creating an instance called rf. Because there’s randomness involved in a random forest, we’ll set a random state for reproducibility. And because building a random forest can be computationally expensive, it has its own n_jobs parameter (just like grid search and randomized search), which we’ll set to -1 to enable parallel processing.</p>
<div id="da09f69e" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">1</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll create a new Pipeline object called rf_pipe that uses random forests instead of logistic regression.</p>
<div id="e22c9b10" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>rf_pipe <span class="op">=</span> make_pipeline(ct, rf)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>rf_pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d8f085ea-c2d0-4f5d-8ed4-2e24d0d92dc5" type="checkbox"><label class="sk-toggleable__label" for="d8f085ea-c2d0-4f5d-8ed4-2e24d0d92dc5">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('simpleimputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehotencoder',
                                                                   OneHotEncoder())]),
                                                  ['Embarked', 'Sex']),
                                                 ('countvectorizer',
                                                  CountVectorizer(), 'Name'),
                                                 ('simpleimputer',
                                                  SimpleImputer(),
                                                  ['Age', 'Fare']),
                                                 ('passthrough', 'passthrough',
                                                  ['Parch'])])),
                ('randomforestclassifier',
                 RandomForestClassifier(n_jobs=-1, random_state=1))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d7f70f0e-b49e-486e-bae4-18f255971f52" type="checkbox"><label class="sk-toggleable__label" for="d7f70f0e-b49e-486e-bae4-18f255971f52">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6a757cf8-5c95-4708-9bf6-c0ff905e725e" type="checkbox"><label class="sk-toggleable__label" for="6a757cf8-5c95-4708-9bf6-c0ff905e725e">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fde37858-332f-4a76-96cb-4afcd8f18661" type="checkbox"><label class="sk-toggleable__label" for="fde37858-332f-4a76-96cb-4afcd8f18661">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="22b72aba-3267-4853-b91b-0e55b735a8c2" type="checkbox"><label class="sk-toggleable__label" for="22b72aba-3267-4853-b91b-0e55b735a8c2">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8b8e3cf5-15cf-4166-9808-9a3a90885d4c" type="checkbox"><label class="sk-toggleable__label" for="8b8e3cf5-15cf-4166-9808-9a3a90885d4c">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1f414591-5b00-40fe-9961-68288604158d" type="checkbox"><label class="sk-toggleable__label" for="1f414591-5b00-40fe-9961-68288604158d">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d5e3bf24-3984-4713-a4b1-fedaaa34777a" type="checkbox"><label class="sk-toggleable__label" for="d5e3bf24-3984-4713-a4b1-fedaaa34777a">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8418607a-6337-433c-90b1-91f5caaf13f0" type="checkbox"><label class="sk-toggleable__label" for="8418607a-6337-433c-90b1-91f5caaf13f0">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a27dce8b-91c2-49ed-883e-db066bee7956" type="checkbox"><label class="sk-toggleable__label" for="a27dce8b-91c2-49ed-883e-db066bee7956">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5042786b-33a5-466b-8f77-94eb0447b8c4" type="checkbox"><label class="sk-toggleable__label" for="5042786b-33a5-466b-8f77-94eb0447b8c4">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0102ce72-f976-4b16-b226-4b2be3ec3a9a" type="checkbox"><label class="sk-toggleable__label" for="0102ce72-f976-4b16-b226-4b2be3ec3a9a">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(n_jobs=-1, random_state=1)</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>And we can cross-validate it to generate a baseline accuracy, which is 0.811. This accuracy is nearly identical to the baseline accuracy of our logistic regression Pipeline, but it’s likely that we can improve it through hyperparameter tuning.</p>
<div id="4a9dd60e" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>cross_val_score(rf_pipe, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>0.811436821291821</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (LR):</strong> 0.828</li>
<li><strong>Baseline (LR):</strong> 0.811</li>
<li><strong>Baseline (RF):</strong> <mark>0.811</mark></li>
</ul>
</div>
</div>
</div>
<p>As an aside, I’ve simplified the Pipeline accuracy scores table to only include the most important scores from the previous chapter. As you might guess, “LR” stands for logistic regression and “RF” stands for random forests. And going forward, I’ll always use the term “baseline” in this table to describe a Pipeline that has not undergone any hyperparameter tuning via grid search or randomized search.</p>
</section>
<section id="tuning-random-forests-with-randomized-search" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="tuning-random-forests-with-randomized-search"><span class="header-section-number">11.2</span> Tuning random forests with randomized search</h2>
<p>When tuning random forests, we’ll try tuning the same parameters for the transformers as before, but different parameters for the model. It’s still important to tune the transformations and the model at the same time, because it may turn out that the best data transformations for a random forest model are different than the best data transformations for a logistic regression model.</p>
<p>Rather than typing a parameters dictionary from scratch, we can start by creating a copy of the params dictionary called rf_params.</p>
<div id="d420653d" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>rf_params <span class="op">=</span> params.copy()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>rf_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>{'logisticregression__penalty': ['l1', 'l2'],
 'logisticregression__C': [0.1, 1, 10],
 'columntransformer__pipeline__onehotencoder__drop': [None, 'first'],
 'columntransformer__countvectorizer__ngram_range': [(1, 1), (1, 2)],
 'columntransformer__simpleimputer__add_indicator': [False, True]}</code></pre>
</div>
</div>
<p>Then, we’ll delete the entries from the rf_params dictionary that only apply to logistic regression.</p>
<div id="182a8569" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> rf_params[<span class="st">'logisticregression__penalty'</span>]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> rf_params[<span class="st">'logisticregression__C'</span>]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>rf_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>{'columntransformer__pipeline__onehotencoder__drop': [None, 'first'],
 'columntransformer__countvectorizer__ngram_range': [(1, 1), (1, 2)],
 'columntransformer__simpleimputer__add_indicator': [False, True]}</code></pre>
</div>
</div>
<p>Alternatively, we could have created the rf_params dictionary using a dictionary comprehension that only keeps the entries in params that start with the letters ‘col’.</p>
<div id="0cc79f6a" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>rf_params <span class="op">=</span> {k:v <span class="cf">for</span> k, v <span class="kw">in</span> params.items() <span class="cf">if</span> k.startswith(<span class="st">'col'</span>)}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>rf_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>{'columntransformer__pipeline__onehotencoder__drop': [None, 'first'],
 'columntransformer__countvectorizer__ngram_range': [(1, 1), (1, 2)],
 'columntransformer__simpleimputer__add_indicator': [False, True]}</code></pre>
</div>
</div>
<p>Now we’re ready to add tuning parameters for the RandomForestClassifier. Random forests has a lot of parameters you can tune, which can make for a computationally expensive grid search if you try to tune all of them. This is compounded by the fact that random forests is comparatively slower to train than logistic regression.</p>
<p>When you’re not quite sure which parameters to tune or which values to try for those parameters, I would suggest a two-step approach, which is what we’ll use in this chapter:</p>
<ol type="1">
<li>First, use a randomized search with a variety of parameters and values. This allows you to test out a lot of different combinations while still controlling the computational budget. Examine the results of the search to look for trends of what’s working and what’s not.</li>
<li>Second, use a grid search with a more optimized set of parameters and values, based on what you learned from the randomized search.</li>
</ol>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Two-step approach to hyperparameter tuning:</strong></p>
<ol type="1">
<li><strong>Randomized search:</strong> Test a variety of parameters and values, then examine the results for trends</li>
<li><strong>Grid search:</strong> Use an optimized set of parameters and values based on what you learned from step 1</li>
</ol>
</div>
</div>
</div>
<p>We’ll start by trying out four parameters from the RandomForestClassifier, which I selected based on research and experience.</p>
<p>First, we’ll confirm that the Pipeline step name is randomforestclassifier (all lowercase).</p>
<div id="15ece929" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>rf_pipe.named_steps.keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>dict_keys(['columntransformer', 'randomforestclassifier'])</code></pre>
</div>
</div>
<p>Then we’ll add the four parameters I selected and some reasonable values for those parameters to the rf_params dictionary:</p>
<ul>
<li>n_estimators is the number of decision trees in the random forest.</li>
<li>min_samples_leaf is a way to control overfitting, just like regularization is used to control overfitting in a logistic regression model.</li>
<li>And max_features and bootstrap affect certain properties of the random forest algorithm.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>RandomForestClassifier tuning parameters:</strong></p>
<ul>
<li><strong>n_estimators:</strong> Number of decisions trees in the forest
<ul>
<li>100 (default)</li>
<li>300</li>
<li>500</li>
<li>700</li>
</ul></li>
<li><strong>min_samples_leaf:</strong> Minimum number of samples at a leaf node
<ul>
<li>1 (default)</li>
<li>2</li>
<li>3</li>
</ul></li>
<li><strong>max_features:</strong> Number of features to consider when choosing a split
<ul>
<li>‘sqrt’ (default)</li>
<li>None</li>
</ul></li>
<li><strong>bootstrap:</strong> Whether bootstrap samples are used when building trees
<ul>
<li>True (default)</li>
<li>False</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="4e0a0238" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>rf_params[<span class="st">'randomforestclassifier__n_estimators'</span>] <span class="op">=</span> [<span class="dv">100</span>, <span class="dv">300</span>, <span class="dv">500</span>, <span class="dv">700</span>]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>rf_params[<span class="st">'randomforestclassifier__min_samples_leaf'</span>] <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>rf_params[<span class="st">'randomforestclassifier__max_features'</span>] <span class="op">=</span> [<span class="st">'sqrt'</span>, <span class="va">None</span>]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>rf_params[<span class="st">'randomforestclassifier__bootstrap'</span>] <span class="op">=</span> [<span class="va">True</span>, <span class="va">False</span>]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>rf_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>{'columntransformer__pipeline__onehotencoder__drop': [None, 'first'],
 'columntransformer__countvectorizer__ngram_range': [(1, 1), (1, 2)],
 'columntransformer__simpleimputer__add_indicator': [False, True],
 'randomforestclassifier__n_estimators': [100, 300, 500, 700],
 'randomforestclassifier__min_samples_leaf': [1, 2, 3],
 'randomforestclassifier__max_features': ['sqrt', None],
 'randomforestclassifier__bootstrap': [True, False]}</code></pre>
</div>
</div>
<p>Finally, we’ll create an instance of RandomizedSearchCV called rf_rand, making sure to use the rf_pipe and rf_params objects, and we’ll run 100 iterations of the randomized search.</p>
<p>Notice that I’ve added a warning to this cell to indicate that it takes a few minutes to run on my local machine, though it may run faster or slower on your machine.</p>
<div id="db81f1b7" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">: EXTENDED RUNTIME</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>rf_rand <span class="op">=</span> RandomizedSearchCV(rf_pipe, rf_params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                             n_iter<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">1</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time rf_rand.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 2.96 s, sys: 356 ms, total: 3.32 s
Wall time: 1min 37s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bc6c83b2-6dc9-4af3-af7b-68a3eb803850" type="checkbox"><label class="sk-toggleable__label" for="bc6c83b2-6dc9-4af3-af7b-68a3eb803850">RandomizedSearchCV</label><div class="sk-toggleable__content"><pre>RandomizedSearchCV(cv=5,
                   estimator=Pipeline(steps=[('columntransformer',
                                              ColumnTransformer(transformers=[('pipeline',
                                                                               Pipeline(steps=[('simpleimputer',
                                                                                                SimpleImputer(fill_value='missing',
                                                                                                              strategy='constant')),
                                                                                               ('onehotencoder',
                                                                                                OneHotEncoder())]),
                                                                               ['Embarked',
                                                                                'Sex']),
                                                                              ('countvectorizer',
                                                                               CountVectorizer(),
                                                                               'Name'),
                                                                              ('simpleimputer',
                                                                               SimpleImputer(),
                                                                               ['Age',
                                                                                'Far...
                                        'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                                             'first'],
                                        'columntransformer__simpleimputer__add_indicator': [False,
                                                                                            True],
                                        'randomforestclassifier__bootstrap': [True,
                                                                              False],
                                        'randomforestclassifier__max_features': ['sqrt',
                                                                                 None],
                                        'randomforestclassifier__min_samples_leaf': [1,
                                                                                     2,
                                                                                     3],
                                        'randomforestclassifier__n_estimators': [100,
                                                                                 300,
                                                                                 500,
                                                                                 700]},
                   random_state=1, scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b298140d-b19f-4a66-a273-826d38ded2b6" type="checkbox"><label class="sk-toggleable__label" for="b298140d-b19f-4a66-a273-826d38ded2b6">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7a1ed5c8-9581-4b08-89a2-b4af8d18fa9b" type="checkbox"><label class="sk-toggleable__label" for="7a1ed5c8-9581-4b08-89a2-b4af8d18fa9b">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7f7d1561-4a87-49d1-bb45-0bc474411d6d" type="checkbox"><label class="sk-toggleable__label" for="7f7d1561-4a87-49d1-bb45-0bc474411d6d">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5aaced05-fd7a-40e0-9d9f-bae9be3ffc49" type="checkbox"><label class="sk-toggleable__label" for="5aaced05-fd7a-40e0-9d9f-bae9be3ffc49">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b712c92e-6c27-45b1-a980-bb9b84bab443" type="checkbox"><label class="sk-toggleable__label" for="b712c92e-6c27-45b1-a980-bb9b84bab443">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="63c68171-0f15-46ac-8531-43b46f6e4a1b" type="checkbox"><label class="sk-toggleable__label" for="63c68171-0f15-46ac-8531-43b46f6e4a1b">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0d026d36-2083-4265-8871-0a34627488dd" type="checkbox"><label class="sk-toggleable__label" for="0d026d36-2083-4265-8871-0a34627488dd">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="182ff091-77a7-4cea-ba43-78d8a84be9eb" type="checkbox"><label class="sk-toggleable__label" for="182ff091-77a7-4cea-ba43-78d8a84be9eb">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b6c2ee9f-e466-41f9-a16a-52f93b6992a3" type="checkbox"><label class="sk-toggleable__label" for="b6c2ee9f-e466-41f9-a16a-52f93b6992a3">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f37f244a-d456-41b6-9387-6e39564f8dc2" type="checkbox"><label class="sk-toggleable__label" for="f37f244a-d456-41b6-9387-6e39564f8dc2">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="51356e88-bde5-43e8-bcae-7f5fe9c1a69f" type="checkbox"><label class="sk-toggleable__label" for="51356e88-bde5-43e8-bcae-7f5fe9c1a69f">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(n_jobs=-1, random_state=1)</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>We see that the best score found during the randomized search is 0.825, which is better than our baseline score of 0.811, but not quite as good as the 0.828 score of our best logistic regression Pipeline.</p>
<div id="5d51abd5" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rf_rand.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>0.8249262444291003</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (LR):</strong> 0.828</li>
<li><strong>Randomized search (RF):</strong> <mark>0.825</mark></li>
<li><strong>Baseline (LR):</strong> 0.811</li>
<li><strong>Baseline (RF):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
</section>
<section id="further-tuning-with-grid-search" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="further-tuning-with-grid-search"><span class="header-section-number">11.3</span> Further tuning with grid search</h2>
<p>Let’s now examine the results from the randomized search to look for trends, specifically focusing on the top 20 results. We’ll convert the results to a DataFrame, filter to only keep the columns we need, rename the parameter columns, and then sort by rank_test_score. Keep in mind that it’s hard to draw any definitive conclusions since this is a randomized search, so what we’re looking for is just any obvious trends.</p>
<div id="c30da3f4" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> (pd.DataFrame(rf_rand.cv_results_)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>           .<span class="bu">filter</span>(regex<span class="op">=</span><span class="st">'param_|mean_test|rank'</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>results.columns <span class="op">=</span> results.columns.<span class="bu">str</span>.split(<span class="st">'__'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>results.sort_values(<span class="st">'rank_test_score'</span>).head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_estimators</th>
<th data-quarto-table-cell-role="th">min_samples_leaf</th>
<th data-quarto-table-cell-role="th">max_features</th>
<th data-quarto-table-cell-role="th">bootstrap</th>
<th data-quarto-table-cell-role="th">add_indicator</th>
<th data-quarto-table-cell-role="th">drop</th>
<th data-quarto-table-cell-role="th">ngram_range</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>700</td>
<td>3</td>
<td>None</td>
<td>True</td>
<td>False</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.824926</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">70</td>
<td>700</td>
<td>3</td>
<td>None</td>
<td>True</td>
<td>False</td>
<td>None</td>
<td>(1, 1)</td>
<td>0.822685</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>500</td>
<td>3</td>
<td>None</td>
<td>True</td>
<td>True</td>
<td>first</td>
<td>(1, 2)</td>
<td>0.822685</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>300</td>
<td>2</td>
<td>None</td>
<td>True</td>
<td>False</td>
<td>None</td>
<td>(1, 1)</td>
<td>0.822679</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">33</td>
<td>300</td>
<td>3</td>
<td>None</td>
<td>True</td>
<td>False</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.821562</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">54</td>
<td>300</td>
<td>2</td>
<td>None</td>
<td>True</td>
<td>True</td>
<td>None</td>
<td>(1, 1)</td>
<td>0.821549</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">68</td>
<td>500</td>
<td>3</td>
<td>None</td>
<td>True</td>
<td>False</td>
<td>None</td>
<td>(1, 2)</td>
<td>0.820444</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">81</td>
<td>100</td>
<td>3</td>
<td>None</td>
<td>True</td>
<td>True</td>
<td>first</td>
<td>(1, 2)</td>
<td>0.820432</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>300</td>
<td>2</td>
<td>None</td>
<td>True</td>
<td>True</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.819315</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">94</td>
<td>500</td>
<td>2</td>
<td>None</td>
<td>True</td>
<td>True</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.819308</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">98</td>
<td>100</td>
<td>2</td>
<td>None</td>
<td>True</td>
<td>True</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.819308</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">63</td>
<td>700</td>
<td>1</td>
<td>None</td>
<td>True</td>
<td>True</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.819283</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>700</td>
<td>2</td>
<td>None</td>
<td>True</td>
<td>True</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.818191</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">57</td>
<td>500</td>
<td>2</td>
<td>None</td>
<td>True</td>
<td>False</td>
<td>None</td>
<td>(1, 1)</td>
<td>0.818185</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>100</td>
<td>3</td>
<td>None</td>
<td>True</td>
<td>True</td>
<td>None</td>
<td>(1, 2)</td>
<td>0.818185</td>
<td>14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">72</td>
<td>300</td>
<td>1</td>
<td>None</td>
<td>True</td>
<td>False</td>
<td>None</td>
<td>(1, 1)</td>
<td>0.818178</td>
<td>16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>500</td>
<td>1</td>
<td>sqrt</td>
<td>False</td>
<td>False</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.818160</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>700</td>
<td>2</td>
<td>None</td>
<td>True</td>
<td>True</td>
<td>None</td>
<td>(1, 1)</td>
<td>0.817067</td>
<td>18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>500</td>
<td>2</td>
<td>None</td>
<td>True</td>
<td>False</td>
<td>first</td>
<td>(1, 2)</td>
<td>0.817061</td>
<td>19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>500</td>
<td>2</td>
<td>None</td>
<td>True</td>
<td>True</td>
<td>None</td>
<td>(1, 2)</td>
<td>0.817061</td>
<td>19</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Starting with n_estimators, we see that higher numbers are performing better, which is typical for n_estimators. It seems unlikely that 100 will produce the best result, so we’ll exclude that value from our grid search. And since the current best result is at 700, it seems useful to add a value of 900 to our grid search, in case increasing it further is even better.</p>
<p>Do keep in mind that increasing n_estimators also increases the time needed to train the model. You could consider just setting a single large value for n_estimators rather than searching through multiple values, since larger values will generally produce better results up to a certain point, but I prefer to tune this value when computational resources allow for it.</p>
<p>The next parameter to examine is min_samples_leaf. Similar to n_estimators, the lowest value of 1 seems unlikely to produce the best result, so we’ll remove it. The current best result is 3, so we’ll also try the values 4 and 5 in the grid search.</p>
<p>For max_features, it’s clear that None is performing better, so we’re no longer going to try sqrt.</p>
<p>For bootstrap, it’s clear that True is performing better, so we’re no longer going to try False.</p>
<p>And finally, there aren’t any clear trends for the transformer parameters, so we’ll leave those as-is.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Trends in the randomized search results:</strong></p>
<ul>
<li><strong>n_estimators:</strong>
<ul>
<li>Higher numbers are performing better</li>
<li>Remove 100, add 900</li>
</ul></li>
<li><strong>min_samples_leaf:</strong>
<ul>
<li>Higher numbers are performing better</li>
<li>Remove 1, add 4 and 5</li>
</ul></li>
<li><strong>max_features:</strong>
<ul>
<li>None is performing better</li>
<li>Remove ‘sqrt’</li>
</ul></li>
<li><strong>bootstrap:</strong>
<ul>
<li>True is performing better</li>
<li>Remove False</li>
</ul></li>
<li><strong>Transformer parameters:</strong>
<ul>
<li>No clear trends</li>
<li>Leave as-is</li>
</ul></li>
</ul>
</div>
</div>
</div>
<p>Here are the updated values we’re going to try. For max_features and bootstrap, you’ll see that we can just pass a list with a single value so that that parameter value will always get set during the search.</p>
<div id="365defd8" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>rf_params[<span class="st">'randomforestclassifier__n_estimators'</span>] <span class="op">=</span> [<span class="dv">300</span>, <span class="dv">500</span>, <span class="dv">700</span>, <span class="dv">900</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>rf_params[<span class="st">'randomforestclassifier__min_samples_leaf'</span>] <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>rf_params[<span class="st">'randomforestclassifier__max_features'</span>] <span class="op">=</span> [<span class="va">None</span>]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>rf_params[<span class="st">'randomforestclassifier__bootstrap'</span>] <span class="op">=</span> [<span class="va">True</span>]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>rf_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>{'columntransformer__pipeline__onehotencoder__drop': [None, 'first'],
 'columntransformer__countvectorizer__ngram_range': [(1, 1), (1, 2)],
 'columntransformer__simpleimputer__add_indicator': [False, True],
 'randomforestclassifier__n_estimators': [300, 500, 700, 900],
 'randomforestclassifier__min_samples_leaf': [2, 3, 4, 5],
 'randomforestclassifier__max_features': [None],
 'randomforestclassifier__bootstrap': [True]}</code></pre>
</div>
</div>
<p>At this point, you could continue to run additional randomized searches in order to study the trends further, but we’re just going to move on to grid search.</p>
<p>We’ll create an instance of GridSearchCV called rf_grid, making sure to use the rf_pipe and rf_params objects, and then run the search.</p>
<div id="ec84c83e" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">: EXTENDED RUNTIME</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>rf_grid <span class="op">=</span> GridSearchCV(rf_pipe, rf_params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                       n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time rf_grid.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 2.34 s, sys: 254 ms, total: 2.59 s
Wall time: 3min 14s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="00169e44-ad9e-4295-9e19-26ec51fd7f89" type="checkbox"><label class="sk-toggleable__label" for="00169e44-ad9e-4295-9e19-26ec51fd7f89">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        (...
                                                                              2)],
                         'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                              'first'],
                         'columntransformer__simpleimputer__add_indicator': [False,
                                                                             True],
                         'randomforestclassifier__bootstrap': [True],
                         'randomforestclassifier__max_features': [None],
                         'randomforestclassifier__min_samples_leaf': [2, 3, 4,
                                                                      5],
                         'randomforestclassifier__n_estimators': [300, 500, 700,
                                                                  900]},
             scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a36fb57f-6f6c-40a4-b218-c96f7a4a4d1d" type="checkbox"><label class="sk-toggleable__label" for="a36fb57f-6f6c-40a4-b218-c96f7a4a4d1d">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b2a13208-f39e-441a-82f9-bb4349df93ca" type="checkbox"><label class="sk-toggleable__label" for="b2a13208-f39e-441a-82f9-bb4349df93ca">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8e9e151c-cb89-40d4-8460-99b731e4f0a1" type="checkbox"><label class="sk-toggleable__label" for="8e9e151c-cb89-40d4-8460-99b731e4f0a1">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7706f896-d64c-4e81-bc39-71858e18ba3e" type="checkbox"><label class="sk-toggleable__label" for="7706f896-d64c-4e81-bc39-71858e18ba3e">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8333546a-3732-4713-b359-76784bb4740f" type="checkbox"><label class="sk-toggleable__label" for="8333546a-3732-4713-b359-76784bb4740f">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ef99258f-95d6-499a-a091-4eb5531ccb16" type="checkbox"><label class="sk-toggleable__label" for="ef99258f-95d6-499a-a091-4eb5531ccb16">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cf4825f4-0a84-4de1-8b7f-c4ebf387fe72" type="checkbox"><label class="sk-toggleable__label" for="cf4825f4-0a84-4de1-8b7f-c4ebf387fe72">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c201910e-5f08-4424-959c-02bfa8c9fd51" type="checkbox"><label class="sk-toggleable__label" for="c201910e-5f08-4424-959c-02bfa8c9fd51">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bead7cec-0c4a-4ad8-82bf-ce1898c03743" type="checkbox"><label class="sk-toggleable__label" for="bead7cec-0c4a-4ad8-82bf-ce1898c03743">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a771b5e9-871b-49cc-a578-22f4bc0197b1" type="checkbox"><label class="sk-toggleable__label" for="a771b5e9-871b-49cc-a578-22f4bc0197b1">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="11b8bc69-8f81-4c70-b2c0-2051a698ded2" type="checkbox"><label class="sk-toggleable__label" for="11b8bc69-8f81-4c70-b2c0-2051a698ded2">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(n_jobs=-1, random_state=1)</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>The best score from our grid search is 0.829, which is just a tiny bit higher than the 0.828 score of our best logistic regression Pipeline.</p>
<div id="bb372add" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>rf_grid.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>0.8294143493817087</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (RF):</strong> <mark>0.829</mark></li>
<li><strong>Grid search (LR):</strong> 0.828</li>
<li><strong>Randomized search (RF):</strong> 0.825</li>
<li><strong>Baseline (LR):</strong> 0.811</li>
<li><strong>Baseline (RF):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
<p>These are the best parameters that were found during the grid search. Again, it’s hard to say whether this is truly the best set of parameters, but we at least know that it’s a good set of parameters.</p>
<div id="c3070468" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>rf_grid.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>{'columntransformer__countvectorizer__ngram_range': (1, 1),
 'columntransformer__pipeline__onehotencoder__drop': 'first',
 'columntransformer__simpleimputer__add_indicator': True,
 'randomforestclassifier__bootstrap': True,
 'randomforestclassifier__max_features': None,
 'randomforestclassifier__min_samples_leaf': 4,
 'randomforestclassifier__n_estimators': 300}</code></pre>
</div>
</div>
</section>
<section id="qa-how-do-i-tune-two-models-with-a-single-grid-search" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="qa-how-do-i-tune-two-models-with-a-single-grid-search"><span class="header-section-number">11.4</span> Q&amp;A: How do I tune two models with a single grid search?</h2>
<p>So far, we’ve set up two separate Pipelines called pipe and rf_pipe that each end in a different model. That made it easy to grid search each Pipeline with its own set of relevant parameters. However, you can actually tune two different models using a single grid search if you like.</p>
<p>To do this, the first step is to create a new Pipeline using the Pipeline class instead of the make_pipeline function. The reason we’re doing this is so that we can provide custom names for the steps. In this case, we’ll call the Pipeline object both_pipe, and we’ll call the step names “preprocessor” and “classifier”. We’ll set the classifier to be logistic regression, though this is just a placeholder as you’ll see in a minute.</p>
<div id="e6e36ebe" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>both_pipe <span class="op">=</span> Pipeline([(<span class="st">'preprocessor'</span>, ct), (<span class="st">'classifier'</span>, logreg)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we’ll create a new parameter dictionary called params1. For the simplicity of this example, we’re only going to tune one parameter from the preprocessor step and two parameters from the classifier step.</p>
<p>Additionally, we’re going to add one more entry to the dictionary to indicate that the classifier we want to use with this parameter set is logistic regression. Notice that this is a logistic regression object, not a string, and also notice that we put it in brackets to make it a list. This might seem strange, but it will make more sense in a minute.</p>
<div id="4a772dea" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>params1 <span class="op">=</span> {}</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>params1[<span class="st">'preprocessor__countvectorizer__ngram_range'</span>] <span class="op">=</span> [(<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">1</span>, <span class="dv">2</span>)]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>params1[<span class="st">'classifier__penalty'</span>] <span class="op">=</span> [<span class="st">'l1'</span>, <span class="st">'l2'</span>]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>params1[<span class="st">'classifier__C'</span>] <span class="op">=</span> [<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>]</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>params1[<span class="st">'classifier'</span>] <span class="op">=</span> [logreg]</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>params1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>{'preprocessor__countvectorizer__ngram_range': [(1, 1), (1, 2)],
 'classifier__penalty': ['l1', 'l2'],
 'classifier__C': [0.1, 1, 10],
 'classifier': [LogisticRegression(random_state=1, solver='liblinear')]}</code></pre>
</div>
</div>
<p>Next, we’ll create another parameter dictionary called params2. Again, we’ll tune one parameter from the preprocessor step and two parameters from the classifier step. You’ll notice that the classifier parameters are random forest parameters, not logistic regression parameters.</p>
<p>Just like above, we’ll add one more entry to the dictionary to indicate that the classifier we want to use with this parameter set is random forests. During the grid search, this will override the logistic regression classifier we specified when creating the Pipeline.</p>
<div id="f10e1dac" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>params2 <span class="op">=</span> {}</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>params2[<span class="st">'preprocessor__countvectorizer__ngram_range'</span>] <span class="op">=</span> [(<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">1</span>, <span class="dv">2</span>)]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>params2[<span class="st">'classifier__n_estimators'</span>] <span class="op">=</span> [<span class="dv">300</span>, <span class="dv">500</span>]</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>params2[<span class="st">'classifier__min_samples_leaf'</span>] <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">4</span>]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>params2[<span class="st">'classifier'</span>] <span class="op">=</span> [rf]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>params2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>{'preprocessor__countvectorizer__ngram_range': [(1, 1), (1, 2)],
 'classifier__n_estimators': [300, 500],
 'classifier__min_samples_leaf': [3, 4],
 'classifier': [RandomForestClassifier(n_jobs=-1, random_state=1)]}</code></pre>
</div>
</div>
<p>Next, we’ll create a list called both_params that includes both of these parameter sets.</p>
<div id="3482f089" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>both_params <span class="op">=</span> [params1, params2]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>both_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>[{'preprocessor__countvectorizer__ngram_range': [(1, 1), (1, 2)],
  'classifier__penalty': ['l1', 'l2'],
  'classifier__C': [0.1, 1, 10],
  'classifier': [LogisticRegression(random_state=1, solver='liblinear')]},
 {'preprocessor__countvectorizer__ngram_range': [(1, 1), (1, 2)],
  'classifier__n_estimators': [300, 500],
  'classifier__min_samples_leaf': [3, 4],
  'classifier': [RandomForestClassifier(n_jobs=-1, random_state=1)]}]</code></pre>
</div>
</div>
<p>Finally, we’ll create an instance of GridSearchCV called both_grid, making sure to pass it the both_pipe and both_params objects.</p>
<p>When we run the search, here’s what will happen:</p>
<ul>
<li>First, it will try every combination of parameters from params1, which is 2 times 2 times 3 times 1, or 12 combinations.</li>
<li>Then, it will try every combination of parameters from params2, which is 2 times 2 times 2 times 1, or 8 combinations.</li>
</ul>
<p>Thus, it will run a total of 20 times.</p>
<div id="0b787248" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>both_grid <span class="op">=</span> GridSearchCV(both_pipe, both_params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                         n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>both_grid.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2d995385-8846-45f7-a073-daf08996b027" type="checkbox"><label class="sk-toggleable__label" for="2d995385-8846-45f7-a073-daf08996b027">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('preprocessor',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        ('pass...
                                                            solver='liblinear')],
                          'classifier__C': [0.1, 1, 10],
                          'classifier__penalty': ['l1', 'l2'],
                          'preprocessor__countvectorizer__ngram_range': [(1, 1),
                                                                         (1,
                                                                          2)]},
                         {'classifier': [RandomForestClassifier(n_jobs=-1,
                                                                random_state=1)],
                          'classifier__min_samples_leaf': [3, 4],
                          'classifier__n_estimators': [300, 500],
                          'preprocessor__countvectorizer__ngram_range': [(1, 1),
                                                                         (1,
                                                                          2)]}],
             scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9284b405-954f-413b-a56c-135a5118ed6a" type="checkbox"><label class="sk-toggleable__label" for="9284b405-954f-413b-a56c-135a5118ed6a">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8625576f-0458-4cce-8011-fd1cb759823f" type="checkbox"><label class="sk-toggleable__label" for="8625576f-0458-4cce-8011-fd1cb759823f">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="201f043d-b63b-4d08-9d9a-597454a0628e" type="checkbox"><label class="sk-toggleable__label" for="201f043d-b63b-4d08-9d9a-597454a0628e">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5424702f-a15c-41f0-9dea-2b1de5932ccb" type="checkbox"><label class="sk-toggleable__label" for="5424702f-a15c-41f0-9dea-2b1de5932ccb">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1f25c9ed-be27-41c3-8e96-0c9898449ad5" type="checkbox"><label class="sk-toggleable__label" for="1f25c9ed-be27-41c3-8e96-0c9898449ad5">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5109b7b8-a67c-447c-88f5-f7138b376c76" type="checkbox"><label class="sk-toggleable__label" for="5109b7b8-a67c-447c-88f5-f7138b376c76">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d50c5cf4-76a9-4eb2-9ab7-e72e31844d5c" type="checkbox"><label class="sk-toggleable__label" for="d50c5cf4-76a9-4eb2-9ab7-e72e31844d5c">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="814a8a16-ea32-4091-8875-fffd104eac89" type="checkbox"><label class="sk-toggleable__label" for="814a8a16-ea32-4091-8875-fffd104eac89">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d3c519dc-b402-486d-8c1a-95c061547ec3" type="checkbox"><label class="sk-toggleable__label" for="d3c519dc-b402-486d-8c1a-95c061547ec3">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3bf293e2-90e9-435a-a31f-b59e23687daa" type="checkbox"><label class="sk-toggleable__label" for="3bf293e2-90e9-435a-a31f-b59e23687daa">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="059fe803-fe7a-4d02-abd9-b2e08fc873b2" type="checkbox"><label class="sk-toggleable__label" for="059fe803-fe7a-4d02-abd9-b2e08fc873b2">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(C=10, penalty='l1', random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>Let’s take a look at the results. You can see that it ran 12 times with a logistic regression model and 8 times with a random forest model. Also note that when logistic regression model runs, the random forest-related parameters are listed as NaN, and vice versa when the random forest model runs.</p>
<div id="fb6fb393" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> (pd.DataFrame(both_grid.cv_results_)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>           .<span class="bu">filter</span>(regex<span class="op">=</span><span class="st">'param_.+_|mean_test|rank'</span>))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>results.columns <span class="op">=</span> results.columns.<span class="bu">str</span>.split(<span class="st">'__'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">penalty</th>
<th data-quarto-table-cell-role="th">ngram_range</th>
<th data-quarto-table-cell-role="th">min_samples_leaf</th>
<th data-quarto-table-cell-role="th">n_estimators</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.1</td>
<td>l1</td>
<td>(1, 1)</td>
<td>NaN</td>
<td>NaN</td>
<td>0.783385</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.1</td>
<td>l1</td>
<td>(1, 2)</td>
<td>NaN</td>
<td>NaN</td>
<td>0.783385</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.1</td>
<td>l2</td>
<td>(1, 1)</td>
<td>NaN</td>
<td>NaN</td>
<td>0.788990</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.1</td>
<td>l2</td>
<td>(1, 2)</td>
<td>NaN</td>
<td>NaN</td>
<td>0.788996</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>l1</td>
<td>(1, 1)</td>
<td>NaN</td>
<td>NaN</td>
<td>0.814814</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1</td>
<td>l1</td>
<td>(1, 2)</td>
<td>NaN</td>
<td>NaN</td>
<td>0.812567</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1</td>
<td>l2</td>
<td>(1, 1)</td>
<td>NaN</td>
<td>NaN</td>
<td>0.811462</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1</td>
<td>l2</td>
<td>(1, 2)</td>
<td>NaN</td>
<td>NaN</td>
<td>0.805844</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>10</td>
<td>l1</td>
<td>(1, 1)</td>
<td>NaN</td>
<td>NaN</td>
<td>0.818166</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>10</td>
<td>l1</td>
<td>(1, 2)</td>
<td>NaN</td>
<td>NaN</td>
<td>0.824889</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>10</td>
<td>l2</td>
<td>(1, 1)</td>
<td>NaN</td>
<td>NaN</td>
<td>0.809234</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>10</td>
<td>l2</td>
<td>(1, 2)</td>
<td>NaN</td>
<td>NaN</td>
<td>0.808104</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>NaN</td>
<td>NaN</td>
<td>(1, 1)</td>
<td>3</td>
<td>300</td>
<td>0.783378</td>
<td>14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>NaN</td>
<td>NaN</td>
<td>(1, 2)</td>
<td>3</td>
<td>300</td>
<td>0.723859</td>
<td>16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>NaN</td>
<td>NaN</td>
<td>(1, 1)</td>
<td>3</td>
<td>500</td>
<td>0.784502</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>NaN</td>
<td>NaN</td>
<td>(1, 2)</td>
<td>3</td>
<td>500</td>
<td>0.738478</td>
<td>15</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>NaN</td>
<td>NaN</td>
<td>(1, 1)</td>
<td>4</td>
<td>300</td>
<td>0.701469</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>NaN</td>
<td>NaN</td>
<td>(1, 2)</td>
<td>4</td>
<td>300</td>
<td>0.616163</td>
<td>19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>NaN</td>
<td>NaN</td>
<td>(1, 1)</td>
<td>4</td>
<td>500</td>
<td>0.686900</td>
<td>18</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>NaN</td>
<td>NaN</td>
<td>(1, 2)</td>
<td>4</td>
<td>500</td>
<td>0.616163</td>
<td>19</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As usual, the best_score_ and best_params_ attributes are still available.</p>
<div id="d1e42b19" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>both_grid.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>0.8248885820099178</code></pre>
</div>
</div>
<div id="d3f00803" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>both_grid.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>{'classifier': LogisticRegression(C=10, penalty='l1', random_state=1, solver='liblinear'),
 'classifier__C': 10,
 'classifier__penalty': 'l1',
 'preprocessor__countvectorizer__ngram_range': (1, 2)}</code></pre>
</div>
</div>
<p>Here are two neat extensions to what we’ve done in this lesson that you could try on your own.</p>
<p>First, since the two models have separate parameter dictionaries, you could theoretically tune different preprocessing parameters for each model. For example, you could tune different CountVectorizer parameters for logistic regression and random forests.</p>
<p>Taking it one step further, you could actually create two different preprocessor objects and tune them using the same grid search, just like we tuned two different models using the same grid search. That would allow you, for example, to use different encoders when preparing data for your logistic regression and random forest models.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Extensions of this approach:</strong></p>
<ul>
<li>Tune different preprocessing parameters for each model</li>
<li>Tune two different preprocessor objects</li>
</ul>
</div>
</div>
</div>
</section>
<section id="qa-how-do-i-tune-two-models-with-a-single-randomized-search" class="level2" data-number="11.5">
<h2 data-number="11.5" class="anchored" data-anchor-id="qa-how-do-i-tune-two-models-with-a-single-randomized-search"><span class="header-section-number">11.5</span> Q&amp;A: How do I tune two models with a single randomized search?</h2>
<p>Starting in scikit-learn version 0.22, RandomizedSearchCV can search multiple parameter dictionaries. This allows you to do a randomized search of multiple models, in the same exact way that we did a grid search of multiple models.</p>
<p>Here’s an example in which we pass both_pipe and both_params to RandomizedSearchCV and run it for 10 iterations.</p>
<div id="bbc5999e" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>both_rand <span class="op">=</span> RandomizedSearchCV(both_pipe, both_params, cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                               scoring<span class="op">=</span><span class="st">'accuracy'</span>, n_iter<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                               n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>both_rand.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="45ecc134-580b-4b8b-bc0b-6613bba33a6a" type="checkbox"><label class="sk-toggleable__label" for="45ecc134-580b-4b8b-bc0b-6613bba33a6a">RandomizedSearchCV</label><div class="sk-toggleable__content"><pre>RandomizedSearchCV(cv=5,
                   estimator=Pipeline(steps=[('preprocessor',
                                              ColumnTransformer(transformers=[('pipeline',
                                                                               Pipeline(steps=[('simpleimputer',
                                                                                                SimpleImputer(fill_value='missing',
                                                                                                              strategy='constant')),
                                                                                               ('onehotencoder',
                                                                                                OneHotEncoder())]),
                                                                               ['Embarked',
                                                                                'Sex']),
                                                                              ('countvectorizer',
                                                                               CountVectorizer(),
                                                                               'Name'),
                                                                              ('simpleimputer',
                                                                               SimpleImputer(),
                                                                               ['Age',
                                                                                'Fare']),...
                                         'classifier__C': [0.1, 1, 10],
                                         'classifier__penalty': ['l1', 'l2'],
                                         'preprocessor__countvectorizer__ngram_range': [(1,
                                                                                         1),
                                                                                        (1,
                                                                                         2)]},
                                        {'classifier': [RandomForestClassifier(n_jobs=-1,
                                                                               random_state=1)],
                                         'classifier__min_samples_leaf': [3, 4],
                                         'classifier__n_estimators': [300, 500],
                                         'preprocessor__countvectorizer__ngram_range': [(1,
                                                                                         1),
                                                                                        (1,
                                                                                         2)]}],
                   random_state=1, scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ae319086-f17c-4d47-ac5a-243ef61585d4" type="checkbox"><label class="sk-toggleable__label" for="ae319086-f17c-4d47-ac5a-243ef61585d4">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b359be9e-fb29-4bff-a163-df0f3985c8d6" type="checkbox"><label class="sk-toggleable__label" for="b359be9e-fb29-4bff-a163-df0f3985c8d6">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9160378b-862e-46b0-8ef8-e5c2665fce83" type="checkbox"><label class="sk-toggleable__label" for="9160378b-862e-46b0-8ef8-e5c2665fce83">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ff0cd852-e3ae-495d-a7ff-74bff09d8ed1" type="checkbox"><label class="sk-toggleable__label" for="ff0cd852-e3ae-495d-a7ff-74bff09d8ed1">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5d059d6d-529e-404d-bdfe-a6c2a17e7cb4" type="checkbox"><label class="sk-toggleable__label" for="5d059d6d-529e-404d-bdfe-a6c2a17e7cb4">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="64786308-b917-4dfb-9e64-bfa0e004f127" type="checkbox"><label class="sk-toggleable__label" for="64786308-b917-4dfb-9e64-bfa0e004f127">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3cd096b7-2540-493c-b39e-ea8aa2cfd469" type="checkbox"><label class="sk-toggleable__label" for="3cd096b7-2540-493c-b39e-ea8aa2cfd469">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7c805729-3f10-49a1-8e1b-722251212058" type="checkbox"><label class="sk-toggleable__label" for="7c805729-3f10-49a1-8e1b-722251212058">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="77236530-883c-4b45-8b90-d56bad59af93" type="checkbox"><label class="sk-toggleable__label" for="77236530-883c-4b45-8b90-d56bad59af93">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2d7697a2-9d96-435d-bc5f-31037a8864db" type="checkbox"><label class="sk-toggleable__label" for="2d7697a2-9d96-435d-bc5f-31037a8864db">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d4bb2255-bfc4-4507-8879-bc21caf80c68" type="checkbox"><label class="sk-toggleable__label" for="d4bb2255-bfc4-4507-8879-bc21caf80c68">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(C=1, penalty='l1', random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>If you examine the results, you’ll find that logistic regression will be chosen more often because we defined more parameter combinations for the logistic regression model. This behavior may change in a future version, such that each model is equally likely to be chosen, regardless of the number of parameter combinations.</p>
<div id="d3970b14" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> (pd.DataFrame(both_rand.cv_results_)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>           .<span class="bu">filter</span>(regex<span class="op">=</span><span class="st">'param_.+_|mean_test|rank'</span>))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>results.columns <span class="op">=</span> results.columns.<span class="bu">str</span>.split(<span class="st">'__'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ngram_range</th>
<th data-quarto-table-cell-role="th">penalty</th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">n_estimators</th>
<th data-quarto-table-cell-role="th">min_samples_leaf</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>(1, 2)</td>
<td>l2</td>
<td>0.1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.788996</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>(1, 1)</td>
<td>NaN</td>
<td>NaN</td>
<td>300</td>
<td>4</td>
<td>0.701469</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>(1, 1)</td>
<td>l2</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.811462</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>(1, 1)</td>
<td>l2</td>
<td>10</td>
<td>NaN</td>
<td>NaN</td>
<td>0.809234</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>(1, 1)</td>
<td>l2</td>
<td>0.1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.788990</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>(1, 1)</td>
<td>NaN</td>
<td>NaN</td>
<td>500</td>
<td>3</td>
<td>0.784502</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>(1, 1)</td>
<td>l1</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.814814</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>(1, 2)</td>
<td>NaN</td>
<td>NaN</td>
<td>300</td>
<td>4</td>
<td>0.616163</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>(1, 2)</td>
<td>l2</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.805844</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>(1, 2)</td>
<td>l1</td>
<td>0.1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.783385</td>
<td>8</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mlbook\.dataschool\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ch10.html" class="pagination-link" aria-label="Evaluating and tuning a Pipeline">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Evaluating and tuning a Pipeline</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ch12.html" class="pagination-link" aria-label="Ensembling multiple models">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Ensembling multiple models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Kevin Markham. All Rights Reserved.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>