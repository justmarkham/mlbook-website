<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kevin Markham">
<meta name="description" content="A practical guide to help you transition from Machine Learning beginner to skilled Machine Learning practitioner.">

<title>10&nbsp; Evaluating and tuning a Pipeline – Master Machine Learning with scikit-learn</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ch11.html" rel="next">
<link href="./ch09.html" rel="prev">
<link href="./favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-211a06f58281a873233d4d02949b23e7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://cdn.usefathom.com/script.js" data-site="AWKMQOCB" defer=""></script>


<meta property="og:title" content="10&nbsp; Evaluating and tuning a Pipeline – Master Machine Learning with scikit-learn">
<meta property="og:description" content="">
<meta property="og:image" content="https://mlbook.dataschool.io/logo.png">
<meta property="og:site_name" content="Master Machine Learning with scikit-learn">
<meta property="og:image:height" content="141">
<meta property="og:image:width" content="266">
<meta name="twitter:title" content="10&nbsp; Evaluating and tuning a Pipeline – Master Machine Learning with scikit-learn">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://mlbook.dataschool.io/logo.png">
<meta name="twitter:image-height" content="141">
<meta name="twitter:image-width" content="266">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ch10.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Evaluating and tuning a Pipeline</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Master Machine Learning with scikit-learn</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Review of the Machine Learning workflow</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Encoding categorical features</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Improving your workflow with ColumnTransformer and Pipeline</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Workflow review #1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Encoding text data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Handling missing values</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Fixing common workflow problems</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Workflow review #2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch10.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Evaluating and tuning a Pipeline</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing linear and non-linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Ensembling multiple models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Feature selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Feature standardization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Feature engineering with custom transformers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Workflow review #3</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">High-cardinality categorical features</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch18.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Class imbalance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch19.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Class imbalance walkthrough</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch20.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Going further</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#evaluating-a-pipeline-with-cross-validation" id="toc-evaluating-a-pipeline-with-cross-validation" class="nav-link active" data-scroll-target="#evaluating-a-pipeline-with-cross-validation"><span class="header-section-number">10.1</span> Evaluating a Pipeline with cross-validation</a></li>
  <li><a href="#tuning-a-pipeline-with-grid-search" id="toc-tuning-a-pipeline-with-grid-search" class="nav-link" data-scroll-target="#tuning-a-pipeline-with-grid-search"><span class="header-section-number">10.2</span> Tuning a Pipeline with grid search</a></li>
  <li><a href="#tuning-the-model" id="toc-tuning-the-model" class="nav-link" data-scroll-target="#tuning-the-model"><span class="header-section-number">10.3</span> Tuning the model</a></li>
  <li><a href="#tuning-the-transformers" id="toc-tuning-the-transformers" class="nav-link" data-scroll-target="#tuning-the-transformers"><span class="header-section-number">10.4</span> Tuning the transformers</a></li>
  <li><a href="#using-the-best-pipeline-to-make-predictions" id="toc-using-the-best-pipeline-to-make-predictions" class="nav-link" data-scroll-target="#using-the-best-pipeline-to-make-predictions"><span class="header-section-number">10.5</span> Using the best Pipeline to make predictions</a></li>
  <li><a href="#qa-how-do-i-save-the-best-pipeline-for-future-use" id="toc-qa-how-do-i-save-the-best-pipeline-for-future-use" class="nav-link" data-scroll-target="#qa-how-do-i-save-the-best-pipeline-for-future-use"><span class="header-section-number">10.6</span> Q&amp;A: How do I save the best Pipeline for future use?</a></li>
  <li><a href="#qa-how-do-i-speed-up-a-grid-search" id="toc-qa-how-do-i-speed-up-a-grid-search" class="nav-link" data-scroll-target="#qa-how-do-i-speed-up-a-grid-search"><span class="header-section-number">10.7</span> Q&amp;A: How do I speed up a grid search?</a></li>
  <li><a href="#qa-how-do-i-tune-a-pipeline-with-randomized-search" id="toc-qa-how-do-i-tune-a-pipeline-with-randomized-search" class="nav-link" data-scroll-target="#qa-how-do-i-tune-a-pipeline-with-randomized-search"><span class="header-section-number">10.8</span> Q&amp;A: How do I tune a Pipeline with randomized search?</a></li>
  <li><a href="#qa-whats-the-target-accuracy-we-are-trying-to-achieve" id="toc-qa-whats-the-target-accuracy-we-are-trying-to-achieve" class="nav-link" data-scroll-target="#qa-whats-the-target-accuracy-we-are-trying-to-achieve"><span class="header-section-number">10.9</span> Q&amp;A: What’s the target accuracy we are trying to achieve?</a></li>
  <li><a href="#qa-is-it-okay-that-our-model-includes-thousands-of-features" id="toc-qa-is-it-okay-that-our-model-includes-thousands-of-features" class="nav-link" data-scroll-target="#qa-is-it-okay-that-our-model-includes-thousands-of-features"><span class="header-section-number">10.10</span> Q&amp;A: Is it okay that our model includes thousands of features?</a></li>
  <li><a href="#qa-how-do-i-examine-the-coefficients-of-a-pipeline" id="toc-qa-how-do-i-examine-the-coefficients-of-a-pipeline" class="nav-link" data-scroll-target="#qa-how-do-i-examine-the-coefficients-of-a-pipeline"><span class="header-section-number">10.11</span> Q&amp;A: How do I examine the coefficients of a Pipeline?</a></li>
  <li><a href="#sec-10-12" id="toc-sec-10-12" class="nav-link" data-scroll-target="#sec-10-12"><span class="header-section-number">10.12</span> Q&amp;A: Should I split the dataset before tuning the Pipeline?</a></li>
  <li><a href="#qa-what-is-regularization" id="toc-qa-what-is-regularization" class="nav-link" data-scroll-target="#qa-what-is-regularization"><span class="header-section-number">10.13</span> Q&amp;A: What is regularization?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Evaluating and tuning a Pipeline</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="evaluating-a-pipeline-with-cross-validation" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="evaluating-a-pipeline-with-cross-validation"><span class="header-section-number">10.1</span> Evaluating a Pipeline with cross-validation</h2>
<p>In this chapter, we’re going to take a deep dive into how to efficiently tune our Pipeline for maximum accuracy.</p>
<p>Let’s return to the topic of model evaluation.</p>
<p>As you might recall, we used cross-validation way back in chapter 2 to evaluate our most basic model. Since that chapter, we’ve been adding many more features without re-running cross-validation. That’s because any model evaluation procedure is highly unreliable with only 10 rows of data, so it would have been misleading to run cross-validation and compare the results. But now that we’re using the full dataset, cross-validation can once again be used.</p>
<ul>
<li>First, we’ll import the cross_val_score function from the model_selection module.</li>
<li>Instead of passing a model to cross_val_score, we can actually pass our entire Pipeline.</li>
<li>We also pass it X and y.</li>
<li>And then we specify the number of cross-validation folds. Using 5 or 10 folds has been shown to be a reasonable default choice, and so we’ll choose 5 in order to minimize the computation. 5 folds has actually been the default for cross_val_score since version 0.22, but I like to include it anyway for clarity.</li>
<li>Finally, we’ll specify the evaluation metric of classification accuracy.</li>
</ul>
<p>When we run it, cross_val_score outputs a mean accuracy of 0.811, which we’ll use as the baseline accuracy against which our future Pipelines can be compared.</p>
<div id="2442f40c" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>cross_val_score(pipe, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>0.8114619295712762</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
<p>Let’s talk about what actually happens “under the hood” when we run the cross_val_score function on a Pipeline:</p>
<ul>
<li>In step 1, cross_val_score splits the data into 5 folds. 4 out of 5 folds (meaning 80% of the data) is set aside for training, and the remaining fold (meaning 20% of the data) is set aside for testing.</li>
<li>In step 2, the Pipeline’s fit method is run on the training portion. Thus the transformations specified in the ColumnTransformer are performed on the training portion, and the transformed training data is used to fit the model.</li>
<li>In step 3, the Pipeline’s predict method is run on the testing portion. Thus the transformations learned during step 2 are applied to the testing portion, the transformed testing data is passed to the fitted model, and the model makes predictions.</li>
<li>Finally, in step 4, the accuracy of those predictions is calculated.</li>
<li>Steps 1 through 4 are then repeated 4 more times, and each time a different fold is set aside as the testing portion.</li>
<li>cross_val_score thus outputs 5 accuracy scores, and we take the mean of those scores.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Steps of 5-fold cross-validation on a Pipeline:</strong></p>
<ol type="1">
<li>Split data into 5 folds (A, B, C, D, E)</li>
</ol>
<ul>
<li>ABCD is training set</li>
<li>E is testing set</li>
</ul>
<ol start="2" type="1">
<li>Pipeline is fit on training set</li>
</ol>
<ul>
<li>ABCD is transformed</li>
<li>Model is fit on transformed data</li>
</ul>
<ol start="3" type="1">
<li>Pipeline makes predictions on testing set</li>
</ol>
<ul>
<li>E is transformed (using step 2 transformations)</li>
<li>Model makes predictions on transformed data</li>
</ul>
<ol start="4" type="1">
<li>Calculate accuracy of those predictions</li>
<li>Repeat the steps above 4 more times, with a different testing set each time</li>
<li>Calculate the mean of the 5 scores</li>
</ol>
</div>
</div>
</div>
<p>One thing you might have noticed is that cross_val_score splits the data in step 1 before performing the transformations in steps 2 and 3. As a result, the imputation values for Age and Fare and the vocabulary for CountVectorizer are all computed 5 different times. Each time, these values are computed using the training set only, and then applied to both the training and testing sets.</p>
<p>Alternatively, you could imagine performing all of the transformations first, and then splitting the data. This would be much faster, since the imputation values and the vocabulary would be computed only once on the full dataset.</p>
<p>So why does cross_val_score split the data first? Because splitting the data before performing the transformations prevents data leakage, whereas performing the transformations on the full dataset before splitting the data would cause data leakage, since information about the testing set would be “leaked” into the model training process.</p>
<p>As we discussed in the previous chapter, this is one way that scikit-learn helps to shield you from data leakage.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Why does cross_val_score split the data first?</strong></p>
<ul>
<li><strong>Proper cross-validation:</strong>
<ul>
<li>Data is split (step 1) before transformations (steps 2 and 3)</li>
<li>Imputation values and vocabulary are computed using training set only</li>
<li>Prevents data leakage</li>
</ul></li>
<li><strong>Improper cross-validation:</strong>
<ul>
<li>Transformations are performed before data is split</li>
<li>Imputation values and vocabulary are computed using full dataset</li>
<li>Causes data leakage</li>
</ul></li>
</ul>
</div>
</div>
</div>
</section>
<section id="tuning-a-pipeline-with-grid-search" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="tuning-a-pipeline-with-grid-search"><span class="header-section-number">10.2</span> Tuning a Pipeline with grid search</h2>
<p>Now that we’ve calculated the baseline accuracy for our Pipeline, the next step is to tune the hyperparameters for both the model and the transformers. Recall that we’ve been using the default parameters for most objects in the Pipeline, and so tuning those parameters is likely to result in a more accurate model.</p>
<p>Before proceeding, let me briefly explain some terminology. In the field of statistics, “hyperparameters” are values that you set, whereas “parameters” are values learned from the data by the estimator during the fitting process.</p>
<p>For example, the C value of logistic regression is called a hyperparameter because it’s something you can set and optimize, whereas the coefficients of a logistic regression model are called parameters because they’re learned from the data.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Statistics terminology:</strong></p>
<ul>
<li><strong>Hyperparameters:</strong> Values that you set
<ul>
<li><strong>Example:</strong> C value of logistic regression</li>
</ul></li>
<li><strong>Parameters:</strong> Values learned from the data
<ul>
<li><strong>Example:</strong> Coefficients of logistic regression model</li>
</ul></li>
</ul>
</div>
</div>
</div>
<p>In this book, I’m generally going to follow scikit-learn’s conventions as I understand them:</p>
<ul>
<li>I’ll use the phrase “hyperparameter tuning” to refer to the process of tuning a model or tuning a Pipeline containing a model and transformers.</li>
<li>And I’ll use the phrase “parameter” to refer to anything passed to a class. For example, this includes the C and random_state values passed to the LogisticRegression class, and the strategy value passed to the SimpleImputer class.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>scikit-learn terminology:</strong></p>
<ul>
<li><strong>Hyperparameter tuning:</strong> Tuning a model or a Pipeline</li>
<li><strong>Parameter:</strong> Anything passed to a class
<ul>
<li><strong>LogisticRegression:</strong> C, random_state</li>
<li><strong>SimpleImputer:</strong> strategy</li>
</ul></li>
</ul>
</div>
</div>
</div>
<p>With that being said, we’re going to use a scikit-learn class called GridSearchCV to perform the hyperparameter tuning. In a grid search, you define which values you want to try for each parameter, and it cross-validates every possible combination of those values.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Hyperparameter tuning with GridSearchCV:</strong></p>
<ul>
<li>You define which values to try for each parameter</li>
<li>It cross-validates every combination of those values</li>
</ul>
</div>
</div>
</div>
<p>We can actually use GridSearchCV to tune the entire Pipeline at once, including both the model and the transformers. This has two huge benefits over just tuning a model:</p>
<ul>
<li>First, it enables you to tune the model and transformer parameters simultaneously, which is important because the best performing combination might be when none of the parameters are set to their default values.</li>
<li>Second, this prevents data leakage because the data splitting and transformations will occur within the cross-validation done by GridSearchCV.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Benefits of tuning a Pipeline:</strong></p>
<ul>
<li>Tunes the model and transformers simultaneously</li>
<li>Prevents data leakage</li>
</ul>
</div>
</div>
</div>
<p>Keep in mind that if we had instead done the data transformations in pandas, we would have missed out on both of these benefits.</p>
</section>
<section id="tuning-the-model" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="tuning-the-model"><span class="header-section-number">10.3</span> Tuning the model</h2>
<p>In this lesson, we’re going to tune the model, and then in the next lesson, we’ll also tune the transformers.</p>
<p>For the logistic regression model, we’re going to tune two parameters:</p>
<ul>
<li>The first parameter is “penalty”, which is the type of regularization. For this parameter, the default value is “l2”, and we’re going to try the values “l1” and “l2”. And just to be clear, the first character of each of those values is a lowercase “L”.</li>
<li>The second parameter is “C”, which is the amount of regularization. For this parameter, the default value is 1, and we’re going to try the values 0.1, 1, and 10.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>LogisticRegression tuning parameters:</strong></p>
<ul>
<li><strong>penalty:</strong> Type of regularization
<ul>
<li>‘l1’</li>
<li>‘l2’ (default)</li>
</ul></li>
<li><strong>C:</strong> Amount of regularization
<ul>
<li>0.1</li>
<li>1 (default)</li>
<li>10</li>
</ul></li>
</ul>
</div>
</div>
</div>
<p>Deciding which parameters to tune and what values to try requires both research and experience, and unfortunately, it’s different for every type of model.</p>
<p>In order to tune a Pipeline with GridSearchCV, we need to get the names of the Pipeline steps from the named_steps attribute. We’ll tune the “logisticregression” step in this lesson, and we’ll tune the “columntransformer” step in the next lesson.</p>
<div id="0e9d2ec6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pipe.named_steps.keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>dict_keys(['columntransformer', 'logisticregression'])</code></pre>
</div>
</div>
<p>To use GridSearchCV, we need to create a dictionary in which each entry represents a parameter and the values we want to try for that parameter. We’ll start by creating an empty dictionary called params, and then we’ll add the two entries.</p>
<p>For each dictionary entry, the key is the Pipeline step name, followed by two underscores, followed by the parameter name. Thus the key for the first entry is “logisticregression__penalty”, and the key for the second entry is “logisticregression__C”.</p>
<p>Using two underscores is what allows GridSearchCV to distinguish between the step name and the parameter name. Using a single underscore would be ambiguous, since a step name or parameter name can have an underscore within it.</p>
<p>The value for each dictionary entry is a list of the values you want to try for that parameter. Thus the value for the first entry is a list of “l1” and “l2”, and the value for the second entry is a list of 0.1, 1, and 10.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Parameter dictionary for GridSearchCV:</strong></p>
<ul>
<li><strong>Key:</strong> step__parameter
<ul>
<li>’logisticregression__penalty’</li>
<li>’logisticregression__C’</li>
</ul></li>
<li><strong>Value:</strong> List of values to try
<ul>
<li>[‘l1’, ‘l2’]</li>
<li>[0.1, 1, 10]</li>
</ul></li>
</ul>
</div>
</div>
</div>
<p>After adding the two entries, we’ll print out the params dictionary just to make sure that it looks correct.</p>
<div id="fd31afae" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {}</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>params[<span class="st">'logisticregression__penalty'</span>] <span class="op">=</span> [<span class="st">'l1'</span>, <span class="st">'l2'</span>]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>params[<span class="st">'logisticregression__C'</span>] <span class="op">=</span> [<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>{'logisticregression__penalty': ['l1', 'l2'],
 'logisticregression__C': [0.1, 1, 10]}</code></pre>
</div>
</div>
<p>Now that we’ve created the parameter dictionary, we can set up the grid search. We import the GridSearchCV class from the model_selection module.</p>
<div id="4fe73a4a" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we create an instance of GridSearchCV called grid. We pass it the Pipeline, the parameter dictionary, the number of folds, and the evaluation metric.</p>
<p>Finally, we run the grid search by fitting the grid object with X and y. Because our scikit-learn configuration is set to display diagrams, we see a diagram of the Pipeline now that the grid search is complete.</p>
<div id="f2c1e625" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(pipe, params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>grid.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4381c3e7-fb47-4772-9c88-01fca798ff17" type="checkbox"><label class="sk-toggleable__label" for="4381c3e7-fb47-4772-9c88-01fca798ff17">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        ('passthrough',
                                                                         'passthrough',
                                                                         ['Parch'])])),
                                       ('logisticregression',
                                        LogisticRegression(random_state=1,
                                                           solver='liblinear'))]),
             param_grid={'logisticregression__C': [0.1, 1, 10],
                         'logisticregression__penalty': ['l1', 'l2']},
             scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3381cb62-f194-4af7-9133-9bab7b2363dc" type="checkbox"><label class="sk-toggleable__label" for="3381cb62-f194-4af7-9133-9bab7b2363dc">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9281fbb9-e14d-4108-b018-fc9438ca566c" type="checkbox"><label class="sk-toggleable__label" for="9281fbb9-e14d-4108-b018-fc9438ca566c">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5e4b7771-daa0-462e-9415-add2c027c975" type="checkbox"><label class="sk-toggleable__label" for="5e4b7771-daa0-462e-9415-add2c027c975">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a62447e6-a0fe-4194-a3e3-b7e361679398" type="checkbox"><label class="sk-toggleable__label" for="a62447e6-a0fe-4194-a3e3-b7e361679398">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2107deea-7193-4260-8bc8-02454b4e26f3" type="checkbox"><label class="sk-toggleable__label" for="2107deea-7193-4260-8bc8-02454b4e26f3">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c73b1ce6-468e-4b95-bf68-79866e9c568e" type="checkbox"><label class="sk-toggleable__label" for="c73b1ce6-468e-4b95-bf68-79866e9c568e">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cfbe900a-836d-4b3a-a03d-bf8c9f96d60b" type="checkbox"><label class="sk-toggleable__label" for="cfbe900a-836d-4b3a-a03d-bf8c9f96d60b">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7110950b-f3dd-4b0e-9dd8-0a8b8188704a" type="checkbox"><label class="sk-toggleable__label" for="7110950b-f3dd-4b0e-9dd8-0a8b8188704a">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="acd676ba-0645-424a-a136-3904e76d997b" type="checkbox"><label class="sk-toggleable__label" for="acd676ba-0645-424a-a136-3904e76d997b">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="72ac3c11-af45-4d61-85b3-dcf0d9d9db38" type="checkbox"><label class="sk-toggleable__label" for="72ac3c11-af45-4d61-85b3-dcf0d9d9db38">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2697b721-95e6-4141-b2d0-549efae732dd" type="checkbox"><label class="sk-toggleable__label" for="2697b721-95e6-4141-b2d0-549efae732dd">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>The results of the grid search are stored in an attribute called cv_results_, which we’ll convert to a DataFrame. We’ll use a filter to only keep the columns we need, and rename the parameter columns to make them easier to read.</p>
<p>There are 6 rows because it ran cross-validation 6 times, which is every possible combination of the 2 values of penalty and the 3 values of C that we specified.</p>
<div id="7dc85c39" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pd.DataFrame(grid.cv_results_).<span class="bu">filter</span>(regex<span class="op">=</span><span class="st">'param_|mean_test|rank'</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>results.columns <span class="op">=</span> results.columns.<span class="bu">str</span>.split(<span class="st">'__'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">penalty</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.1</td>
<td>l1</td>
<td>0.783385</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.1</td>
<td>l2</td>
<td>0.788990</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>l1</td>
<td>0.814814</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>l2</td>
<td>0.811462</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>l1</td>
<td>0.818166</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>10</td>
<td>l2</td>
<td>0.809234</td>
<td>4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Notice the rank_test_score column. We’ll use the DataFrame’s sort_values method to sort the rows by that column in ascending order.</p>
<p>By examining the mean_test_score column, we can see that the best parameter combination resulted in a cross-validated accuracy of 0.818, which is higher than our baseline accuracy of 0.811.</p>
<p>We can see that the best accuracy occurred when C was 10 and penalty was l1, neither of which was the default value for that parameter.</p>
<div id="f5974443" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>results.sort_values(<span class="st">'rank_test_score'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">penalty</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>l1</td>
<td>0.818166</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>l1</td>
<td>0.814814</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>l2</td>
<td>0.811462</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>10</td>
<td>l2</td>
<td>0.809234</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>0.1</td>
<td>l2</td>
<td>0.788990</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>0.1</td>
<td>l1</td>
<td>0.783385</td>
<td>6</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (2 parameters):</strong> <mark>0.818</mark></li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
</section>
<section id="tuning-the-transformers" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="tuning-the-transformers"><span class="header-section-number">10.4</span> Tuning the transformers</h2>
<p>In the previous lesson, we built a grid search for tuning model parameters and found that the best accuracy occurred when C was 10 and penalty was l1. In this lesson, we’re going to expand the search to also include transformer parameters.</p>
<p>When expanding the search, you might first think that we should set C to 10 and penalty to l1, and then only search the transformer parameters, since that would be the most computationally efficient approach.</p>
<p>However, the better approach is actually to consider all of the values for C and penalty in combination with all of the transformer parameters. That’s because we’re searching for the best combination of all parameters, and since each parameter can influence what is optimal for the other parameters, the best combination might use a C value other than 10 or a penalty value other than l1.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Options for expanding the grid search:</strong></p>
<ul>
<li><strong>Initial idea:</strong> Set C=10 and penalty=‘l1’, then only search transformer parameters</li>
<li><strong>Better approach:</strong> Search for best combination of C, penalty, and transformer parameters</li>
</ul>
</div>
</div>
</div>
<p>All of that is to say that we’re going to expand the existing params dictionary to include transformer parameters. And to include transformer parameters, we first need to figure out the transformer names.</p>
<p>From the previous lesson, you might recall that the first step in the Pipeline is named columntransformer (all lowercase). We’ll access that step using the named_steps attribute, which then allows us to examine the named_transformers_ attribute of the ColumnTransformer.</p>
<p>As a side note, named_transformers_ ends with an underscore because it’s set during the fit step, whereas named_steps does not end with an underscore because it’s set when the Pipeline instance is created.</p>
<p>Anyway, we can now see the transformer names. We’re going to tune a single parameter from three of the transformers. Normally I might tune more parameters, but for the sake of brevity I’m only going to tune three.</p>
<div id="021f3d97" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pipe.named_steps[<span class="st">'columntransformer'</span>].named_transformers_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>{'pipeline': Pipeline(steps=[('simpleimputer',
                  SimpleImputer(fill_value='missing', strategy='constant')),
                 ('onehotencoder', OneHotEncoder())]),
 'countvectorizer': CountVectorizer(),
 'simpleimputer': SimpleImputer(),
 'passthrough': 'passthrough'}</code></pre>
</div>
</div>
<p>The first parameter we’re going to tune is the “drop” parameter of OneHotEncoder, which was added to scikit-learn in version 0.21 and which I discussed in <a href="ch03.html#sec-3-6" class="quarto-xref">lesson&nbsp;<span>3.6</span></a>.</p>
<p>To add it to the params dictionary, we specify the Pipeline step name, which is “columntransformer”. Then we specify the transformer name, which is “pipeline”. Then we specify the step name of the inner Pipeline, which is “onehotencoder”. Finally we specify the parameter name, which is “drop”. All of these components are separated by two underscores.</p>
<p>The parameter values we’re going to try are “None” and “first”. None is the default, and it means don’t drop any columns, whereas first means drop the first column of each feature after encoding.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>OneHotEncoder tuning parameter:</strong></p>
<ul>
<li><strong>drop:</strong> Method for dropping a column of each feature
<ul>
<li>None (default)</li>
<li>‘first’</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="acb14717" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>params[<span class="st">'columntransformer__pipeline__onehotencoder__drop'</span>] <span class="op">=</span> [<span class="va">None</span>, <span class="st">'first'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you’re ever unsure how to specify a parameter for a grid search, you can see all of the Pipeline’s parameters by using the get_params method followed by the keys method. I’m converting the output to a list for easier readability. This list is also useful if you prefer to copy and paste the parameter names rather than typing them.</p>
<p>As you can see, there are many transformer and model parameters that we’re not tuning, many of which could be useful to tune given enough time and computational resources.</p>
<div id="f94b3097" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(pipe.get_params().keys())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>['memory',
 'steps',
 'verbose',
 'columntransformer',
 'logisticregression',
 'columntransformer__n_jobs',
 'columntransformer__remainder',
 'columntransformer__sparse_threshold',
 'columntransformer__transformer_weights',
 'columntransformer__transformers',
 'columntransformer__verbose',
 'columntransformer__pipeline',
 'columntransformer__countvectorizer',
 'columntransformer__simpleimputer',
 'columntransformer__passthrough',
 'columntransformer__pipeline__memory',
 'columntransformer__pipeline__steps',
 'columntransformer__pipeline__verbose',
 'columntransformer__pipeline__simpleimputer',
 'columntransformer__pipeline__onehotencoder',
 'columntransformer__pipeline__simpleimputer__add_indicator',
 'columntransformer__pipeline__simpleimputer__copy',
 'columntransformer__pipeline__simpleimputer__fill_value',
 'columntransformer__pipeline__simpleimputer__missing_values',
 'columntransformer__pipeline__simpleimputer__strategy',
 'columntransformer__pipeline__simpleimputer__verbose',
 'columntransformer__pipeline__onehotencoder__categories',
 'columntransformer__pipeline__onehotencoder__drop',
 'columntransformer__pipeline__onehotencoder__dtype',
 'columntransformer__pipeline__onehotencoder__handle_unknown',
 'columntransformer__pipeline__onehotencoder__sparse',
 'columntransformer__countvectorizer__analyzer',
 'columntransformer__countvectorizer__binary',
 'columntransformer__countvectorizer__decode_error',
 'columntransformer__countvectorizer__dtype',
 'columntransformer__countvectorizer__encoding',
 'columntransformer__countvectorizer__input',
 'columntransformer__countvectorizer__lowercase',
 'columntransformer__countvectorizer__max_df',
 'columntransformer__countvectorizer__max_features',
 'columntransformer__countvectorizer__min_df',
 'columntransformer__countvectorizer__ngram_range',
 'columntransformer__countvectorizer__preprocessor',
 'columntransformer__countvectorizer__stop_words',
 'columntransformer__countvectorizer__strip_accents',
 'columntransformer__countvectorizer__token_pattern',
 'columntransformer__countvectorizer__tokenizer',
 'columntransformer__countvectorizer__vocabulary',
 'columntransformer__simpleimputer__add_indicator',
 'columntransformer__simpleimputer__copy',
 'columntransformer__simpleimputer__fill_value',
 'columntransformer__simpleimputer__missing_values',
 'columntransformer__simpleimputer__strategy',
 'columntransformer__simpleimputer__verbose',
 'logisticregression__C',
 'logisticregression__class_weight',
 'logisticregression__dual',
 'logisticregression__fit_intercept',
 'logisticregression__intercept_scaling',
 'logisticregression__l1_ratio',
 'logisticregression__max_iter',
 'logisticregression__multi_class',
 'logisticregression__n_jobs',
 'logisticregression__penalty',
 'logisticregression__random_state',
 'logisticregression__solver',
 'logisticregression__tol',
 'logisticregression__verbose',
 'logisticregression__warm_start']</code></pre>
</div>
</div>
<p>Moving along, the second parameter we’re going to tune is the “ngram_range” parameter of CountVectorizer.</p>
<p>Again, we specify the Pipeline step name, then the transformer name, and then the parameter name. Note that these three components are separated by double underscores, but there’s just a single underscore within ngram_range because that’s part of the parameter name.</p>
<p>The parameter values we’re going to try are the tuples (1, 1) and (1, 2). (1, 1) is the default, and it creates a single feature from each word. (1, 2) creates features from both single words, known as unigrams, and word pairs, known as bigrams.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>CountVectorizer tuning parameter:</strong></p>
<ul>
<li><strong>ngram_range:</strong> Selection of word n-grams to be extracted as features
<ul>
<li>(1, 1) (default)</li>
<li>(1, 2)</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="db192ad6" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>params[<span class="st">'columntransformer__countvectorizer__ngram_range'</span>] <span class="op">=</span> [(<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">1</span>, <span class="dv">2</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The third parameter we’re going to tune is the “add_indicator” parameter of SimpleImputer, which was added to scikit-learn in version 0.21 and which I discussed in <a href="ch07.html#sec-7-4" class="quarto-xref">lesson&nbsp;<span>7.4</span></a>.</p>
<p>Once again, we specify the Pipeline step name, then the transformer name, and then the parameter name.</p>
<p>The parameter values we’re going to try are “False” and “True”. False is the default, and it does not add a missing indicator column, whereas True does add a missing indicator column.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>SimpleImputer tuning parameter:</strong></p>
<ul>
<li><strong>add_indicator:</strong> Option to add a missing indicator column
<ul>
<li>False (default)</li>
<li>True</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="86cfd657" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>params[<span class="st">'columntransformer__simpleimputer__add_indicator'</span>] <span class="op">=</span> [<span class="va">False</span>, <span class="va">True</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before running the grid search, we’ll print out the params dictionary. By multiplying 2 by 3 by 2 by 2 by 2, we can calculate that there are now 48 parameter combinations, and thus the grid search will take about 8 times longer than the previous search.</p>
<p>As an aside, if we had used the Pipeline and ColumnTransformer classes instead of the make_pipeline and make_column_transformer functions, we could have customized the step names and transformer names, which would have made these parameter specifications a bit easier to read and write. You can watch <a href="ch04.html#sec-4-9" class="quarto-xref">lessons&nbsp;<span>4.9</span></a> and <a href="ch04.html#sec-4-10" class="quarto-xref"><span>4.10</span></a> for a review of that topic.</p>
<div id="ad1dc729" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>{'logisticregression__penalty': ['l1', 'l2'],
 'logisticregression__C': [0.1, 1, 10],
 'columntransformer__pipeline__onehotencoder__drop': [None, 'first'],
 'columntransformer__countvectorizer__ngram_range': [(1, 1), (1, 2)],
 'columntransformer__simpleimputer__add_indicator': [False, True]}</code></pre>
</div>
</div>
<p>Anyway, next we’ll recreate the grid object with the new params dictionary, and then we’ll run the grid search.</p>
<div id="e3ffcc1b" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(pipe, params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>grid.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8c2db9e0-14c8-4b17-b68b-1529613a50d1" type="checkbox"><label class="sk-toggleable__label" for="8c2db9e0-14c8-4b17-b68b-1529613a50d1">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        (...
                                        LogisticRegression(random_state=1,
                                                           solver='liblinear'))]),
             param_grid={'columntransformer__countvectorizer__ngram_range': [(1,
                                                                              1),
                                                                             (1,
                                                                              2)],
                         'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                              'first'],
                         'columntransformer__simpleimputer__add_indicator': [False,
                                                                             True],
                         'logisticregression__C': [0.1, 1, 10],
                         'logisticregression__penalty': ['l1', 'l2']},
             scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4bba37a5-b5b7-442c-88af-5d4a75347c95" type="checkbox"><label class="sk-toggleable__label" for="4bba37a5-b5b7-442c-88af-5d4a75347c95">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e7678196-1681-48d7-be1b-156e46e4470e" type="checkbox"><label class="sk-toggleable__label" for="e7678196-1681-48d7-be1b-156e46e4470e">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5f670634-4426-407c-a88f-79e95b4c5bce" type="checkbox"><label class="sk-toggleable__label" for="5f670634-4426-407c-a88f-79e95b4c5bce">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d6b63219-efee-4fee-a159-b2d2352bda6e" type="checkbox"><label class="sk-toggleable__label" for="d6b63219-efee-4fee-a159-b2d2352bda6e">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9fc5f9b1-782b-4f12-8054-ddd3b77bb430" type="checkbox"><label class="sk-toggleable__label" for="9fc5f9b1-782b-4f12-8054-ddd3b77bb430">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="46c4e9b6-9a51-42cc-985f-be37fb43442c" type="checkbox"><label class="sk-toggleable__label" for="46c4e9b6-9a51-42cc-985f-be37fb43442c">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ff08191e-c84b-4ec9-b07f-5a5aea504a42" type="checkbox"><label class="sk-toggleable__label" for="ff08191e-c84b-4ec9-b07f-5a5aea504a42">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c194303a-8a26-4be4-a129-29f8f603c874" type="checkbox"><label class="sk-toggleable__label" for="c194303a-8a26-4be4-a129-29f8f603c874">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c9433713-0651-4790-bf83-9ecba66461f9" type="checkbox"><label class="sk-toggleable__label" for="c9433713-0651-4790-bf83-9ecba66461f9">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7b858601-a1af-4486-8357-664fb40e32e1" type="checkbox"><label class="sk-toggleable__label" for="7b858601-a1af-4486-8357-664fb40e32e1">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="28266d08-dc39-4fd3-a8aa-c268a502ec91" type="checkbox"><label class="sk-toggleable__label" for="28266d08-dc39-4fd3-a8aa-c268a502ec91">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>Now that the search is complete, we’ll convert the search results into a DataFrame and sort it by the rank_test_score column.</p>
<p>As you can see from the mean_test_score column, the best accuracy of 0.828 is an improvement over the previous grid search, which had an accuracy of 0.818. Keep in mind that your exact results may differ based on your scikit-learn version along with other factors. However, there’s no randomness involved when you set cv to an integer, and so your results will be the same every time you run this grid search.</p>
<div id="3f58e776" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pd.DataFrame(grid.cv_results_).<span class="bu">filter</span>(regex<span class="op">=</span><span class="st">'param_|mean_test|rank'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>results.columns <span class="op">=</span> results.columns.<span class="bu">str</span>.split(<span class="st">'__'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>results.sort_values(<span class="st">'rank_test_score'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ngram_range</th>
<th data-quarto-table-cell-role="th">drop</th>
<th data-quarto-table-cell-role="th">add_indicator</th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">penalty</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>(1, 2)</td>
<td>None</td>
<td>True</td>
<td>10</td>
<td>l1</td>
<td>0.828253</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">28</td>
<td>(1, 2)</td>
<td>None</td>
<td>False</td>
<td>10</td>
<td>l1</td>
<td>0.824889</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>(1, 2)</td>
<td>first</td>
<td>False</td>
<td>10</td>
<td>l1</td>
<td>0.824889</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">46</td>
<td>(1, 2)</td>
<td>first</td>
<td>True</td>
<td>10</td>
<td>l1</td>
<td>0.822648</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>(1, 1)</td>
<td>first</td>
<td>False</td>
<td>10</td>
<td>l1</td>
<td>0.820407</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22</td>
<td>(1, 1)</td>
<td>first</td>
<td>True</td>
<td>10</td>
<td>l1</td>
<td>0.819296</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>(1, 1)</td>
<td>None</td>
<td>False</td>
<td>10</td>
<td>l1</td>
<td>0.818166</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>(1, 1)</td>
<td>None</td>
<td>True</td>
<td>10</td>
<td>l1</td>
<td>0.817061</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>(1, 1)</td>
<td>first</td>
<td>True</td>
<td>1</td>
<td>l1</td>
<td>0.814820</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>(1, 1)</td>
<td>None</td>
<td>False</td>
<td>1</td>
<td>l1</td>
<td>0.814814</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>(1, 2)</td>
<td>first</td>
<td>True</td>
<td>1</td>
<td>l1</td>
<td>0.813703</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>(1, 2)</td>
<td>first</td>
<td>True</td>
<td>10</td>
<td>l2</td>
<td>0.812598</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>(1, 1)</td>
<td>None</td>
<td>True</td>
<td>1</td>
<td>l1</td>
<td>0.812579</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>(1, 2)</td>
<td>first</td>
<td>False</td>
<td>1</td>
<td>l1</td>
<td>0.812579</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>(1, 1)</td>
<td>first</td>
<td>False</td>
<td>1</td>
<td>l1</td>
<td>0.812579</td>
<td>14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>(1, 2)</td>
<td>None</td>
<td>False</td>
<td>1</td>
<td>l1</td>
<td>0.812567</td>
<td>16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>(1, 1)</td>
<td>None</td>
<td>True</td>
<td>10</td>
<td>l2</td>
<td>0.811481</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>(1, 1)</td>
<td>first</td>
<td>True</td>
<td>1</td>
<td>l2</td>
<td>0.811468</td>
<td>18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>(1, 1)</td>
<td>None</td>
<td>False</td>
<td>1</td>
<td>l2</td>
<td>0.811462</td>
<td>19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>(1, 1)</td>
<td>first</td>
<td>True</td>
<td>10</td>
<td>l2</td>
<td>0.810363</td>
<td>20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>(1, 1)</td>
<td>None</td>
<td>True</td>
<td>1</td>
<td>l2</td>
<td>0.810345</td>
<td>21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>(1, 1)</td>
<td>first</td>
<td>False</td>
<td>1</td>
<td>l2</td>
<td>0.810332</td>
<td>22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>(1, 2)</td>
<td>None</td>
<td>True</td>
<td>1</td>
<td>l1</td>
<td>0.810332</td>
<td>22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>(1, 1)</td>
<td>first</td>
<td>False</td>
<td>10</td>
<td>l2</td>
<td>0.809234</td>
<td>24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35</td>
<td>(1, 2)</td>
<td>None</td>
<td>True</td>
<td>10</td>
<td>l2</td>
<td>0.809234</td>
<td>24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>(1, 1)</td>
<td>None</td>
<td>False</td>
<td>10</td>
<td>l2</td>
<td>0.809234</td>
<td>24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">29</td>
<td>(1, 2)</td>
<td>None</td>
<td>False</td>
<td>10</td>
<td>l2</td>
<td>0.808104</td>
<td>27</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>(1, 2)</td>
<td>first</td>
<td>True</td>
<td>1</td>
<td>l2</td>
<td>0.808097</td>
<td>28</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">41</td>
<td>(1, 2)</td>
<td>first</td>
<td>False</td>
<td>10</td>
<td>l2</td>
<td>0.806980</td>
<td>29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>(1, 2)</td>
<td>first</td>
<td>False</td>
<td>1</td>
<td>l2</td>
<td>0.805844</td>
<td>30</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>(1, 2)</td>
<td>None</td>
<td>False</td>
<td>1</td>
<td>l2</td>
<td>0.805844</td>
<td>30</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>(1, 2)</td>
<td>None</td>
<td>True</td>
<td>1</td>
<td>l2</td>
<td>0.804739</td>
<td>32</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>(1, 2)</td>
<td>None</td>
<td>True</td>
<td>0.1</td>
<td>l2</td>
<td>0.793491</td>
<td>33</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>(1, 1)</td>
<td>None</td>
<td>True</td>
<td>0.1</td>
<td>l2</td>
<td>0.793484</td>
<td>34</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>(1, 1)</td>
<td>first</td>
<td>True</td>
<td>0.1</td>
<td>l2</td>
<td>0.791243</td>
<td>35</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>(1, 2)</td>
<td>first</td>
<td>True</td>
<td>0.1</td>
<td>l2</td>
<td>0.790114</td>
<td>36</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">37</td>
<td>(1, 2)</td>
<td>first</td>
<td>False</td>
<td>0.1</td>
<td>l2</td>
<td>0.789003</td>
<td>37</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>(1, 2)</td>
<td>None</td>
<td>False</td>
<td>0.1</td>
<td>l2</td>
<td>0.788996</td>
<td>38</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>(1, 1)</td>
<td>None</td>
<td>False</td>
<td>0.1</td>
<td>l2</td>
<td>0.788990</td>
<td>39</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>(1, 1)</td>
<td>first</td>
<td>False</td>
<td>0.1</td>
<td>l2</td>
<td>0.787885</td>
<td>40</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>(1, 1)</td>
<td>None</td>
<td>False</td>
<td>0.1</td>
<td>l1</td>
<td>0.783385</td>
<td>41</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30</td>
<td>(1, 2)</td>
<td>None</td>
<td>True</td>
<td>0.1</td>
<td>l1</td>
<td>0.783385</td>
<td>41</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>(1, 2)</td>
<td>None</td>
<td>False</td>
<td>0.1</td>
<td>l1</td>
<td>0.783385</td>
<td>41</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>(1, 1)</td>
<td>None</td>
<td>True</td>
<td>0.1</td>
<td>l1</td>
<td>0.783385</td>
<td>41</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>(1, 2)</td>
<td>first</td>
<td>False</td>
<td>0.1</td>
<td>l1</td>
<td>0.777785</td>
<td>45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">42</td>
<td>(1, 2)</td>
<td>first</td>
<td>True</td>
<td>0.1</td>
<td>l1</td>
<td>0.777785</td>
<td>45</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>(1, 1)</td>
<td>first</td>
<td>False</td>
<td>0.1</td>
<td>l1</td>
<td>0.777785</td>
<td>45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>(1, 1)</td>
<td>first</td>
<td>True</td>
<td>0.1</td>
<td>l1</td>
<td>0.777785</td>
<td>45</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> <mark>0.828</mark></li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
<p>Rather than always examining the results DataFrame, we can actually just access the single best score and the set of parameters that resulted in that score via attributes of the grid object.</p>
<p>It’s worth noting that only the drop parameter is using its default value, whereas the other four parameters are not using their default values.</p>
<div id="e0bdc94c" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>grid.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>0.828253091456908</code></pre>
</div>
</div>
<div id="c9abea5f" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>grid.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>{'columntransformer__countvectorizer__ngram_range': (1, 2),
 'columntransformer__pipeline__onehotencoder__drop': None,
 'columntransformer__simpleimputer__add_indicator': True,
 'logisticregression__C': 10,
 'logisticregression__penalty': 'l1'}</code></pre>
</div>
</div>
<p>It’s hard to say whether this truly is the best set of parameters, because some of the differences in accuracy between parameter combinations may be due to chance, based on which samples happened to appear in each fold. That’s just a limitation of basic cross-validation, and so all we can say with confidence is that this is a good combination of parameters.</p>
</section>
<section id="using-the-best-pipeline-to-make-predictions" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="using-the-best-pipeline-to-make-predictions"><span class="header-section-number">10.5</span> Using the best Pipeline to make predictions</h2>
<p>Now that we’ve tuned both the model parameters and the transformer parameters, we want to use those parameters with the Pipeline when making predictions.</p>
<p>GridSearchCV actually makes this very easy. After locating the best set of parameters, it automatically refits the Pipeline on X and y using the best set of parameters, and it stores that fitted Pipeline as an attribute called best_estimator_. And as you can see, that attribute is indeed a Pipeline object.</p>
<div id="94b70941" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(grid.best_estimator_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>sklearn.pipeline.Pipeline</code></pre>
</div>
</div>
<p>If we print out the best_estimator_ attribute and click on the components, we can see that the parameters of this Pipeline match the best parameter set we located in the previous lesson.</p>
<div id="b6f4463c" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7040dcb8-4d69-4864-a83f-1f661b9fae43" type="checkbox"><label class="sk-toggleable__label" for="7040dcb8-4d69-4864-a83f-1f661b9fae43">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('simpleimputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehotencoder',
                                                                   OneHotEncoder())]),
                                                  ['Embarked', 'Sex']),
                                                 ('countvectorizer',
                                                  CountVectorizer(ngram_range=(1,
                                                                               2)),
                                                  'Name'),
                                                 ('simpleimputer',
                                                  SimpleImputer(add_indicator=True),
                                                  ['Age', 'Fare']),
                                                 ('passthrough', 'passthrough',
                                                  ['Parch'])])),
                ('logisticregression',
                 LogisticRegression(C=10, penalty='l1', random_state=1,
                                    solver='liblinear'))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3701f368-96cc-42e2-a2ad-bb0130f3c366" type="checkbox"><label class="sk-toggleable__label" for="3701f368-96cc-42e2-a2ad-bb0130f3c366">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer',
                                 CountVectorizer(ngram_range=(1, 2)), 'Name'),
                                ('simpleimputer',
                                 SimpleImputer(add_indicator=True),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f2f9cf29-6372-4e0b-8792-7e09d25cae53" type="checkbox"><label class="sk-toggleable__label" for="f2f9cf29-6372-4e0b-8792-7e09d25cae53">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="90a27186-fd13-496f-934b-b1aa6dbe3ddd" type="checkbox"><label class="sk-toggleable__label" for="90a27186-fd13-496f-934b-b1aa6dbe3ddd">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9abdcf7b-0bc6-4938-a149-bbd72e59dec8" type="checkbox"><label class="sk-toggleable__label" for="9abdcf7b-0bc6-4938-a149-bbd72e59dec8">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a52ee488-5d9c-435c-9824-835d7352c07b" type="checkbox"><label class="sk-toggleable__label" for="a52ee488-5d9c-435c-9824-835d7352c07b">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="93424715-f8f5-43b8-a890-8303778f3f61" type="checkbox"><label class="sk-toggleable__label" for="93424715-f8f5-43b8-a890-8303778f3f61">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer(ngram_range=(1, 2))</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b5d5587e-0cb9-43ae-af21-9eb9b3424ed1" type="checkbox"><label class="sk-toggleable__label" for="b5d5587e-0cb9-43ae-af21-9eb9b3424ed1">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="de1dcbd1-020a-4f82-b660-9e18ca87d529" type="checkbox"><label class="sk-toggleable__label" for="de1dcbd1-020a-4f82-b660-9e18ca87d529">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(add_indicator=True)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7f311756-0109-4728-be63-9cfb340a6c7e" type="checkbox"><label class="sk-toggleable__label" for="7f311756-0109-4728-be63-9cfb340a6c7e">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3b5112e4-d4a2-463c-98d2-e525e431e99e" type="checkbox"><label class="sk-toggleable__label" for="3b5112e4-d4a2-463c-98d2-e525e431e99e">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="72769ec1-f876-4ecb-ab05-7ceb5b53f349" type="checkbox"><label class="sk-toggleable__label" for="72769ec1-f876-4ecb-ab05-7ceb5b53f349">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(C=10, penalty='l1', random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>In order to make predictions using this Pipeline, all we have to do is run the grid object’s predict method, which calls the predict method of the best_estimator_, and pass it X_new.</p>
<div id="4deec829" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>grid.predict(X_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>array([0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1,
       1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1,
       1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1,
       1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1,
       1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0,
       0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1,
       1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1,
       1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1,
       0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0,
       1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1,
       1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1,
       0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0,
       0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1,
       0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0,
       1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0,
       1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1,
       0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1])</code></pre>
</div>
</div>
<p>I just want to emphasize that this Pipeline, with the best set of parameters, was automatically refit to the entire dataset. You always train your model on the entire dataset, meaning all samples for which you know the target value, before using it to make predictions on new data, otherwise you’re throwing away valuable training data.</p>
</section>
<section id="qa-how-do-i-save-the-best-pipeline-for-future-use" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="qa-how-do-i-save-the-best-pipeline-for-future-use"><span class="header-section-number">10.6</span> Q&amp;A: How do I save the best Pipeline for future use?</h2>
<p>After completing a grid search, you may want to save the Pipeline with the best set of parameters so that you can use it to make predictions later.</p>
<p>As we saw in the previous lesson, the Pipeline with the best set of parameters is stored as an attribute of the GridSearchCV object called best_estimator_, so this is the object that we want to save.</p>
<div id="0589e7de" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(grid.best_estimator_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>sklearn.pipeline.Pipeline</code></pre>
</div>
</div>
<p>You can save a Pipeline to a file using pickle, which is part of the Python standard library.</p>
<div id="b4a02fbd" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll use pickle’s dump method to save the Pipeline to a file called “pipe.pickle”.</p>
<div id="25766af7" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'pipe.pickle'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    pickle.dump(grid.best_estimator_, f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we can use pickle’s load method to load the Pipeline from the pipe.pickle file into an object called pipe_from_pickle.</p>
<div id="aea20a08" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'pipe.pickle'</span>, <span class="st">'rb'</span>) <span class="im">as</span> f:</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    pipe_from_pickle <span class="op">=</span> pickle.load(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>pipe_from_pickle is identical to grid.best_estimator_, and so when we use pipe_from_pickle to make predictions, these predictions are identical to the predictions made by the grid object.</p>
<div id="7e949309" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>pipe_from_pickle.predict(X_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>array([0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1,
       1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1,
       1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1,
       1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1,
       1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0,
       0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1,
       1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1,
       1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1,
       0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0,
       1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1,
       1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1,
       0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0,
       0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1,
       0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0,
       1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0,
       1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1,
       0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1])</code></pre>
</div>
</div>
<p>One alternative to pickle is joblib, which is usually more efficient than pickle for scikit-learn objects. Although it’s not part of the Python standard library, joblib has been a dependency of scikit-learn since version 0.21.</p>
<div id="6ec8a72b" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> joblib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Just like pickle, you use joblib’s dump method to save the Pipeline to a file, which we’ll call “pipe.joblib”.</p>
<div id="9364372c" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>joblib.dump(grid.best_estimator_, <span class="st">'pipe.joblib'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>['pipe.joblib']</code></pre>
</div>
</div>
<p>Then, we’ll use the load method to load the Pipeline from the file into an object called pipe_from_joblib.</p>
<div id="8ce9d8c8" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>pipe_from_joblib <span class="op">=</span> joblib.load(<span class="st">'pipe.joblib'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we’ll use pipe_from_joblib to make predictions.</p>
<div id="e88ad073" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>pipe_from_joblib.predict(X_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>array([0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1,
       1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1,
       1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1,
       1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1,
       1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0,
       0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1,
       1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1,
       1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1,
       0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0,
       1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1,
       1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1,
       0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0,
       0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1,
       0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0,
       1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0,
       1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1,
       0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1])</code></pre>
</div>
</div>
<p>To be clear, pickle and joblib are not limited to Pipelines and can be used with other scikit-learn objects, such as a standalone model object that is not inside a Pipeline.</p>
<p>There are a couple warnings to keep in mind when working with pickle and joblib objects:</p>
<ul>
<li>First, the objects may be version-specific and architecture-specific. As such, you should only load them into an identical environment, meaning the same versions of scikit-learn and its dependencies, using the identical computing architecture.</li>
<li>Second, these objects can be poisoned with malicious code, and so you should only load objects from a trusted source.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Warnings for pickle and joblib objects:</strong></p>
<ul>
<li>May be version-specific and architecture-specific</li>
<li>Can be poisoned with malicious code</li>
</ul>
</div>
</div>
</div>
<p>Finally, it’s worth mentioning that there are alternatives to pickle and joblib such as ONNX and PMML. These formats don’t capture the full model object, but instead save a representation that can be used to make predictions. One major benefit of these formats is that they are neither environment-specific nor architecture-specific.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Alternatives to pickle and joblib:</strong></p>
<ul>
<li>Examples: ONNX, PMML</li>
<li>Save a model representation for making predictions</li>
<li>Work across environments and architectures</li>
</ul>
</div>
</div>
</div>
</section>
<section id="qa-how-do-i-speed-up-a-grid-search" class="level2" data-number="10.7">
<h2 data-number="10.7" class="anchored" data-anchor-id="qa-how-do-i-speed-up-a-grid-search"><span class="header-section-number">10.7</span> Q&amp;A: How do I speed up a grid search?</h2>
<p>Let’s recreate the GridSearchCV object, but this time we’ll add the verbose parameter and set it to 1. When we run the search, this parameter will cause two changes to the output:</p>
<ul>
<li>First, it will calculate the number of parameter combinations for you, which is 48. Since this is 5-fold cross-validation, that means the Pipeline will be fit 240 times.</li>
<li>Second, it will report back how long the search took, and sometimes it will give you progress updates along the way.</li>
</ul>
<div id="0a2cfec8" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(pipe, params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>grid.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting 5 folds for each of 48 candidates, totalling 240 fits</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Parallel(n_jobs=1)]: Done  49 tasks      | elapsed:    0.5s
[Parallel(n_jobs=1)]: Done 199 tasks      | elapsed:    2.4s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="31">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6d1f61d8-fff4-4d3d-9354-243733ea80b6" type="checkbox"><label class="sk-toggleable__label" for="6d1f61d8-fff4-4d3d-9354-243733ea80b6">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        (...
                                        LogisticRegression(random_state=1,
                                                           solver='liblinear'))]),
             param_grid={'columntransformer__countvectorizer__ngram_range': [(1,
                                                                              1),
                                                                             (1,
                                                                              2)],
                         'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                              'first'],
                         'columntransformer__simpleimputer__add_indicator': [False,
                                                                             True],
                         'logisticregression__C': [0.1, 1, 10],
                         'logisticregression__penalty': ['l1', 'l2']},
             scoring='accuracy', verbose=1)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="30c59b54-1cdd-40a8-8b03-87ae972bef75" type="checkbox"><label class="sk-toggleable__label" for="30c59b54-1cdd-40a8-8b03-87ae972bef75">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="10b5d812-f0bf-46a5-83d0-7f46056f6e11" type="checkbox"><label class="sk-toggleable__label" for="10b5d812-f0bf-46a5-83d0-7f46056f6e11">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ba0c57c6-4f64-4602-b470-719a37831c03" type="checkbox"><label class="sk-toggleable__label" for="ba0c57c6-4f64-4602-b470-719a37831c03">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f3bf278e-575a-46cf-858c-505d984959ff" type="checkbox"><label class="sk-toggleable__label" for="f3bf278e-575a-46cf-858c-505d984959ff">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="72d080a9-c683-4999-adcc-dfeb543444ea" type="checkbox"><label class="sk-toggleable__label" for="72d080a9-c683-4999-adcc-dfeb543444ea">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="28f9a853-cf38-4c77-aea7-a0343238098d" type="checkbox"><label class="sk-toggleable__label" for="28f9a853-cf38-4c77-aea7-a0343238098d">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5d0d025e-c949-408b-8fdd-a0fca14eedf4" type="checkbox"><label class="sk-toggleable__label" for="5d0d025e-c949-408b-8fdd-a0fca14eedf4">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="dc58ccfd-5e03-4cf6-b213-edf6b1c01965" type="checkbox"><label class="sk-toggleable__label" for="dc58ccfd-5e03-4cf6-b213-edf6b1c01965">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="67a5bb77-09a3-4772-ad60-7d105ec8a68a" type="checkbox"><label class="sk-toggleable__label" for="67a5bb77-09a3-4772-ad60-7d105ec8a68a">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="57d3d3f8-f5d4-4fab-a084-9ffd3e1d6599" type="checkbox"><label class="sk-toggleable__label" for="57d3d3f8-f5d4-4fab-a084-9ffd3e1d6599">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fce1e0d5-f215-44da-9192-6476a61c974b" type="checkbox"><label class="sk-toggleable__label" for="fce1e0d5-f215-44da-9192-6476a61c974b">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>Now, let’s also add the n_jobs parameter, set it to -1, and re-run the grid search. This instructs scikit-learn to use parallel processing with all of your CPUs to perform the search. If your machine has multiple processors, this will generally be faster, though in this case it took about the same amount of time.</p>
<div id="1a246014" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(pipe, params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>, verbose<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                    n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>grid.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting 5 folds for each of 48 candidates, totalling 240 fits</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 8 concurrent workers.
[Parallel(n_jobs=-1)]: Done  34 tasks      | elapsed:    1.7s
[Parallel(n_jobs=-1)]: Done 225 out of 240 | elapsed:    2.2s remaining:    0.1s
[Parallel(n_jobs=-1)]: Done 240 out of 240 | elapsed:    2.2s finished</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="33">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="adaad44f-fbf3-4acc-bedd-17d6902a24fe" type="checkbox"><label class="sk-toggleable__label" for="adaad44f-fbf3-4acc-bedd-17d6902a24fe">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        (...
                                        LogisticRegression(random_state=1,
                                                           solver='liblinear'))]),
             n_jobs=-1,
             param_grid={'columntransformer__countvectorizer__ngram_range': [(1,
                                                                              1),
                                                                             (1,
                                                                              2)],
                         'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                              'first'],
                         'columntransformer__simpleimputer__add_indicator': [False,
                                                                             True],
                         'logisticregression__C': [0.1, 1, 10],
                         'logisticregression__penalty': ['l1', 'l2']},
             scoring='accuracy', verbose=1)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="da3fcaa2-6192-4bb3-bf67-5468a9c684fb" type="checkbox"><label class="sk-toggleable__label" for="da3fcaa2-6192-4bb3-bf67-5468a9c684fb">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5aac6189-a6c5-4601-a8cd-323a3a68613c" type="checkbox"><label class="sk-toggleable__label" for="5aac6189-a6c5-4601-a8cd-323a3a68613c">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bd3f3846-b8fc-40ed-8179-d7b3d49d99c5" type="checkbox"><label class="sk-toggleable__label" for="bd3f3846-b8fc-40ed-8179-d7b3d49d99c5">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="eb6f9737-585d-4e33-bdd2-c679fb7102b0" type="checkbox"><label class="sk-toggleable__label" for="eb6f9737-585d-4e33-bdd2-c679fb7102b0">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="33a4b2b7-f92f-4565-b56b-46dfb898f84b" type="checkbox"><label class="sk-toggleable__label" for="33a4b2b7-f92f-4565-b56b-46dfb898f84b">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f1989676-1a40-4b43-acae-c0b008a6d79a" type="checkbox"><label class="sk-toggleable__label" for="f1989676-1a40-4b43-acae-c0b008a6d79a">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="70fbe098-939f-4e9f-ae84-ade2fd02bb0b" type="checkbox"><label class="sk-toggleable__label" for="70fbe098-939f-4e9f-ae84-ade2fd02bb0b">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="71254c1d-c890-4c29-8382-f39c19286935" type="checkbox"><label class="sk-toggleable__label" for="71254c1d-c890-4c29-8382-f39c19286935">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8aee03ab-4f27-4ab7-88c8-e7adba768e1a" type="checkbox"><label class="sk-toggleable__label" for="8aee03ab-4f27-4ab7-88c8-e7adba768e1a">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a1e33ad3-79dc-4acf-a5e0-1c44ca4904f1" type="checkbox"><label class="sk-toggleable__label" for="a1e33ad3-79dc-4acf-a5e0-1c44ca4904f1">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a532607f-68a2-4cc7-a469-382e988e6e67" type="checkbox"><label class="sk-toggleable__label" for="a532607f-68a2-4cc7-a469-382e988e6e67">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>If you find it useful to know how long a search takes, but verbose mode is a bit too verbose for you, another option is to remove the verbose parameter and instead prefix the second line with “%time”. This is known as an IPython line magic, and it will work as long as you’re using the Jupyter notebook or the IPython interpreter.</p>
<p>All this command does is tell you how long a particular line of code took to run. The number to focus on is the wall time.</p>
<div id="cfc82fa6" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(pipe, params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time grid.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 219 ms, sys: 7.8 ms, total: 227 ms
Wall time: 680 ms</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="35">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7aefd543-74c0-483a-a940-91d67c220597" type="checkbox"><label class="sk-toggleable__label" for="7aefd543-74c0-483a-a940-91d67c220597">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        (...
                                        LogisticRegression(random_state=1,
                                                           solver='liblinear'))]),
             n_jobs=-1,
             param_grid={'columntransformer__countvectorizer__ngram_range': [(1,
                                                                              1),
                                                                             (1,
                                                                              2)],
                         'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                              'first'],
                         'columntransformer__simpleimputer__add_indicator': [False,
                                                                             True],
                         'logisticregression__C': [0.1, 1, 10],
                         'logisticregression__penalty': ['l1', 'l2']},
             scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="09a0f54c-8cdb-4169-9f78-a3a3666ddbe1" type="checkbox"><label class="sk-toggleable__label" for="09a0f54c-8cdb-4169-9f78-a3a3666ddbe1">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c0333015-a094-458f-a0dc-944ba39fc20c" type="checkbox"><label class="sk-toggleable__label" for="c0333015-a094-458f-a0dc-944ba39fc20c">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5c365c51-972b-4622-9ac0-4ec499089ffd" type="checkbox"><label class="sk-toggleable__label" for="5c365c51-972b-4622-9ac0-4ec499089ffd">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="52f7e100-14e0-4289-8834-aaeb526947ed" type="checkbox"><label class="sk-toggleable__label" for="52f7e100-14e0-4289-8834-aaeb526947ed">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b553e9a3-fa1c-449e-b041-817f056f734c" type="checkbox"><label class="sk-toggleable__label" for="b553e9a3-fa1c-449e-b041-817f056f734c">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fc3a23f2-7424-4c28-aff6-4aa48d352f5d" type="checkbox"><label class="sk-toggleable__label" for="fc3a23f2-7424-4c28-aff6-4aa48d352f5d">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a300f2c8-8119-49d8-a8d8-0fd19af26558" type="checkbox"><label class="sk-toggleable__label" for="a300f2c8-8119-49d8-a8d8-0fd19af26558">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5e3773b9-4687-4479-aecb-5a0284f9b872" type="checkbox"><label class="sk-toggleable__label" for="5e3773b9-4687-4479-aecb-5a0284f9b872">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f5ae5711-9cbf-4569-8bd1-b8cd277e4d2e" type="checkbox"><label class="sk-toggleable__label" for="f5ae5711-9cbf-4569-8bd1-b8cd277e4d2e">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9b4a2266-caa8-454a-b985-40d8f787530d" type="checkbox"><label class="sk-toggleable__label" for="9b4a2266-caa8-454a-b985-40d8f787530d">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="03528519-3bbd-478d-b5a1-79c001d59d1c" type="checkbox"><label class="sk-toggleable__label" for="03528519-3bbd-478d-b5a1-79c001d59d1c">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>My general recommendation is to set n_jobs to -1 any time you’re running a grid search, which is what I’ll do for the rest of the book. However, it’s still a good idea to use %time or verbose mode to confirm that parallel processing is actually reducing the search time on your particular machine.</p>
</section>
<section id="qa-how-do-i-tune-a-pipeline-with-randomized-search" class="level2" data-number="10.8">
<h2 data-number="10.8" class="anchored" data-anchor-id="qa-how-do-i-tune-a-pipeline-with-randomized-search"><span class="header-section-number">10.8</span> Q&amp;A: How do I tune a Pipeline with randomized search?</h2>
<p>When you provide a set of parameter values to GridSearchCV, it will cross-validate every possible combination of those parameters. For example, we know that with this set of parameters, cross-validation will run 48 times.</p>
<div id="61b327cc" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>{'logisticregression__penalty': ['l1', 'l2'],
 'logisticregression__C': [0.1, 1, 10],
 'columntransformer__pipeline__onehotencoder__drop': [None, 'first'],
 'columntransformer__countvectorizer__ngram_range': [(1, 1), (1, 2)],
 'columntransformer__simpleimputer__add_indicator': [False, True]}</code></pre>
</div>
</div>
<p>Let’s say that we wanted to try additional C values for logistic regression. I’ll make a copy of the params dictionary called more_params, and then modify the C parameter in this dictionary to have 6 possible values instead of 3.</p>
<div id="5cf5d956" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>more_params <span class="op">=</span> params.copy()</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>more_params[<span class="st">'logisticregression__C'</span>] <span class="op">=</span> [<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since there are twice as many C values, we know that a grid search will take twice as long, meaning it will run cross-validation 96 times. But what if that grid search takes more time than we have available?</p>
<p>An alternative method we can use is called randomized search, which is implemented in the RandomizedSearchCV class. We’ll import it from the model_selection module and then create an instance.</p>
<p>The API is very similar to GridSearchCV, except that you also specify the number of times it should run using the n_iter parameter. In this case, we’ll set the number of iterations to be 10.</p>
<p>Each time it runs, it will pick out a set of parameters at random and cross-validate that parameter set. In other words, it does the same thing as GridSearchCV, except that it picks out random combinations of parameters from the parameter dictionary rather than trying every single combination. Because there’s an element of randomness, we’ll also set the random_state parameter to 1 for reproducibility.</p>
<p>We’ll use the fit method to run the search, and because it will only try 10 combinations instead of 96 combinations, it will run about 10 times faster than a grid search would.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>How to use RandomizedSearchCV:</strong></p>
<ul>
<li><strong>n_iter:</strong> Specify the number of randomly-chosen parameter combinations to cross-validate</li>
<li><strong>random_state:</strong> Set to any integer for reproducibility</li>
</ul>
</div>
</div>
</div>
<div id="4e9b4c28" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> RandomizedSearchCV</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>rand <span class="op">=</span> RandomizedSearchCV(pipe, more_params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                          n_iter<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">1</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>rand.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bd6b9c3b-f788-4076-a0e7-daa7b0ae2045" type="checkbox"><label class="sk-toggleable__label" for="bd6b9c3b-f788-4076-a0e7-daa7b0ae2045">RandomizedSearchCV</label><div class="sk-toggleable__content"><pre>RandomizedSearchCV(cv=5,
                   estimator=Pipeline(steps=[('columntransformer',
                                              ColumnTransformer(transformers=[('pipeline',
                                                                               Pipeline(steps=[('simpleimputer',
                                                                                                SimpleImputer(fill_value='missing',
                                                                                                              strategy='constant')),
                                                                                               ('onehotencoder',
                                                                                                OneHotEncoder())]),
                                                                               ['Embarked',
                                                                                'Sex']),
                                                                              ('countvectorizer',
                                                                               CountVectorizer(),
                                                                               'Name'),
                                                                              ('simpleimputer',
                                                                               SimpleImputer(),
                                                                               ['Age',
                                                                                'Far...
                   n_jobs=-1,
                   param_distributions={'columntransformer__countvectorizer__ngram_range': [(1,
                                                                                             1),
                                                                                            (1,
                                                                                             2)],
                                        'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                                             'first'],
                                        'columntransformer__simpleimputer__add_indicator': [False,
                                                                                            True],
                                        'logisticregression__C': [0.01, 0.1, 1,
                                                                  10, 100,
                                                                  1000],
                                        'logisticregression__penalty': ['l1',
                                                                        'l2']},
                   random_state=1, scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4f7f77fc-74b0-4215-9907-b3ff182c4c86" type="checkbox"><label class="sk-toggleable__label" for="4f7f77fc-74b0-4215-9907-b3ff182c4c86">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5febb40e-df45-4770-a7fe-e921e8df4a7c" type="checkbox"><label class="sk-toggleable__label" for="5febb40e-df45-4770-a7fe-e921e8df4a7c">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9d396cb9-a000-4e42-9432-3a8e4f1768af" type="checkbox"><label class="sk-toggleable__label" for="9d396cb9-a000-4e42-9432-3a8e4f1768af">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a767f2c9-fd4b-4ebd-a866-0e9252515486" type="checkbox"><label class="sk-toggleable__label" for="a767f2c9-fd4b-4ebd-a866-0e9252515486">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="44cd1efc-3e97-4ac7-9cd2-a129cb6e1bad" type="checkbox"><label class="sk-toggleable__label" for="44cd1efc-3e97-4ac7-9cd2-a129cb6e1bad">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="62ea5cf1-ced5-4aac-ab09-1a0ce8fca333" type="checkbox"><label class="sk-toggleable__label" for="62ea5cf1-ced5-4aac-ab09-1a0ce8fca333">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="19d1c709-bcf5-4a9c-9fa0-cc9a920d832a" type="checkbox"><label class="sk-toggleable__label" for="19d1c709-bcf5-4a9c-9fa0-cc9a920d832a">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9ef72c7c-8c49-40ea-997b-b6d0b41ad2b7" type="checkbox"><label class="sk-toggleable__label" for="9ef72c7c-8c49-40ea-997b-b6d0b41ad2b7">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="98353662-f052-4d37-92d1-4f2a38573c9e" type="checkbox"><label class="sk-toggleable__label" for="98353662-f052-4d37-92d1-4f2a38573c9e">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6808e86d-cdcb-4d9e-ba7e-34914cb65b54" type="checkbox"><label class="sk-toggleable__label" for="6808e86d-cdcb-4d9e-ba7e-34914cb65b54">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="96d53463-f298-4008-8684-68ca8ebbe273" type="checkbox"><label class="sk-toggleable__label" for="96d53463-f298-4008-8684-68ca8ebbe273">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>By printing out the results of the search, you can see that it ran 10 times using random combinations of all of those parameters.</p>
<div id="46db2598" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pd.DataFrame(rand.cv_results_).<span class="bu">filter</span>(regex<span class="op">=</span><span class="st">'param_|mean_test|rank'</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>results.columns <span class="op">=</span> results.columns.<span class="bu">str</span>.split(<span class="st">'__'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">penalty</th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">add_indicator</th>
<th data-quarto-table-cell-role="th">drop</th>
<th data-quarto-table-cell-role="th">ngram_range</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>l1</td>
<td>1</td>
<td>True</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.814820</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>l2</td>
<td>10</td>
<td>False</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.809234</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>l1</td>
<td>1000</td>
<td>True</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.811437</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>l2</td>
<td>1000</td>
<td>False</td>
<td>None</td>
<td>(1, 2)</td>
<td>0.810345</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>l1</td>
<td>10</td>
<td>False</td>
<td>first</td>
<td>(1, 2)</td>
<td>0.824889</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>l1</td>
<td>0.1</td>
<td>False</td>
<td>first</td>
<td>(1, 2)</td>
<td>0.777785</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>l2</td>
<td>1</td>
<td>True</td>
<td>None</td>
<td>(1, 2)</td>
<td>0.804739</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>l1</td>
<td>100</td>
<td>True</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.813684</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>l1</td>
<td>100</td>
<td>False</td>
<td>first</td>
<td>(1, 2)</td>
<td>0.827129</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>l2</td>
<td>0.01</td>
<td>True</td>
<td>first</td>
<td>(1, 2)</td>
<td>0.744184</td>
<td>10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You might be surprised to know that the best score it found, 0.827, is almost as high as the best score found by our grid search earlier in the chapter, which was 0.828. That being said, we did try additional C values in our randomized search, so the comparison isn’t entirely fair.</p>
<div id="261f47e3" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>rand.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>0.8271294959512898</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> 0.828</li>
<li><strong>Randomized search (more C values):</strong> <mark>0.827</mark></li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
<p>Here’s the set of parameters that produced that score.</p>
<div id="b55161be" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>rand.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>{'logisticregression__penalty': 'l1',
 'logisticregression__C': 100,
 'columntransformer__simpleimputer__add_indicator': False,
 'columntransformer__pipeline__onehotencoder__drop': 'first',
 'columntransformer__countvectorizer__ngram_range': (1, 2)}</code></pre>
</div>
</div>
<p>There are four things I especially like about using a randomized search instead of a grid search:</p>
<p>Number 1. Because there are often a lot of parameter combinations that will produce similar results, randomized search will usually find the best result (or almost the best result) in far less time than grid search, which is what we saw above.</p>
<p>Number 2. It’s easier to control the computational budget of a randomized search. You can test how long a small number of searches takes, and then if you have a certain amount of time available for a search, you can simply choose the number of iterations that can be completed within that time period.</p>
<p>Number 3. Randomized search gives you the freedom to tune many more model and transformer parameters without worrying that it will take forever. You can try out a ton of different parameters for a short amount of time, and then narrow down which parameters to focus on based on what seems to be working. We’ll see this in practice in the next chapter.</p>
<p>Number 4. Randomized search will sometimes produce even better results than grid search because you can try a finer grid. For example, let’s say you were tuning a parameter that allowed continuous values from 0 to 1. If you were using a grid search, you might try the values 0, 0.5, and 1. But if you were using randomized search, you might try the values 0, 0.01, 0.02, and so on. It may turn out that the best value for this parameter is around 0.3, and randomized search could help you to find that out, whereas this grid search would have no chance of finding that out.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Why use RandomizedSearchCV instead of GridSearchCV?</strong></p>
<ul>
<li>Similar results in far less time</li>
<li>Easier to control the computational budget</li>
<li>Freedom to tune many more parameters</li>
<li>Can use a much finer grid</li>
</ul>
</div>
</div>
</div>
<p>If you do need to create a fine grid of numbers for a randomized search, one useful function is NumPy’s linspace. For example, this code specifies that I want 101 equally spaced values, starting with 0 and ending with 1.</p>
<div id="18e572e3" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">101</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>array([0.  , 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.1 ,
       0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.2 , 0.21,
       0.22, 0.23, 0.24, 0.25, 0.26, 0.27, 0.28, 0.29, 0.3 , 0.31, 0.32,
       0.33, 0.34, 0.35, 0.36, 0.37, 0.38, 0.39, 0.4 , 0.41, 0.42, 0.43,
       0.44, 0.45, 0.46, 0.47, 0.48, 0.49, 0.5 , 0.51, 0.52, 0.53, 0.54,
       0.55, 0.56, 0.57, 0.58, 0.59, 0.6 , 0.61, 0.62, 0.63, 0.64, 0.65,
       0.66, 0.67, 0.68, 0.69, 0.7 , 0.71, 0.72, 0.73, 0.74, 0.75, 0.76,
       0.77, 0.78, 0.79, 0.8 , 0.81, 0.82, 0.83, 0.84, 0.85, 0.86, 0.87,
       0.88, 0.89, 0.9 , 0.91, 0.92, 0.93, 0.94, 0.95, 0.96, 0.97, 0.98,
       0.99, 1.  ])</code></pre>
</div>
</div>
<p>Another similar function is NumPy’s logspace. This code specifies that I want 6 values, from 10 to the negative 2nd power through 10 to the 3rd power.</p>
<div id="0c76eb59" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>np.logspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>array([1.e-02, 1.e-01, 1.e+00, 1.e+01, 1.e+02, 1.e+03])</code></pre>
</div>
</div>
<p>If you’re comfortable using the SciPy library, you can instead specify continuous parameters for a randomized search using SciPy distributions. However, I find it much easier to just use NumPy’s linspace and logspace functions.</p>
</section>
<section id="qa-whats-the-target-accuracy-we-are-trying-to-achieve" class="level2" data-number="10.9">
<h2 data-number="10.9" class="anchored" data-anchor-id="qa-whats-the-target-accuracy-we-are-trying-to-achieve"><span class="header-section-number">10.9</span> Q&amp;A: What’s the target accuracy we are trying to achieve?</h2>
<p>When you’re building and tuning a modeling Pipeline, it’s natural to wonder how you’ll know when you’re done. In other words, how good of a model is “good enough”? There are three ways that I tend to think about this question.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>When is a model “good enough”?</strong></p>
<ul>
<li><strong>Useful model:</strong> Outperforms null accuracy</li>
<li><strong>Best possible model:</strong> Usually impossible to know the theoretical maximum accuracy</li>
<li><strong>Practical model:</strong> Continue improving until you run out of resources</li>
</ul>
</div>
</div>
</div>
<p>The first way is to ask the question: What is the minimum accuracy that we need to achieve for our model to be considered useful? In most cases, you want your model to at least outperform null accuracy, which is the accuracy you could achieve by always predicting the most frequent class.</p>
<p>To calculate the null accuracy for our training data, we use the value_counts method on y, and set normalize to True in order to display the counts as a percentage. From the results, we can see that class 0 is the most frequent class, and about 61.6% of the y values are class 0.</p>
<div id="b881511f" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>y.value_counts(normalize<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>0    0.616162
1    0.383838
Name: Survived, dtype: float64</code></pre>
</div>
</div>
<p>Thus the null accuracy for this problem is 61.6%, since an uninformed model, also known as the null model, could achieve that accuracy simply by predicting class 0 in all cases. In other words, this is the accuracy level that we want to outperform, otherwise the model is not providing any value. Thankfully, all of our Pipelines are outperforming null accuracy by a considerable amount.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> 0.828</li>
<li><strong>Randomized search (more C values):</strong> 0.827</li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
<li><strong>Null model:</strong> <mark>0.616</mark></li>
</ul>
</div>
</div>
</div>
<p>The second way to think about this question is to ask: What is the maximum accuracy we could eventually reach? For most real problems, it’s impossible to know how accurate your model could be if you did enough tuning and tried enough models. It’s also impossible to know how accurate your model could be if you gathered more samples or more features. The main exception to this is if you’re working on a well-studied research problem, because in that case there may be a state-of-the-art benchmark that everyone is trying to surpass.</p>
<p>Thus in most practical circumstances, you don’t set a target accuracy. Instead, you work to improve the model until you run out of time, money, or ideas.</p>
</section>
<section id="qa-is-it-okay-that-our-model-includes-thousands-of-features" class="level2" data-number="10.10">
<h2 data-number="10.10" class="anchored" data-anchor-id="qa-is-it-okay-that-our-model-includes-thousands-of-features"><span class="header-section-number">10.10</span> Q&amp;A: Is it okay that our model includes thousands of features?</h2>
<p>The pipe object is our Pipeline that hasn’t been tuned by grid search. Recall that you can examine an individual Pipeline step by using the named_steps attribute. In this case, we’ll select the first step, which is our ColumnTransformer.</p>
<div id="6f056a42" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>pipe.named_steps[<span class="st">'columntransformer'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="86611942-ad62-49bd-99c9-e2b6f84876ba" type="checkbox"><label class="sk-toggleable__label" for="86611942-ad62-49bd-99c9-e2b6f84876ba">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cc07e9a2-be9c-4458-b344-d2519540b52e" type="checkbox"><label class="sk-toggleable__label" for="cc07e9a2-be9c-4458-b344-d2519540b52e">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="011e031d-d105-4b68-9944-d974fe0015ad" type="checkbox"><label class="sk-toggleable__label" for="011e031d-d105-4b68-9944-d974fe0015ad">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2f80f122-8995-44b6-b9b2-7bb445abed3c" type="checkbox"><label class="sk-toggleable__label" for="2f80f122-8995-44b6-b9b2-7bb445abed3c">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ccd31e59-3c21-48ea-89d8-2ad641e2d861" type="checkbox"><label class="sk-toggleable__label" for="ccd31e59-3c21-48ea-89d8-2ad641e2d861">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="93243dc3-4b4e-4361-8f9f-1428e5cfb783" type="checkbox"><label class="sk-toggleable__label" for="93243dc3-4b4e-4361-8f9f-1428e5cfb783">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="14f159e2-fdf1-4f26-b6ea-7199e6dd08c1" type="checkbox"><label class="sk-toggleable__label" for="14f159e2-fdf1-4f26-b6ea-7199e6dd08c1">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="470553ca-105c-466e-b90f-a7143c2127d6" type="checkbox"><label class="sk-toggleable__label" for="470553ca-105c-466e-b90f-a7143c2127d6">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bc01d2d0-e3e7-424e-b1d2-7f7ee748ebed" type="checkbox"><label class="sk-toggleable__label" for="bc01d2d0-e3e7-424e-b1d2-7f7ee748ebed">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="559f3dbe-f372-4185-be8a-9fcf9a76181e" type="checkbox"><label class="sk-toggleable__label" for="559f3dbe-f372-4185-be8a-9fcf9a76181e">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>By passing X to its fit_transform method, we can see that the ColumnTransformer outputs 1518 feature columns. As we saw in <a href="ch08.html#sec-8-4" class="quarto-xref">lesson&nbsp;<span>8.4</span></a>, all except 9 of those features were created from the Name column by CountVectorizer.</p>
<div id="f898c327" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>pipe.named_steps[<span class="st">'columntransformer'</span>].fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>&lt;891x1518 sparse matrix of type '&lt;class 'numpy.float64'&gt;'
    with 7328 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
<p>The cross-validated accuracy of this Pipeline is 0.811, which we’ve been calling the baseline accuracy against which other Pipelines can be compared.</p>
<div id="723ac6b4" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>cross_val_score(pipe, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>0.8114619295712762</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> 0.828</li>
<li><strong>Randomized search (more C values):</strong> 0.827</li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Baseline (no tuning):</strong> <mark>0.811</mark></li>
<li><strong>Null model:</strong> 0.616</li>
</ul>
</div>
</div>
</div>
<p>Similarly, we can select the ColumnTransformer from our Pipeline that was tuned by grid search. Notice that the ngram_range for CountVectorizer is (1, 2), meaning CountVectorizer will create features from both unigrams and bigrams in the Name column.</p>
<div id="1c7d4b78" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_.named_steps[<span class="st">'columntransformer'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="07a1f620-f7d7-4acd-b8bc-d69b0f74dfab" type="checkbox"><label class="sk-toggleable__label" for="07a1f620-f7d7-4acd-b8bc-d69b0f74dfab">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer',
                                 CountVectorizer(ngram_range=(1, 2)), 'Name'),
                                ('simpleimputer',
                                 SimpleImputer(add_indicator=True),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0b09b69d-4b8a-46e4-8aa0-23c4cc8e29be" type="checkbox"><label class="sk-toggleable__label" for="0b09b69d-4b8a-46e4-8aa0-23c4cc8e29be">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="348252e2-0938-4bde-a93b-1d24ebfe98a3" type="checkbox"><label class="sk-toggleable__label" for="348252e2-0938-4bde-a93b-1d24ebfe98a3">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ecc94c2c-42b3-4ecd-8a04-42905897784e" type="checkbox"><label class="sk-toggleable__label" for="ecc94c2c-42b3-4ecd-8a04-42905897784e">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f8b3a554-aa25-407e-b928-7ced61e61690" type="checkbox"><label class="sk-toggleable__label" for="f8b3a554-aa25-407e-b928-7ced61e61690">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e72863a7-23b2-43fb-b675-d959e9f6b36f" type="checkbox"><label class="sk-toggleable__label" for="e72863a7-23b2-43fb-b675-d959e9f6b36f">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer(ngram_range=(1, 2))</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="31138ada-2d39-4098-8380-eac96ebe2b41" type="checkbox"><label class="sk-toggleable__label" for="31138ada-2d39-4098-8380-eac96ebe2b41">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f8735589-1823-4aed-8c9c-682f4bb30954" type="checkbox"><label class="sk-toggleable__label" for="f8735589-1823-4aed-8c9c-682f4bb30954">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(add_indicator=True)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f410e639-59dc-4e1c-a5f6-032b951e0a85" type="checkbox"><label class="sk-toggleable__label" for="f410e639-59dc-4e1c-a5f6-032b951e0a85">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b3246703-faf7-44a6-8b59-c9f2266fcc69" type="checkbox"><label class="sk-toggleable__label" for="b3246703-faf7-44a6-8b59-c9f2266fcc69">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>By using fit_transform, we can see that this ColumnTransformer outputs 3671 feature columns. Again, all except 9 of those features were created from the Name column.</p>
<div id="0f06454a" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_.named_steps[<span class="st">'columntransformer'</span>].fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>&lt;891x3671 sparse matrix of type '&lt;class 'numpy.float64'&gt;'
    with 10191 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
<p>The cross-validated accuracy of this Pipeline is 0.828.</p>
<div id="27675e01" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>grid.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>0.828253091456908</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> <mark>0.828</mark></li>
<li><strong>Randomized search (more C values):</strong> 0.827</li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
<li><strong>Null model:</strong> 0.616</li>
</ul>
</div>
</div>
</div>
<p>Finally, let’s compare these two Pipelines to a Pipeline that doesn’t include the Name column at all. First, we’ll create a ColumnTransformer called “no_name_ct” that excludes Name.</p>
<div id="cd835e4a" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>no_name_ct <span class="op">=</span> make_column_transformer(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    (imp_ohe, [<span class="st">'Embarked'</span>, <span class="st">'Sex'</span>]),</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    (imp, [<span class="st">'Age'</span>, <span class="st">'Fare'</span>]),</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'passthrough'</span>, [<span class="st">'Parch'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you can see, this ColumnTransformer only outputs 9 feature columns.</p>
<div id="e4ca0ba3" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>no_name_ct.fit_transform(X).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>(891, 9)</code></pre>
</div>
</div>
<p>Then, we’ll add no_name_ct to a Pipeline called “no_name_pipe” and cross-validate it. The accuracy is 0.783, which is significantly lower than the Pipelines that included the Name column. To be fair, this Pipeline hasn’t been tuned, though honestly there is no hyperparameter tuning we could do to make it perform as well as the Pipelines that included the Name column.</p>
<div id="8308a8c2" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>no_name_pipe <span class="op">=</span> make_pipeline(no_name_ct, logreg)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>cross_val_score(no_name_pipe, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>0.7833908731404181</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> 0.828</li>
<li><strong>Randomized search (more C values):</strong> 0.827</li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
<li><strong>Baseline excluding Name (no tuning):</strong> <mark>0.783</mark></li>
<li><strong>Null model:</strong> 0.616</li>
</ul>
</div>
</div>
</div>
<p>Here are some conclusions that we can draw from this experiment:</p>
<ul>
<li>First, including the Name column in the Pipeline significantly increased the cross-validated accuracy, which means that adding those thousands of feature columns did not result in overfitting. Instead, it tells us that the Name column contains more predictive signal than noise with respect to the target.</li>
<li>More generally, this experiment tells us that having more features than samples does not necessarily result in overfitting.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>What did we learn?</strong></p>
<ul>
<li>Name column contains more predictive signal than noise</li>
<li>More features than samples does not necessarily result in overfitting</li>
</ul>
</div>
</div>
</div>
<p>It’s worth noting that there is additional tuning we could do to CountVectorizer to reduce the number of features it creates. However, there’s no way to know whether that would increase or decrease the Pipeline’s accuracy without actually trying it.</p>
</section>
<section id="qa-how-do-i-examine-the-coefficients-of-a-pipeline" class="level2" data-number="10.11">
<h2 data-number="10.11" class="anchored" data-anchor-id="qa-how-do-i-examine-the-coefficients-of-a-pipeline"><span class="header-section-number">10.11</span> Q&amp;A: How do I examine the coefficients of a Pipeline?</h2>
<p>Recall that once a grid search is complete, GridSearchCV automatically refits the Pipeline on X and y and stores it as an attribute called best_estimator_. Therefore, we can access the model coefficients by first selecting the logistic regression step and then selecting the coef_ attribute.</p>
<div id="d4d02931" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_.named_steps[<span class="st">'logisticregression'</span>].coef_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>array([[ 0.56431161,  0.        , -0.08767203, ...,  0.01408723,
        -0.43713268, -0.46358519]])</code></pre>
</div>
</div>
<p>Ideally, we would also be able to get the names of the features that correspond to these coefficients by running the get_feature_names method on the ColumnTransformer step. However, get_feature_names only works if all of the underlying transformers have a get_feature_names method, and that is not the case here.</p>
<div id="6565c6e8" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_.named_steps[<span class="st">'columntransformer'</span>].get_feature_names()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="05c944f8" class="cell" data-execution_count="66">
<div class="cell-output cell-output-stdout">
<pre><code>AttributeError: Transformer pipeline (type Pipeline) does not provide get_feature_names.</code></pre>
</div>
</div>
<p>Instead, as we saw previously in <a href="ch08.html#sec-8-4" class="quarto-xref">lesson&nbsp;<span>8.4</span></a>, you would have to inspect the transformers one-by-one in order to determine the feature names.</p>
<div id="c09d2660" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_.named_steps[<span class="st">'columntransformer'</span>].transformers_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>[('pipeline',
  Pipeline(steps=[('simpleimputer',
                   SimpleImputer(fill_value='missing', strategy='constant')),
                  ('onehotencoder', OneHotEncoder())]),
  ['Embarked', 'Sex']),
 ('countvectorizer', CountVectorizer(ngram_range=(1, 2)), 'Name'),
 ('simpleimputer', SimpleImputer(add_indicator=True), ['Age', 'Fare']),
 ('passthrough', 'passthrough', ['Parch'])]</code></pre>
</div>
</div>
<p>Note that starting in scikit-learn version 1.1, the get_feature_names_out method should work on this ColumnTransformer, since the get_feature_names_out method will be available for all transformers.</p>
</section>
<section id="sec-10-12" class="level2" data-number="10.12">
<h2 data-number="10.12" class="anchored" data-anchor-id="sec-10-12"><span class="header-section-number">10.12</span> Q&amp;A: Should I split the dataset before tuning the Pipeline?</h2>
<p>When we perform a grid search, we’re trying to find the parameters that maximize the cross-validation score on a dataset. Thus, we’re using the same data to accomplish two separate goals:</p>
<ul>
<li>First, to choose the best parameters for the Pipeline, which are stored in the best_params_ attribute.</li>
<li>Second, to estimate the future performance of the Pipeline on new data when using these parameters, which is stored in the best_score_ attribute.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Goals of a grid search:</strong></p>
<ul>
<li>Choose the best parameters for the Pipeline</li>
<li>Estimate its performance on new data when using these parameters</li>
</ul>
</div>
</div>
</div>
<div id="4b073431" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>grid.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>{'columntransformer__countvectorizer__ngram_range': (1, 2),
 'columntransformer__pipeline__onehotencoder__drop': None,
 'columntransformer__simpleimputer__add_indicator': True,
 'logisticregression__C': 10,
 'logisticregression__penalty': 'l1'}</code></pre>
</div>
</div>
<div id="73fe290b" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>grid.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>0.828253091456908</code></pre>
</div>
</div>
<p>Using the same data for these two separate goals actually biases the Pipeline to this dataset and can result in overly optimistic scores.</p>
<p>If your main objective is to choose the best parameters, then this process is totally fine. You’ll just have to accept that its actual performance on new data may be lower than the performance estimated by grid search.</p>
<p>But if you also need a realistic estimate of the Pipeline’s performance on new data, then there’s an alternative process you can use, which I’ll walk you through in this lesson.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Is it okay to use the same data for both goals?</strong></p>
<ul>
<li><strong>Yes:</strong> If your main objective is to choose the best parameters</li>
<li><strong>No:</strong> If you need a realistic estimate of performance on new data</li>
</ul>
</div>
</div>
</div>
<p>To start, we’ll import the train_test_split function from the model_selection module, and use it to split the data into training and testing sets, with 75% of the data as training and 25% of the data as testing. Note that I set the stratify parameter to “y” so that the class proportions will be approximately equal in the training and testing sets.</p>
<div id="8039e8b4" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.25</span>,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>                                                    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>                                                    stratify<span class="op">=</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we’ll create a new GridSearchCV object called training_grid. When we run the grid search, we’ll only pass it the training set so that the tuning process only takes the training set into account.</p>
<div id="0630960d" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>training_grid <span class="op">=</span> GridSearchCV(pipe, params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>,</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>                             n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>training_grid.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b251cdab-5d6f-47d9-994e-c7ac2a0c6498" type="checkbox"><label class="sk-toggleable__label" for="b251cdab-5d6f-47d9-994e-c7ac2a0c6498">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        (...
                                        LogisticRegression(random_state=1,
                                                           solver='liblinear'))]),
             n_jobs=-1,
             param_grid={'columntransformer__countvectorizer__ngram_range': [(1,
                                                                              1),
                                                                             (1,
                                                                              2)],
                         'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                              'first'],
                         'columntransformer__simpleimputer__add_indicator': [False,
                                                                             True],
                         'logisticregression__C': [0.1, 1, 10],
                         'logisticregression__penalty': ['l1', 'l2']},
             scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e21c3738-c474-4806-893f-c46f93afc99c" type="checkbox"><label class="sk-toggleable__label" for="e21c3738-c474-4806-893f-c46f93afc99c">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d40b3899-55e5-49df-a8be-61f02ea25344" type="checkbox"><label class="sk-toggleable__label" for="d40b3899-55e5-49df-a8be-61f02ea25344">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3dd242bc-43f6-4c13-bce2-18752d2c6bb9" type="checkbox"><label class="sk-toggleable__label" for="3dd242bc-43f6-4c13-bce2-18752d2c6bb9">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b065e32d-c15d-459b-9d76-f0839dd2e4ea" type="checkbox"><label class="sk-toggleable__label" for="b065e32d-c15d-459b-9d76-f0839dd2e4ea">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a9b7b1af-cc75-454b-8568-f18a90372b76" type="checkbox"><label class="sk-toggleable__label" for="a9b7b1af-cc75-454b-8568-f18a90372b76">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b2de7e4b-9788-4534-9323-73650181a281" type="checkbox"><label class="sk-toggleable__label" for="b2de7e4b-9788-4534-9323-73650181a281">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="46911e5e-3e12-4f6e-8893-1b24c34e9fce" type="checkbox"><label class="sk-toggleable__label" for="46911e5e-3e12-4f6e-8893-1b24c34e9fce">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="35cfa557-7867-4d24-b1e0-18fa949f70b6" type="checkbox"><label class="sk-toggleable__label" for="35cfa557-7867-4d24-b1e0-18fa949f70b6">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cfcfac09-a7ce-4d23-9ef5-dca2dfd29b10" type="checkbox"><label class="sk-toggleable__label" for="cfcfac09-a7ce-4d23-9ef5-dca2dfd29b10">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d1a62510-3165-4524-9433-3b0dbd197d94" type="checkbox"><label class="sk-toggleable__label" for="d1a62510-3165-4524-9433-3b0dbd197d94">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="be707e4a-368d-4502-a2f8-57557f35abbf" type="checkbox"><label class="sk-toggleable__label" for="be707e4a-368d-4502-a2f8-57557f35abbf">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>Here are the best parameters found by grid search on the training set.</p>
<div id="4d9abab7" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>training_grid.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>{'columntransformer__countvectorizer__ngram_range': (1, 2),
 'columntransformer__pipeline__onehotencoder__drop': 'first',
 'columntransformer__simpleimputer__add_indicator': False,
 'logisticregression__C': 10,
 'logisticregression__penalty': 'l2'}</code></pre>
</div>
</div>
<p>We’re not actually interested in the best score found during the grid search. Instead, we’re going to use the best parameters found by the grid search to make predictions for the testing set, and then evaluate the accuracy of those predictions. We can do this by passing the testing set to the training_grid’s score method.</p>
<p>The accuracy it outputs is 0.816, which is a more realistic estimate of how the Pipeline will perform on new data, since the testing set is brand new data that the Pipeline has never seen. However, it’s still just a single realization of this model, and so it’s impossible to know how precise this value is.</p>
<div id="43c6a067" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>training_grid.score(X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>0.8161434977578476</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> 0.828</li>
<li><strong>Randomized search (more C values):</strong> 0.827</li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Grid search (estimate for new data):</strong> <mark>0.816</mark></li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
<li><strong>Baseline excluding Name (no tuning):</strong> 0.783</li>
<li><strong>Null model:</strong> 0.616</li>
</ul>
</div>
</div>
</div>
<p>Now that we’ve found the best parameters for the Pipeline and estimated its likely performance on new data, our final step is to actually make predictions on new data. Before making predictions, it’s critical that we train the Pipeline on all of our data, meaning the entirety of X and y, otherwise we’re throwing away valuable data.</p>
<p>In other words, we can’t simply use the training_grid’s predict method since it was only refit on X_train and y_train. Instead, we need to save the Pipeline with the best parameters, which we’ll call “best_pipe”, and fit it to X and y.</p>
<div id="ae7bc5c4" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>best_pipe <span class="op">=</span> training_grid.best_estimator_</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>best_pipe.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b2db6438-75b6-4ef9-9a14-d779a6d09718" type="checkbox"><label class="sk-toggleable__label" for="b2db6438-75b6-4ef9-9a14-d779a6d09718">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('simpleimputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehotencoder',
                                                                   OneHotEncoder(drop='first'))]),
                                                  ['Embarked', 'Sex']),
                                                 ('countvectorizer',
                                                  CountVectorizer(ngram_range=(1,
                                                                               2)),
                                                  'Name'),
                                                 ('simpleimputer',
                                                  SimpleImputer(),
                                                  ['Age', 'Fare']),
                                                 ('passthrough', 'passthrough',
                                                  ['Parch'])])),
                ('logisticregression',
                 LogisticRegression(C=10, random_state=1, solver='liblinear'))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4a6b30e5-c396-4c93-a055-1b45bb1d04b1" type="checkbox"><label class="sk-toggleable__label" for="4a6b30e5-c396-4c93-a055-1b45bb1d04b1">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder(drop='first'))]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer',
                                 CountVectorizer(ngram_range=(1, 2)), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1c13aff1-816f-4dfa-91a7-6123d57bc35b" type="checkbox"><label class="sk-toggleable__label" for="1c13aff1-816f-4dfa-91a7-6123d57bc35b">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5026a1d7-3909-4a0a-8ae9-50742df17851" type="checkbox"><label class="sk-toggleable__label" for="5026a1d7-3909-4a0a-8ae9-50742df17851">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fee26588-01b7-47d5-882c-3fd0c619f975" type="checkbox"><label class="sk-toggleable__label" for="fee26588-01b7-47d5-882c-3fd0c619f975">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop='first')</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c80ff60e-1646-413b-88b3-e97a3fcc70f5" type="checkbox"><label class="sk-toggleable__label" for="c80ff60e-1646-413b-88b3-e97a3fcc70f5">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="12744c8f-b30b-4d45-8972-b335a4cf0786" type="checkbox"><label class="sk-toggleable__label" for="12744c8f-b30b-4d45-8972-b335a4cf0786">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer(ngram_range=(1, 2))</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b26d5392-be73-4ddf-937b-157aa74a5846" type="checkbox"><label class="sk-toggleable__label" for="b26d5392-be73-4ddf-937b-157aa74a5846">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="158ceeae-8965-4d1b-92af-fedcb772ef2d" type="checkbox"><label class="sk-toggleable__label" for="158ceeae-8965-4d1b-92af-fedcb772ef2d">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="218f5aaf-18ea-4bff-aab3-b1133c7f7999" type="checkbox"><label class="sk-toggleable__label" for="218f5aaf-18ea-4bff-aab3-b1133c7f7999">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0084ba68-ee45-4fa6-ad02-5db7c6540659" type="checkbox"><label class="sk-toggleable__label" for="0084ba68-ee45-4fa6-ad02-5db7c6540659">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ff3e35cf-166f-4cff-b22f-f7efd4e2acc0" type="checkbox"><label class="sk-toggleable__label" for="ff3e35cf-166f-4cff-b22f-f7efd4e2acc0">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(C=10, random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>Now we can make predictions on new data.</p>
<div id="e143ac0d" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>best_pipe.predict(X_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>array([0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1,
       1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1,
       1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1,
       1, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1,
       1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,
       1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1,
       1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1,
       0, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0,
       1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1,
       1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1,
       0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0,
       0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1,
       0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0,
       1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0,
       0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0,
       1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1,
       0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1])</code></pre>
</div>
</div>
<p>If you decide that you’re going to follow the process that I’ve just outlined, then there are two guidelines that are important to follow.</p>
<p>First, you should only use the testing set for evaluating Pipeline performance one time. If you keep tuning the Pipeline again and again, each time checking its performance on the testing set, you’re essentially tuning the Pipeline to the particulars of the testing set. At that point, it no longer functions as an independent data source and thus its performance estimates will become less reliable.</p>
<p>Second, it’s important that you have enough data overall in order for the training and testing sets to both be sufficiently large once the dataset has been split:</p>
<ul>
<li>If the training set is too small, then the grid search won’t have enough data to find the optimal tuning parameters.</li>
<li>If the testing set is too small, then it won’t be able to provide a reliable estimate of Pipeline performance.</li>
</ul>
<p>Both of these situations would defeat the purpose of splitting the dataset, and thus this approach is best when you have a large enough dataset. Unfortunately, it’s difficult to say in the abstract how much data is “enough”, since that depends on the particulars of the dataset and the problem.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Guidelines for using this process:</strong></p>
<ul>
<li><strong>Only use the testing set once:</strong>
<ul>
<li>If used multiple times, performance estimates will become less reliable</li>
</ul></li>
<li><strong>You must have enough data:</strong>
<ul>
<li>If training set is too small, grid search won’t find the optimal parameters</li>
<li>If testing set is too small, it won’t provide a reliable performance estimate</li>
</ul></li>
</ul>
</div>
</div>
</div>
</section>
<section id="qa-what-is-regularization" class="level2" data-number="10.13">
<h2 data-number="10.13" class="anchored" data-anchor-id="qa-what-is-regularization"><span class="header-section-number">10.13</span> Q&amp;A: What is regularization?</h2>
<p>Earlier in this chapter, we tuned the regularization parameters of logistic regression. In this lesson, I’ll briefly explain what regularization actually is.</p>
<p>Regularization is a process that constrains the size of a model’s coefficients in order to minimize overfitting. Overfitting is when your model fits too closely to patterns in the training data, which causes your model not to perform well when it makes predictions on new data.</p>
<p>Regularization minimizes overfitting by reducing the variance of the model. Thus if you believe a model is too complex, regularization will reduce the error due to variance more than it increases the error due to bias, resulting in a model that is more likely to generalize to new data.</p>
<p>In simpler terms, regularization makes your model a bit less flexible so that it’s more likely to follow the true patterns in the data and less likely to follow the noise. Regularization is especially useful when you have outliers in the training data, because regularization decreases the influence that outliers have on the model.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Brief explanation of regularization:</strong></p>
<ul>
<li>Constrains the size of model coefficients to minimize overfitting</li>
<li>Reduces the variance of an overly complex model to help the model generalize</li>
<li>Decreases model flexibility so that it follows the true patterns in the data</li>
</ul>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mlbook\.dataschool\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ch09.html" class="pagination-link" aria-label="Workflow review #2">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Workflow review #2</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ch11.html" class="pagination-link" aria-label="Comparing linear and non-linear models">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing linear and non-linear models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Kevin Markham. All Rights Reserved.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>