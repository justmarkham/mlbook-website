<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kevin Markham">
<meta name="description" content="A practical guide to help you transition from Machine Learning novice to skilled Machine Learning practitioner.">

<title>10&nbsp; Evaluating and tuning a Pipeline – Master Machine Learning with scikit-learn</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ch11.html" rel="next">
<link href="./ch09.html" rel="prev">
<link href="./favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-e32d5626311174d9f6538aca58dc36c7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://cdn.usefathom.com/script.js" data-site="AWKMQOCB" defer=""></script>


<meta property="og:title" content="10&nbsp; Evaluating and tuning a Pipeline – Master Machine Learning with scikit-learn">
<meta property="og:description" content="A Practical Guide to Building Better Models with Python">
<meta property="og:image" content="https://mlbook.dataschool.io/logo.png">
<meta property="og:site_name" content="Master Machine Learning with scikit-learn">
<meta property="og:image:height" content="141">
<meta property="og:image:width" content="266">
<meta name="twitter:title" content="10&nbsp; Evaluating and tuning a Pipeline – Master Machine Learning with scikit-learn">
<meta name="twitter:description" content="A Practical Guide to Building Better Models with Python">
<meta name="twitter:image" content="https://mlbook.dataschool.io/logo.png">
<meta name="twitter:image-height" content="141">
<meta name="twitter:image-width" content="266">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ch10.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Evaluating and tuning a Pipeline</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Master Machine Learning with scikit-learn</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Review of the Machine Learning workflow</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Encoding categorical features</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Improving your workflow with ColumnTransformer and Pipeline</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Workflow review #1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Encoding text data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Handling missing values</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Fixing common workflow problems</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Workflow review #2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch10.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Evaluating and tuning a Pipeline</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing linear and non-linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Ensembling multiple models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Feature selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Feature standardization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Feature engineering with custom transformers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Workflow review #3</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">High-cardinality categorical features</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch18.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Class imbalance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch19.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Class imbalance walkthrough</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch20.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Going further</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#evaluating-a-pipeline-with-cross-validation" id="toc-evaluating-a-pipeline-with-cross-validation" class="nav-link active" data-scroll-target="#evaluating-a-pipeline-with-cross-validation"><span class="header-section-number">10.1</span> Evaluating a Pipeline with cross-validation</a></li>
  <li><a href="#tuning-a-pipeline-with-grid-search" id="toc-tuning-a-pipeline-with-grid-search" class="nav-link" data-scroll-target="#tuning-a-pipeline-with-grid-search"><span class="header-section-number">10.2</span> Tuning a Pipeline with grid search</a></li>
  <li><a href="#tuning-the-model" id="toc-tuning-the-model" class="nav-link" data-scroll-target="#tuning-the-model"><span class="header-section-number">10.3</span> Tuning the model</a></li>
  <li><a href="#tuning-the-transformers" id="toc-tuning-the-transformers" class="nav-link" data-scroll-target="#tuning-the-transformers"><span class="header-section-number">10.4</span> Tuning the transformers</a></li>
  <li><a href="#using-the-best-pipeline-to-make-predictions" id="toc-using-the-best-pipeline-to-make-predictions" class="nav-link" data-scroll-target="#using-the-best-pipeline-to-make-predictions"><span class="header-section-number">10.5</span> Using the best Pipeline to make predictions</a></li>
  <li><a href="#qa-how-do-i-save-the-best-pipeline-for-future-use" id="toc-qa-how-do-i-save-the-best-pipeline-for-future-use" class="nav-link" data-scroll-target="#qa-how-do-i-save-the-best-pipeline-for-future-use"><span class="header-section-number">10.6</span> Q&amp;A: How do I save the best Pipeline for future use?</a></li>
  <li><a href="#qa-how-do-i-speed-up-a-grid-search" id="toc-qa-how-do-i-speed-up-a-grid-search" class="nav-link" data-scroll-target="#qa-how-do-i-speed-up-a-grid-search"><span class="header-section-number">10.7</span> Q&amp;A: How do I speed up a grid search?</a></li>
  <li><a href="#qa-how-do-i-tune-a-pipeline-with-randomized-search" id="toc-qa-how-do-i-tune-a-pipeline-with-randomized-search" class="nav-link" data-scroll-target="#qa-how-do-i-tune-a-pipeline-with-randomized-search"><span class="header-section-number">10.8</span> Q&amp;A: How do I tune a Pipeline with randomized search?</a></li>
  <li><a href="#qa-whats-the-target-accuracy-we-are-trying-to-achieve" id="toc-qa-whats-the-target-accuracy-we-are-trying-to-achieve" class="nav-link" data-scroll-target="#qa-whats-the-target-accuracy-we-are-trying-to-achieve"><span class="header-section-number">10.9</span> Q&amp;A: What’s the target accuracy we are trying to achieve?</a></li>
  <li><a href="#qa-is-it-okay-that-our-model-includes-thousands-of-features" id="toc-qa-is-it-okay-that-our-model-includes-thousands-of-features" class="nav-link" data-scroll-target="#qa-is-it-okay-that-our-model-includes-thousands-of-features"><span class="header-section-number">10.10</span> Q&amp;A: Is it okay that our model includes thousands of features?</a></li>
  <li><a href="#qa-how-do-i-examine-the-coefficients-of-a-pipeline" id="toc-qa-how-do-i-examine-the-coefficients-of-a-pipeline" class="nav-link" data-scroll-target="#qa-how-do-i-examine-the-coefficients-of-a-pipeline"><span class="header-section-number">10.11</span> Q&amp;A: How do I examine the coefficients of a Pipeline?</a></li>
  <li><a href="#sec-10-12" id="toc-sec-10-12" class="nav-link" data-scroll-target="#sec-10-12"><span class="header-section-number">10.12</span> Q&amp;A: Should I split the dataset before tuning the Pipeline?</a></li>
  <li><a href="#qa-what-is-regularization" id="toc-qa-what-is-regularization" class="nav-link" data-scroll-target="#qa-what-is-regularization"><span class="header-section-number">10.13</span> Q&amp;A: What is regularization?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Evaluating and tuning a Pipeline</span></h1>
<p class="subtitle lead">A Practical Guide to Building Better Models with Python</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="evaluating-a-pipeline-with-cross-validation" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="evaluating-a-pipeline-with-cross-validation"><span class="header-section-number">10.1</span> Evaluating a Pipeline with cross-validation</h2>
<p>In this chapter, we’re going to take a deep dive into how to efficiently tune our <code>Pipeline</code> for maximum accuracy.</p>
<p>Let’s return to the topic of model evaluation.</p>
<p>As you might recall, we used cross-validation way back in chapter 2 to evaluate our most basic model. Since that chapter, we’ve been adding many more features without re-running cross-validation. That’s because any model evaluation procedure is highly unreliable with only 10 rows of data, so it would have been misleading to run cross-validation and compare the results. But now that we’re using the full dataset, cross-validation can once again be used.</p>
<ul>
<li>First, we’ll import the <code>cross_val_score</code> function from the <code>model_selection</code> module.</li>
<li>Instead of passing a model to <code>cross_val_score</code>, we can actually pass our entire <code>Pipeline</code>.</li>
<li>We also pass it <code>X</code> and <code>y</code>.</li>
<li>And then we specify the number of cross-validation folds. Using 5 or 10 folds has been shown to be a reasonable default choice, and so we’ll choose 5 in order to minimize the computation. 5 folds has actually been the default for <code>cross_val_score</code> since version 0.22, but I like to include it anyway for clarity.</li>
<li>Finally, we’ll specify the evaluation metric of classification accuracy.</li>
</ul>
<p>When we run it, <code>cross_val_score</code> outputs a mean accuracy of 0.811, which we’ll use as the baseline accuracy against which our future <code>Pipeline</code>s can be compared.</p>
<div id="a37e8f1a" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>cross_val_score(pipe, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>0.8114619295712762</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
<p>Let’s talk about what actually happens “under the hood” when we run the <code>cross_val_score</code> function on a <code>Pipeline</code>:</p>
<ul>
<li>In step 1, <code>cross_val_score</code> splits the data into 5 folds. 4 out of 5 folds (meaning 80% of the data) is set aside for training, and the remaining fold (meaning 20% of the data) is set aside for testing.</li>
<li>In step 2, the <code>Pipeline</code>’s <code>fit</code> method is run on the training portion. Thus the transformations specified in the <code>ColumnTransformer</code> are performed on the training portion, and the transformed training data is used to fit the model.</li>
<li>In step 3, the <code>Pipeline</code>’s <code>predict</code> method is run on the testing portion. Thus the transformations learned during step 2 are applied to the testing portion, the transformed testing data is passed to the fitted model, and the model makes predictions.</li>
<li>Finally, in step 4, the accuracy of those predictions is calculated.</li>
<li>Steps 1 through 4 are then repeated 4 more times, and each time a different fold is set aside as the testing portion.</li>
<li><code>cross_val_score</code> thus outputs 5 accuracy scores, and we take the mean of those scores.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Steps of 5-fold cross-validation on a Pipeline:</strong></p>
<ol type="1">
<li>Split data into 5 folds (A, B, C, D, E)
<ul>
<li>ABCD is training set</li>
<li>E is testing set</li>
</ul></li>
<li><code>Pipeline</code> is fit on training set
<ul>
<li>ABCD is transformed</li>
<li>Model is fit on transformed data</li>
</ul></li>
<li><code>Pipeline</code> makes predictions on testing set
<ul>
<li>E is transformed (using step 2 transformations)</li>
<li>Model makes predictions on transformed data</li>
</ul></li>
<li>Calculate accuracy of those predictions</li>
<li>Repeat the steps above 4 more times, with a different testing set each time</li>
<li>Calculate the mean of the 5 scores</li>
</ol>
</div>
</div>
</div>
<p>One thing you might have noticed is that <code>cross_val_score</code> splits the data in step 1 before performing the transformations in steps 2 and 3. As a result, the imputation values for Age and Fare and the vocabulary for <code>CountVectorizer</code> are all computed 5 different times. Each time, these values are computed using the training set only, and then applied to both the training and testing sets.</p>
<p>Alternatively, you could imagine performing all of the transformations first, and then splitting the data. This would be much faster, since the imputation values and the vocabulary would be computed only once on the full dataset.</p>
<p>So why does <code>cross_val_score</code> split the data first? Because splitting the data before performing the transformations prevents data leakage, whereas performing the transformations on the full dataset before splitting the data would cause data leakage, since information about the testing set would be “leaked” into the model training process.</p>
<p>As we discussed in the previous chapter, this is one way that scikit-learn helps to shield you from data leakage.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Why does cross_val_score split the data first?</strong></p>
<ul>
<li><strong>Proper cross-validation:</strong>
<ul>
<li>Data is split (step 1) before transformations (steps 2 and 3)</li>
<li>Imputation values and vocabulary are computed using training set only</li>
<li>Prevents data leakage</li>
</ul></li>
<li><strong>Improper cross-validation:</strong>
<ul>
<li>Transformations are performed before data is split</li>
<li>Imputation values and vocabulary are computed using full dataset</li>
<li>Causes data leakage</li>
</ul></li>
</ul>
</div>
</div>
</div>
</section>
<section id="tuning-a-pipeline-with-grid-search" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="tuning-a-pipeline-with-grid-search"><span class="header-section-number">10.2</span> Tuning a Pipeline with grid search</h2>
<p>Now that we’ve calculated the baseline accuracy for our <code>Pipeline</code>, the next step is to tune the hyperparameters for both the model and the transformers. Recall that we’ve been using the default parameters for most objects in the <code>Pipeline</code>, and so tuning those parameters is likely to result in a more accurate model.</p>
<p>Before proceeding, let me briefly explain some terminology. In the field of statistics, “hyperparameters” are values that you set, whereas “parameters” are values learned from the data by the estimator during the fitting process.</p>
<p>For example, the <code>C</code> value of logistic regression is called a hyperparameter because it’s something you can set and optimize, whereas the coefficients of a logistic regression model are called parameters because they’re learned from the data.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Statistics terminology:</strong></p>
<ul>
<li><strong>Hyperparameters:</strong> Values that you set
<ul>
<li><strong>Example:</strong> <code>C</code> value of logistic regression</li>
</ul></li>
<li><strong>Parameters:</strong> Values learned from the data
<ul>
<li><strong>Example:</strong> Coefficients of logistic regression model</li>
</ul></li>
</ul>
</div>
</div>
</div>
<p>In this book, I’m generally going to follow scikit-learn’s conventions as I understand them:</p>
<ul>
<li>I’ll use the phrase “hyperparameter tuning” to refer to the process of tuning a model or tuning a <code>Pipeline</code> containing a model and transformers.</li>
<li>And I’ll use the phrase “parameter” to refer to anything passed to a class. For example, this includes the <code>C</code> and <code>random_state</code> values passed to the <code>LogisticRegression</code> class, and the <code>strategy</code> value passed to the <code>SimpleImputer</code> class.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>scikit-learn terminology:</strong></p>
<ul>
<li><strong>Hyperparameter tuning:</strong> Tuning a model or a <code>Pipeline</code></li>
<li><strong>Parameter:</strong> Anything passed to a class
<ul>
<li><strong>LogisticRegression:</strong> <code>C</code>, <code>random_state</code></li>
<li><strong>SimpleImputer:</strong> <code>strategy</code></li>
</ul></li>
</ul>
</div>
</div>
</div>
<p>With that being said, we’re going to use a scikit-learn class called <code>GridSearchCV</code> to perform the hyperparameter tuning. In a grid search, you define which values you want to try for each parameter, and it cross-validates every possible combination of those values.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Hyperparameter tuning with GridSearchCV:</strong></p>
<ul>
<li>You define which values to try for each parameter</li>
<li>It cross-validates every combination of those values</li>
</ul>
</div>
</div>
</div>
<p>We can actually use <code>GridSearchCV</code> to tune the entire <code>Pipeline</code> at once, including both the model and the transformers. This has two huge benefits over just tuning a model:</p>
<ul>
<li>First, it enables you to tune the model and transformer parameters simultaneously, which is important because the best performing combination might be when none of the parameters are set to their default values.</li>
<li>Second, this prevents data leakage because the data splitting and transformations will occur within the cross-validation done by <code>GridSearchCV</code>.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Benefits of tuning a Pipeline:</strong></p>
<ul>
<li>Tunes the model and transformers simultaneously</li>
<li>Prevents data leakage</li>
</ul>
</div>
</div>
</div>
<p>Keep in mind that if we had instead done the data transformations in pandas, we would have missed out on both of these benefits.</p>
</section>
<section id="tuning-the-model" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="tuning-the-model"><span class="header-section-number">10.3</span> Tuning the model</h2>
<p>In this lesson, we’re going to tune the model, and then in the next lesson, we’ll also tune the transformers.</p>
<p>For the <code>LogisticRegression</code> model, we’re going to tune two parameters:</p>
<ul>
<li>The first parameter is <code>penalty</code>, which is the type of regularization. For this parameter, the default value is <code>'l2'</code>, and we’re going to try the values <code>'l1'</code> and <code>'l2'</code>. And just to be clear, the first character of each of those values is a lowercase “L”.</li>
<li>The second parameter is <code>C</code>, which is the amount of regularization. For this parameter, the default value is 1, and we’re going to try the values 0.1, 1, and 10.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>LogisticRegression tuning parameters:</strong></p>
<ul>
<li><strong><code>penalty</code>:</strong> Type of regularization
<ul>
<li><code>'l1'</code></li>
<li><code>'l2'</code> (default)</li>
</ul></li>
<li><strong><code>C</code>:</strong> Amount of regularization
<ul>
<li>0.1</li>
<li>1 (default)</li>
<li>10</li>
</ul></li>
</ul>
</div>
</div>
</div>
<p>Deciding which parameters to tune and what values to try requires both research and experience, and unfortunately, it’s different for every type of model.</p>
<p>In order to tune a <code>Pipeline</code> with <code>GridSearchCV</code>, we need to get the names of the <code>Pipeline</code> steps from the <code>named_steps</code> attribute. We’ll tune the <code>logisticregression</code> step in this lesson, and we’ll tune the <code>columntransformer</code> step in the next lesson.</p>
<div id="4857f22f" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pipe.named_steps.keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>dict_keys(['columntransformer', 'logisticregression'])</code></pre>
</div>
</div>
<p>To use <code>GridSearchCV</code>, we need to create a dictionary in which each entry represents a parameter and the values we want to try for that parameter. We’ll start by creating an empty dictionary called <code>params</code>, and then we’ll add the two entries.</p>
<p>For each dictionary entry, the key is the <code>Pipeline</code> step name, followed by two underscores, followed by the parameter name. Thus the key for the first entry is <code>'logisticregression__penalty'</code>, and the key for the second entry is <code>'logisticregression__C'</code>.</p>
<p>Using two underscores is what allows <code>GridSearchCV</code> to distinguish between the step name and the parameter name. Using a single underscore would be ambiguous, since a step name or parameter name can have an underscore within it.</p>
<p>The value for each dictionary entry is a list of the values you want to try for that parameter. Thus the value for the first entry is a list of <code>'l1'</code> and <code>'l2'</code>, and the value for the second entry is a list of 0.1, 1, and 10.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Parameter dictionary for GridSearchCV:</strong></p>
<ul>
<li><strong>Key:</strong> <code>step__parameter</code>
<ul>
<li><code>'logisticregression__penalty'</code></li>
<li><code>'logisticregression__C'</code></li>
</ul></li>
<li><strong>Value:</strong> List of values to try
<ul>
<li><code>['l1', 'l2']</code></li>
<li><code>[0.1, 1, 10]</code></li>
</ul></li>
</ul>
</div>
</div>
</div>
<p>After adding the two entries, we’ll print out the <code>params</code> dictionary just to make sure that it looks correct.</p>
<div id="baf7dedf" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {}</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>params[<span class="st">'logisticregression__penalty'</span>] <span class="op">=</span> [<span class="st">'l1'</span>, <span class="st">'l2'</span>]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>params[<span class="st">'logisticregression__C'</span>] <span class="op">=</span> [<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>{'logisticregression__penalty': ['l1', 'l2'],
 'logisticregression__C': [0.1, 1, 10]}</code></pre>
</div>
</div>
<p>Now that we’ve created the parameter dictionary, we can set up the grid search. We import the <code>GridSearchCV</code> class from the <code>model_selection</code> module.</p>
<div id="aba2bf9b" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we create an instance of <code>GridSearchCV</code> called <code>grid</code>. We pass it the <code>Pipeline</code>, the parameter dictionary, the number of folds, and the evaluation metric.</p>
<p>Finally, we run the grid search by fitting the grid object with <code>X</code> and <code>y</code>. Because our scikit-learn configuration is set to display diagrams, we see a diagram of the <code>Pipeline</code> now that the grid search is complete.</p>
<div id="0cffda1e" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(pipe, params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>grid.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fca6f926-60ae-4b87-b2fd-8663acdd46ce" type="checkbox"><label class="sk-toggleable__label" for="fca6f926-60ae-4b87-b2fd-8663acdd46ce">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        ('passthrough',
                                                                         'passthrough',
                                                                         ['Parch'])])),
                                       ('logisticregression',
                                        LogisticRegression(random_state=1,
                                                           solver='liblinear'))]),
             param_grid={'logisticregression__C': [0.1, 1, 10],
                         'logisticregression__penalty': ['l1', 'l2']},
             scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9e037102-f726-4e92-92bf-b28c62b71bed" type="checkbox"><label class="sk-toggleable__label" for="9e037102-f726-4e92-92bf-b28c62b71bed">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="607e4b93-1edd-4e4c-9cdd-5f6a6161802e" type="checkbox"><label class="sk-toggleable__label" for="607e4b93-1edd-4e4c-9cdd-5f6a6161802e">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="adddcb20-8f36-44e1-b61b-bc9d1833507f" type="checkbox"><label class="sk-toggleable__label" for="adddcb20-8f36-44e1-b61b-bc9d1833507f">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0af8a525-ca74-4627-b958-edb42aee4d28" type="checkbox"><label class="sk-toggleable__label" for="0af8a525-ca74-4627-b958-edb42aee4d28">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="063b1d4e-a15f-4bf2-8849-d158219e5701" type="checkbox"><label class="sk-toggleable__label" for="063b1d4e-a15f-4bf2-8849-d158219e5701">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="efea7102-dcce-4240-bc41-7493230d4c85" type="checkbox"><label class="sk-toggleable__label" for="efea7102-dcce-4240-bc41-7493230d4c85">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="dfb5f1fd-87c9-43bc-a4a9-d39a839aa289" type="checkbox"><label class="sk-toggleable__label" for="dfb5f1fd-87c9-43bc-a4a9-d39a839aa289">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="082b29ac-cad1-4490-aa39-f609a8a75e71" type="checkbox"><label class="sk-toggleable__label" for="082b29ac-cad1-4490-aa39-f609a8a75e71">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c524996a-6e1d-4943-bec7-72d16eca4038" type="checkbox"><label class="sk-toggleable__label" for="c524996a-6e1d-4943-bec7-72d16eca4038">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="82e05253-0bba-44ba-96aa-afdcaa813ecc" type="checkbox"><label class="sk-toggleable__label" for="82e05253-0bba-44ba-96aa-afdcaa813ecc">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e84902be-c8c6-47d8-838f-10651668d54d" type="checkbox"><label class="sk-toggleable__label" for="e84902be-c8c6-47d8-838f-10651668d54d">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>The results of the grid search are stored in an attribute called <code>cv_results_</code>, which we’ll convert to a DataFrame. We’ll use a filter to only keep the columns we need, and rename the parameter columns to make them easier to read.</p>
<p>There are 6 rows because it ran cross-validation 6 times, which is every possible combination of the 2 values of <code>penalty</code> and the 3 values of <code>C</code> that we specified.</p>
<div id="f5bf73cb" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> (pd.DataFrame(grid.cv_results_)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>           .<span class="bu">filter</span>(regex<span class="op">=</span><span class="st">'param_|mean_test|rank'</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>results.columns <span class="op">=</span> results.columns.<span class="bu">str</span>.split(<span class="st">'__'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">penalty</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.1</td>
<td>l1</td>
<td>0.783385</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.1</td>
<td>l2</td>
<td>0.788990</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>l1</td>
<td>0.814814</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>l2</td>
<td>0.811462</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>l1</td>
<td>0.818166</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>10</td>
<td>l2</td>
<td>0.809234</td>
<td>4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Notice the rank_test_score column. We’ll use the DataFrame’s <code>sort_values</code> method to sort the rows by that column in ascending order.</p>
<p>By examining the mean_test_score column, we can see that the best parameter combination resulted in a cross-validated accuracy of 0.818, which is higher than our baseline accuracy of 0.811.</p>
<p>We can see that the best accuracy occurred when <code>C</code> was 10 and <code>penalty</code> was <code>'l1'</code>, neither of which was the default value for that parameter.</p>
<div id="7ec95a3e" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>results.sort_values(<span class="st">'rank_test_score'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">penalty</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>l1</td>
<td>0.818166</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>l1</td>
<td>0.814814</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>l2</td>
<td>0.811462</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>10</td>
<td>l2</td>
<td>0.809234</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>0.1</td>
<td>l2</td>
<td>0.788990</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>0.1</td>
<td>l1</td>
<td>0.783385</td>
<td>6</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (2 parameters):</strong> <mark>0.818</mark></li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
</section>
<section id="tuning-the-transformers" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="tuning-the-transformers"><span class="header-section-number">10.4</span> Tuning the transformers</h2>
<p>In the previous lesson, we built a grid search for tuning model parameters and found that the best accuracy occurred when <code>C</code> was 10 and <code>penalty</code> was <code>'l1'</code>. In this lesson, we’re going to expand the search to also include transformer parameters.</p>
<p>When expanding the search, you might first think that we should set <code>C</code> to 10 and <code>penalty</code> to <code>'l1'</code>, and then only search the transformer parameters, since that would be the most computationally efficient approach.</p>
<p>However, the better approach is actually to consider all of the values for <code>C</code> and <code>penalty</code> in combination with all of the transformer parameters. That’s because we’re searching for the best combination of all parameters, and since each parameter can influence what is optimal for the other parameters, the best combination might use a <code>C</code> value other than 10 or a <code>penalty</code> value other than <code>'l1'</code>.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Options for expanding the grid search:</strong></p>
<ul>
<li><strong>Initial idea:</strong> Set <code>C=10</code> and <code>penalty='l1'</code>, then only search transformer parameters</li>
<li><strong>Better approach:</strong> Search for best combination of <code>C</code>, <code>penalty</code>, and transformer parameters</li>
</ul>
</div>
</div>
</div>
<p>All of that is to say that we’re going to expand the existing <code>params</code> dictionary to include transformer parameters. And to include transformer parameters, we first need to figure out the transformer names.</p>
<p>From the previous lesson, you might recall that the first step in the <code>Pipeline</code> is named <code>columntransformer</code> (all lowercase). We’ll access that step using the <code>named_steps</code> attribute, which then allows us to examine the <code>named_transformers_</code> attribute of the <code>ColumnTransformer</code>.</p>
<p>As a side note, <code>named_transformers_</code> ends with an underscore because it’s set during the fit step, whereas <code>named_steps</code> does not end with an underscore because it’s set when the <code>Pipeline</code> instance is created.</p>
<p>Anyway, we can now see the transformer names. We’re going to tune a single parameter from three of the transformers. Normally I might tune more parameters, but for the sake of brevity I’m only going to tune three.</p>
<div id="c8d0e1a6" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pipe.named_steps[<span class="st">'columntransformer'</span>].named_transformers_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>{'pipeline': Pipeline(steps=[('simpleimputer',
                  SimpleImputer(fill_value='missing', strategy='constant')),
                 ('onehotencoder', OneHotEncoder())]),
 'countvectorizer': CountVectorizer(),
 'simpleimputer': SimpleImputer(),
 'passthrough': 'passthrough'}</code></pre>
</div>
</div>
<p>The first parameter we’re going to tune is the <code>drop</code> parameter of <code>OneHotEncoder</code>, which was added to scikit-learn in version 0.21 and which I discussed in <a href="ch03.html#sec-3-6" class="quarto-xref">lesson&nbsp;<span>3.6</span></a>.</p>
<p>To add it to the <code>params</code> dictionary, we specify the <code>Pipeline</code> step name, which is <code>columntransformer</code>. Then we specify the transformer name, which is <code>pipeline</code>. Then we specify the step name of the inner Pipeline, which is <code>onehotencoder</code>. Finally we specify the parameter name, which is <code>drop</code>. All of these components are separated by two underscores.</p>
<p>The parameter values we’re going to try are <code>None</code> and <code>'first'</code>. <code>None</code> is the default, and it means don’t drop any columns, whereas <code>'first'</code> means drop the first column of each feature after encoding.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>OneHotEncoder tuning parameter:</strong></p>
<ul>
<li><strong><code>drop</code>:</strong> Method for dropping a column of each feature
<ul>
<li><code>None</code> (default)</li>
<li><code>'first'</code></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="e1da38db" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>params[<span class="st">'columntransformer__pipeline__onehotencoder__drop'</span>] <span class="op">=</span> [<span class="va">None</span>,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                                                              <span class="st">'first'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you’re ever unsure how to specify a parameter for a grid search, you can see all of the <code>Pipeline</code>’s parameters by using the <code>get_params</code> method followed by the <code>keys</code> method. I’m converting the output to a list for easier readability. This list is also useful if you prefer to copy and paste the parameter names rather than typing them.</p>
<p>As you can see, there are many transformer and model parameters that we’re not tuning, many of which could be useful to tune given enough time and computational resources.</p>
<div id="1aecc2eb" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(pipe.get_params().keys())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>['memory',
 'steps',
 'verbose',
 'columntransformer',
 'logisticregression',
 'columntransformer__n_jobs',
 'columntransformer__remainder',
 'columntransformer__sparse_threshold',
 'columntransformer__transformer_weights',
 'columntransformer__transformers',
 'columntransformer__verbose',
 'columntransformer__pipeline',
 'columntransformer__countvectorizer',
 'columntransformer__simpleimputer',
 'columntransformer__passthrough',
 'columntransformer__pipeline__memory',
 'columntransformer__pipeline__steps',
 'columntransformer__pipeline__verbose',
 'columntransformer__pipeline__simpleimputer',
 'columntransformer__pipeline__onehotencoder',
 'columntransformer__pipeline__simpleimputer__add_indicator',
 'columntransformer__pipeline__simpleimputer__copy',
 'columntransformer__pipeline__simpleimputer__fill_value',
 'columntransformer__pipeline__simpleimputer__missing_values',
 'columntransformer__pipeline__simpleimputer__strategy',
 'columntransformer__pipeline__simpleimputer__verbose',
 'columntransformer__pipeline__onehotencoder__categories',
 'columntransformer__pipeline__onehotencoder__drop',
 'columntransformer__pipeline__onehotencoder__dtype',
 'columntransformer__pipeline__onehotencoder__handle_unknown',
 'columntransformer__pipeline__onehotencoder__sparse',
 'columntransformer__countvectorizer__analyzer',
 'columntransformer__countvectorizer__binary',
 'columntransformer__countvectorizer__decode_error',
 'columntransformer__countvectorizer__dtype',
 'columntransformer__countvectorizer__encoding',
 'columntransformer__countvectorizer__input',
 'columntransformer__countvectorizer__lowercase',
 'columntransformer__countvectorizer__max_df',
 'columntransformer__countvectorizer__max_features',
 'columntransformer__countvectorizer__min_df',
 'columntransformer__countvectorizer__ngram_range',
 'columntransformer__countvectorizer__preprocessor',
 'columntransformer__countvectorizer__stop_words',
 'columntransformer__countvectorizer__strip_accents',
 'columntransformer__countvectorizer__token_pattern',
 'columntransformer__countvectorizer__tokenizer',
 'columntransformer__countvectorizer__vocabulary',
 'columntransformer__simpleimputer__add_indicator',
 'columntransformer__simpleimputer__copy',
 'columntransformer__simpleimputer__fill_value',
 'columntransformer__simpleimputer__missing_values',
 'columntransformer__simpleimputer__strategy',
 'columntransformer__simpleimputer__verbose',
 'logisticregression__C',
 'logisticregression__class_weight',
 'logisticregression__dual',
 'logisticregression__fit_intercept',
 'logisticregression__intercept_scaling',
 'logisticregression__l1_ratio',
 'logisticregression__max_iter',
 'logisticregression__multi_class',
 'logisticregression__n_jobs',
 'logisticregression__penalty',
 'logisticregression__random_state',
 'logisticregression__solver',
 'logisticregression__tol',
 'logisticregression__verbose',
 'logisticregression__warm_start']</code></pre>
</div>
</div>
<p>Moving along, the second parameter we’re going to tune is the <code>ngram_range</code> parameter of <code>CountVectorizer</code>.</p>
<p>Again, we specify the <code>Pipeline</code> step name, then the transformer name, and then the parameter name. Note that these three components are separated by double underscores, but there’s just a single underscore within <code>ngram_range</code> because that’s part of the parameter name.</p>
<p>The parameter values we’re going to try are the tuples <code>(1, 1)</code> and <code>(1, 2)</code>. <code>(1, 1)</code> is the default, and it creates a single feature from each word. <code>(1, 2)</code> creates features from both single words, known as unigrams, and word pairs, known as bigrams.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>CountVectorizer tuning parameter:</strong></p>
<ul>
<li><strong><code>ngram_range</code>:</strong> Selection of word n-grams to be extracted as features
<ul>
<li><code>(1, 1)</code> (default)</li>
<li><code>(1, 2)</code></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="a2c9a4c9" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>params[<span class="st">'columntransformer__countvectorizer__ngram_range'</span>] <span class="op">=</span> [(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                                                             (<span class="dv">1</span>, <span class="dv">2</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The third parameter we’re going to tune is the <code>add_indicator</code> parameter of <code>SimpleImputer</code>, which was added to scikit-learn in version 0.21 and which I discussed in <a href="ch07.html#sec-7-4" class="quarto-xref">lesson&nbsp;<span>7.4</span></a>.</p>
<p>Once again, we specify the <code>Pipeline</code> step name, then the transformer name, and then the parameter name.</p>
<p>The parameter values we’re going to try are <code>False</code> and <code>True</code>. <code>False</code> is the default, and it does not add a missing indicator column, whereas <code>True</code> does add a missing indicator column.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>SimpleImputer tuning parameter:</strong></p>
<ul>
<li><strong><code>add_indicator</code>:</strong> Option to add a missing indicator column
<ul>
<li><code>False</code> (default)</li>
<li><code>True</code></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="f33a4526" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>params[<span class="st">'columntransformer__simpleimputer__add_indicator'</span>] <span class="op">=</span> [<span class="va">False</span>, <span class="va">True</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before running the grid search, we’ll print out the <code>params</code> dictionary. By multiplying 2 by 3 by 2 by 2 by 2, we can calculate that there are now 48 parameter combinations, and thus the grid search will take about 8 times longer than the previous search.</p>
<p>As an aside, if we had used the <code>Pipeline</code> and <code>ColumnTransformer</code> classes instead of the <code>make_pipeline</code> and <code>make_column_transformer</code> functions, we could have customized the step names and transformer names, which would have made these parameter specifications a bit easier to read and write. You can watch <a href="ch04.html#sec-4-9" class="quarto-xref">lessons&nbsp;<span>4.9</span></a> and <a href="ch04.html#sec-4-10" class="quarto-xref"><span>4.10</span></a> for a review of that topic.</p>
<div id="2c71fdec" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>{'logisticregression__penalty': ['l1', 'l2'],
 'logisticregression__C': [0.1, 1, 10],
 'columntransformer__pipeline__onehotencoder__drop': [None, 'first'],
 'columntransformer__countvectorizer__ngram_range': [(1, 1), (1, 2)],
 'columntransformer__simpleimputer__add_indicator': [False, True]}</code></pre>
</div>
</div>
<p>Anyway, next we’ll recreate the <code>grid</code> object with the new <code>params</code> dictionary, and then we’ll run the grid search.</p>
<div id="8e8c3152" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(pipe, params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>grid.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="284b74ad-cd71-4880-8c2d-6fc46c1f4b8a" type="checkbox"><label class="sk-toggleable__label" for="284b74ad-cd71-4880-8c2d-6fc46c1f4b8a">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        (...
                                        LogisticRegression(random_state=1,
                                                           solver='liblinear'))]),
             param_grid={'columntransformer__countvectorizer__ngram_range': [(1,
                                                                              1),
                                                                             (1,
                                                                              2)],
                         'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                              'first'],
                         'columntransformer__simpleimputer__add_indicator': [False,
                                                                             True],
                         'logisticregression__C': [0.1, 1, 10],
                         'logisticregression__penalty': ['l1', 'l2']},
             scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5b9c0cd8-029a-44e0-a19f-41b7f8853532" type="checkbox"><label class="sk-toggleable__label" for="5b9c0cd8-029a-44e0-a19f-41b7f8853532">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a233d15c-7ec8-4308-ab5e-75ec65cc0967" type="checkbox"><label class="sk-toggleable__label" for="a233d15c-7ec8-4308-ab5e-75ec65cc0967">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bebed0ec-bfb5-43f6-b7f0-d7c0f511da23" type="checkbox"><label class="sk-toggleable__label" for="bebed0ec-bfb5-43f6-b7f0-d7c0f511da23">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ed3003ef-e576-462e-a526-a35e0a019eca" type="checkbox"><label class="sk-toggleable__label" for="ed3003ef-e576-462e-a526-a35e0a019eca">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="574160d8-7979-4200-b68c-a254edf50c8e" type="checkbox"><label class="sk-toggleable__label" for="574160d8-7979-4200-b68c-a254edf50c8e">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8db1daaf-80ba-4ee5-a6e9-e5f34f777cbb" type="checkbox"><label class="sk-toggleable__label" for="8db1daaf-80ba-4ee5-a6e9-e5f34f777cbb">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ecee5400-8d00-435b-8caa-e8fc16bb317e" type="checkbox"><label class="sk-toggleable__label" for="ecee5400-8d00-435b-8caa-e8fc16bb317e">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="81bfa2d6-0b74-495c-934f-444a6d02fb7e" type="checkbox"><label class="sk-toggleable__label" for="81bfa2d6-0b74-495c-934f-444a6d02fb7e">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0c9099fd-49f8-4741-9ca8-a38f5677bd32" type="checkbox"><label class="sk-toggleable__label" for="0c9099fd-49f8-4741-9ca8-a38f5677bd32">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6a8793f5-f6df-4e2b-9f9e-8c349d88acc8" type="checkbox"><label class="sk-toggleable__label" for="6a8793f5-f6df-4e2b-9f9e-8c349d88acc8">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ae28e528-b790-4f18-9501-2c4a276c6a32" type="checkbox"><label class="sk-toggleable__label" for="ae28e528-b790-4f18-9501-2c4a276c6a32">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>Now that the search is complete, we’ll convert the search results into a DataFrame and sort it by the rank_test_score column.</p>
<p>As you can see from the mean_test_score column, the best accuracy of 0.828 is an improvement over the previous grid search, which had an accuracy of 0.818. Keep in mind that your exact results may differ based on your scikit-learn version along with other factors. However, there’s no randomness involved when you set <code>cv</code> to an integer, and so your results will be the same every time you run this grid search.</p>
<div id="0cea53b3" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> (pd.DataFrame(grid.cv_results_)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>           .<span class="bu">filter</span>(regex<span class="op">=</span><span class="st">'param_|mean_test|rank'</span>))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>results.columns <span class="op">=</span> results.columns.<span class="bu">str</span>.split(<span class="st">'__'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>results.sort_values(<span class="st">'rank_test_score'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ngram_range</th>
<th data-quarto-table-cell-role="th">drop</th>
<th data-quarto-table-cell-role="th">add_indicator</th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">penalty</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>(1, 2)</td>
<td>None</td>
<td>True</td>
<td>10</td>
<td>l1</td>
<td>0.828253</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">28</td>
<td>(1, 2)</td>
<td>None</td>
<td>False</td>
<td>10</td>
<td>l1</td>
<td>0.824889</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>(1, 2)</td>
<td>first</td>
<td>False</td>
<td>10</td>
<td>l1</td>
<td>0.824889</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">46</td>
<td>(1, 2)</td>
<td>first</td>
<td>True</td>
<td>10</td>
<td>l1</td>
<td>0.822648</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>(1, 1)</td>
<td>first</td>
<td>False</td>
<td>10</td>
<td>l1</td>
<td>0.820407</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22</td>
<td>(1, 1)</td>
<td>first</td>
<td>True</td>
<td>10</td>
<td>l1</td>
<td>0.819296</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>(1, 1)</td>
<td>None</td>
<td>False</td>
<td>10</td>
<td>l1</td>
<td>0.818166</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>(1, 1)</td>
<td>None</td>
<td>True</td>
<td>10</td>
<td>l1</td>
<td>0.817061</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>(1, 1)</td>
<td>first</td>
<td>True</td>
<td>1</td>
<td>l1</td>
<td>0.814820</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>(1, 1)</td>
<td>None</td>
<td>False</td>
<td>1</td>
<td>l1</td>
<td>0.814814</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>(1, 2)</td>
<td>first</td>
<td>True</td>
<td>1</td>
<td>l1</td>
<td>0.813703</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>(1, 2)</td>
<td>first</td>
<td>True</td>
<td>10</td>
<td>l2</td>
<td>0.812598</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>(1, 1)</td>
<td>None</td>
<td>True</td>
<td>1</td>
<td>l1</td>
<td>0.812579</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>(1, 2)</td>
<td>first</td>
<td>False</td>
<td>1</td>
<td>l1</td>
<td>0.812579</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>(1, 1)</td>
<td>first</td>
<td>False</td>
<td>1</td>
<td>l1</td>
<td>0.812579</td>
<td>14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>(1, 2)</td>
<td>None</td>
<td>False</td>
<td>1</td>
<td>l1</td>
<td>0.812567</td>
<td>16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>(1, 1)</td>
<td>None</td>
<td>True</td>
<td>10</td>
<td>l2</td>
<td>0.811481</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>(1, 1)</td>
<td>first</td>
<td>True</td>
<td>1</td>
<td>l2</td>
<td>0.811468</td>
<td>18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>(1, 1)</td>
<td>None</td>
<td>False</td>
<td>1</td>
<td>l2</td>
<td>0.811462</td>
<td>19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>(1, 1)</td>
<td>first</td>
<td>True</td>
<td>10</td>
<td>l2</td>
<td>0.810363</td>
<td>20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>(1, 1)</td>
<td>None</td>
<td>True</td>
<td>1</td>
<td>l2</td>
<td>0.810345</td>
<td>21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>(1, 1)</td>
<td>first</td>
<td>False</td>
<td>1</td>
<td>l2</td>
<td>0.810332</td>
<td>22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>(1, 2)</td>
<td>None</td>
<td>True</td>
<td>1</td>
<td>l1</td>
<td>0.810332</td>
<td>22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>(1, 1)</td>
<td>first</td>
<td>False</td>
<td>10</td>
<td>l2</td>
<td>0.809234</td>
<td>24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35</td>
<td>(1, 2)</td>
<td>None</td>
<td>True</td>
<td>10</td>
<td>l2</td>
<td>0.809234</td>
<td>24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>(1, 1)</td>
<td>None</td>
<td>False</td>
<td>10</td>
<td>l2</td>
<td>0.809234</td>
<td>24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">29</td>
<td>(1, 2)</td>
<td>None</td>
<td>False</td>
<td>10</td>
<td>l2</td>
<td>0.808104</td>
<td>27</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>(1, 2)</td>
<td>first</td>
<td>True</td>
<td>1</td>
<td>l2</td>
<td>0.808097</td>
<td>28</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">41</td>
<td>(1, 2)</td>
<td>first</td>
<td>False</td>
<td>10</td>
<td>l2</td>
<td>0.806980</td>
<td>29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>(1, 2)</td>
<td>first</td>
<td>False</td>
<td>1</td>
<td>l2</td>
<td>0.805844</td>
<td>30</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>(1, 2)</td>
<td>None</td>
<td>False</td>
<td>1</td>
<td>l2</td>
<td>0.805844</td>
<td>30</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>(1, 2)</td>
<td>None</td>
<td>True</td>
<td>1</td>
<td>l2</td>
<td>0.804739</td>
<td>32</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>(1, 2)</td>
<td>None</td>
<td>True</td>
<td>0.1</td>
<td>l2</td>
<td>0.793491</td>
<td>33</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>(1, 1)</td>
<td>None</td>
<td>True</td>
<td>0.1</td>
<td>l2</td>
<td>0.793484</td>
<td>34</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>(1, 1)</td>
<td>first</td>
<td>True</td>
<td>0.1</td>
<td>l2</td>
<td>0.791243</td>
<td>35</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>(1, 2)</td>
<td>first</td>
<td>True</td>
<td>0.1</td>
<td>l2</td>
<td>0.790114</td>
<td>36</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">37</td>
<td>(1, 2)</td>
<td>first</td>
<td>False</td>
<td>0.1</td>
<td>l2</td>
<td>0.789003</td>
<td>37</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>(1, 2)</td>
<td>None</td>
<td>False</td>
<td>0.1</td>
<td>l2</td>
<td>0.788996</td>
<td>38</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>(1, 1)</td>
<td>None</td>
<td>False</td>
<td>0.1</td>
<td>l2</td>
<td>0.788990</td>
<td>39</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>(1, 1)</td>
<td>first</td>
<td>False</td>
<td>0.1</td>
<td>l2</td>
<td>0.787885</td>
<td>40</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>(1, 1)</td>
<td>None</td>
<td>False</td>
<td>0.1</td>
<td>l1</td>
<td>0.783385</td>
<td>41</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30</td>
<td>(1, 2)</td>
<td>None</td>
<td>True</td>
<td>0.1</td>
<td>l1</td>
<td>0.783385</td>
<td>41</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>(1, 2)</td>
<td>None</td>
<td>False</td>
<td>0.1</td>
<td>l1</td>
<td>0.783385</td>
<td>41</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>(1, 1)</td>
<td>None</td>
<td>True</td>
<td>0.1</td>
<td>l1</td>
<td>0.783385</td>
<td>41</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>(1, 2)</td>
<td>first</td>
<td>False</td>
<td>0.1</td>
<td>l1</td>
<td>0.777785</td>
<td>45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">42</td>
<td>(1, 2)</td>
<td>first</td>
<td>True</td>
<td>0.1</td>
<td>l1</td>
<td>0.777785</td>
<td>45</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>(1, 1)</td>
<td>first</td>
<td>False</td>
<td>0.1</td>
<td>l1</td>
<td>0.777785</td>
<td>45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>(1, 1)</td>
<td>first</td>
<td>True</td>
<td>0.1</td>
<td>l1</td>
<td>0.777785</td>
<td>45</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> <mark>0.828</mark></li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
<p>Rather than always examining the <code>results</code> DataFrame, we can actually just access the single best score and the set of parameters that resulted in that score via attributes of the <code>grid</code> object.</p>
<p>It’s worth noting that only the <code>drop</code> parameter is using its default value, whereas the other four parameters are not using their default values.</p>
<div id="ea7ec109" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>grid.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>0.828253091456908</code></pre>
</div>
</div>
<div id="d964ff34" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>grid.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>{'columntransformer__countvectorizer__ngram_range': (1, 2),
 'columntransformer__pipeline__onehotencoder__drop': None,
 'columntransformer__simpleimputer__add_indicator': True,
 'logisticregression__C': 10,
 'logisticregression__penalty': 'l1'}</code></pre>
</div>
</div>
<p>It’s hard to say whether this truly is the best set of parameters, because some of the differences in accuracy between parameter combinations may be due to chance, based on which samples happened to appear in each fold. That’s just a limitation of basic cross-validation, and so all we can say with confidence is that this is a good combination of parameters.</p>
</section>
<section id="using-the-best-pipeline-to-make-predictions" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="using-the-best-pipeline-to-make-predictions"><span class="header-section-number">10.5</span> Using the best Pipeline to make predictions</h2>
<p>Now that we’ve tuned both the model parameters and the transformer parameters, we want to use those parameters with the <code>Pipeline</code> when making predictions.</p>
<p><code>GridSearchCV</code> actually makes this very easy. After locating the best set of parameters, it automatically refits the <code>Pipeline</code> on <code>X</code> and <code>y</code> using the best set of parameters, and it stores that fitted <code>Pipeline</code> as an attribute called <code>best_estimator_</code>. And as you can see, that attribute is indeed a <code>Pipeline</code> object.</p>
<div id="dbe42d9b" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(grid.best_estimator_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>sklearn.pipeline.Pipeline</code></pre>
</div>
</div>
<p>If we print out the <code>best_estimator_</code> attribute and click on the components, we can see that the parameters of this <code>Pipeline</code> match the best parameter set we located in the previous lesson.</p>
<div id="f8c0686b" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ca60bdb8-27a6-41f8-a1b2-26686a9a83a3" type="checkbox"><label class="sk-toggleable__label" for="ca60bdb8-27a6-41f8-a1b2-26686a9a83a3">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('simpleimputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehotencoder',
                                                                   OneHotEncoder())]),
                                                  ['Embarked', 'Sex']),
                                                 ('countvectorizer',
                                                  CountVectorizer(ngram_range=(1,
                                                                               2)),
                                                  'Name'),
                                                 ('simpleimputer',
                                                  SimpleImputer(add_indicator=True),
                                                  ['Age', 'Fare']),
                                                 ('passthrough', 'passthrough',
                                                  ['Parch'])])),
                ('logisticregression',
                 LogisticRegression(C=10, penalty='l1', random_state=1,
                                    solver='liblinear'))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="186efb5b-21c4-413e-95f7-76cf551a4a5a" type="checkbox"><label class="sk-toggleable__label" for="186efb5b-21c4-413e-95f7-76cf551a4a5a">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer',
                                 CountVectorizer(ngram_range=(1, 2)), 'Name'),
                                ('simpleimputer',
                                 SimpleImputer(add_indicator=True),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f91b939c-5217-4fcf-a6bf-cd9a54c86b75" type="checkbox"><label class="sk-toggleable__label" for="f91b939c-5217-4fcf-a6bf-cd9a54c86b75">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f867bc62-0e56-4c71-bda9-ec599abbbc69" type="checkbox"><label class="sk-toggleable__label" for="f867bc62-0e56-4c71-bda9-ec599abbbc69">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="77ad0933-aca2-44f8-90c8-1b9e872b89bc" type="checkbox"><label class="sk-toggleable__label" for="77ad0933-aca2-44f8-90c8-1b9e872b89bc">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1ab7d4c6-b36b-4d14-96eb-3318e2854f23" type="checkbox"><label class="sk-toggleable__label" for="1ab7d4c6-b36b-4d14-96eb-3318e2854f23">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b1e033da-0261-4f0f-a1a9-0b565fab174a" type="checkbox"><label class="sk-toggleable__label" for="b1e033da-0261-4f0f-a1a9-0b565fab174a">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer(ngram_range=(1, 2))</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cc0fcee1-2e07-4cea-8b39-cdffad4d0186" type="checkbox"><label class="sk-toggleable__label" for="cc0fcee1-2e07-4cea-8b39-cdffad4d0186">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="35d64f92-b3c8-46a5-9bb5-4cc4ba365f82" type="checkbox"><label class="sk-toggleable__label" for="35d64f92-b3c8-46a5-9bb5-4cc4ba365f82">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(add_indicator=True)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e7da3bd9-31b9-45f5-9565-f1f06bd52b2d" type="checkbox"><label class="sk-toggleable__label" for="e7da3bd9-31b9-45f5-9565-f1f06bd52b2d">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="00e226f9-341e-40e6-924a-0286d082e4be" type="checkbox"><label class="sk-toggleable__label" for="00e226f9-341e-40e6-924a-0286d082e4be">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a9ff8827-6686-4c4e-9aae-18f1d7170c34" type="checkbox"><label class="sk-toggleable__label" for="a9ff8827-6686-4c4e-9aae-18f1d7170c34">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(C=10, penalty='l1', random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>In order to make predictions using this <code>Pipeline</code>, all we have to do is run the <code>grid</code> object’s <code>predict</code> method, which calls the <code>predict</code> method of the <code>best_estimator_</code>, and pass it <code>X_new</code>.</p>
<div id="9e38177d" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>grid.predict(X_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>array([0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1,
       1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1,
       1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1,
       1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1,
       1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0,
       0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1,
       1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1,
       1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1,
       0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0,
       1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1,
       1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1,
       0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0,
       0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1,
       0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0,
       1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0,
       1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1,
       0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1])</code></pre>
</div>
</div>
<p>I just want to emphasize that this <code>Pipeline</code>, with the best set of parameters, was automatically refit to the entire dataset. You always train your model on the entire dataset, meaning all samples for which you know the target value, before using it to make predictions on new data, otherwise you’re throwing away valuable training data.</p>
</section>
<section id="qa-how-do-i-save-the-best-pipeline-for-future-use" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="qa-how-do-i-save-the-best-pipeline-for-future-use"><span class="header-section-number">10.6</span> Q&amp;A: How do I save the best Pipeline for future use?</h2>
<p>After completing a grid search, you may want to save the <code>Pipeline</code> with the best set of parameters so that you can use it to make predictions later.</p>
<p>As we saw in the previous lesson, the <code>Pipeline</code> with the best set of parameters is stored as an attribute of the <code>GridSearchCV</code> object called <code>best_estimator_</code>, so this is the object that we want to save.</p>
<div id="6732c58e" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(grid.best_estimator_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>sklearn.pipeline.Pipeline</code></pre>
</div>
</div>
<p>You can save a <code>Pipeline</code> to a file using pickle, which is part of the Python standard library.</p>
<div id="0f457697" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll use pickle’s <code>dump</code> method to save the <code>Pipeline</code> to a file called “pipe.pickle”.</p>
<div id="e886ec7f" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'pipe.pickle'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    pickle.dump(grid.best_estimator_, f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we can use pickle’s <code>load</code> method to load the <code>Pipeline</code> from the file into an object called <code>pipe_from_pickle</code>.</p>
<div id="e73b6221" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'pipe.pickle'</span>, <span class="st">'rb'</span>) <span class="im">as</span> f:</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    pipe_from_pickle <span class="op">=</span> pickle.load(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>pipe_from_pickle</code> is identical to <code>grid.best_estimator_</code>, and so when we use <code>pipe_from_pickle</code> to make predictions, these predictions are identical to the predictions made by the <code>grid</code> object.</p>
<div id="03a2b4e6" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>pipe_from_pickle.predict(X_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>array([0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1,
       1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1,
       1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1,
       1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1,
       1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0,
       0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1,
       1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1,
       1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1,
       0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0,
       1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1,
       1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1,
       0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0,
       0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1,
       0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0,
       1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0,
       1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1,
       0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1])</code></pre>
</div>
</div>
<p>One alternative to pickle is joblib, which is usually more efficient than pickle for scikit-learn objects. Although it’s not part of the Python standard library, joblib has been a dependency of scikit-learn since version 0.21.</p>
<div id="0b4250f7" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> joblib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Just like pickle, you use joblib’s <code>dump</code> method to save the <code>Pipeline</code> to a file, which we’ll call “pipe.joblib”.</p>
<div id="cc45736e" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>joblib.dump(grid.best_estimator_, <span class="st">'pipe.joblib'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>['pipe.joblib']</code></pre>
</div>
</div>
<p>Then, we’ll use the <code>load</code> method to load the <code>Pipeline</code> from the file into an object called <code>pipe_from_joblib</code>.</p>
<div id="a3e60de4" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>pipe_from_joblib <span class="op">=</span> joblib.load(<span class="st">'pipe.joblib'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we’ll use <code>pipe_from_joblib</code> to make predictions.</p>
<div id="4a49f105" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>pipe_from_joblib.predict(X_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>array([0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1,
       1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1,
       1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1,
       1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1,
       1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0,
       0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1,
       1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1,
       1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1,
       0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0,
       1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1,
       1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1,
       0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0,
       0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1,
       0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0,
       1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0,
       1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1,
       0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1])</code></pre>
</div>
</div>
<p>To be clear, pickle and joblib are not limited to <code>Pipeline</code>s and can be used with other scikit-learn objects, such as a standalone model object that is not inside a <code>Pipeline</code>.</p>
<p>There are a couple warnings to keep in mind when working with pickle and joblib objects:</p>
<ul>
<li>First, the objects may be version-specific and architecture-specific. As such, you should only load them into an identical environment, meaning the same versions of scikit-learn and its dependencies, using the identical computing architecture.</li>
<li>Second, these objects can be poisoned with malicious code, and so you should only load objects from a trusted source.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Warnings for pickle and joblib objects:</strong></p>
<ul>
<li>May be version-specific and architecture-specific</li>
<li>Can be poisoned with malicious code</li>
</ul>
</div>
</div>
</div>
<p>Finally, it’s worth mentioning that there are alternatives to pickle and joblib such as ONNX and PMML. These formats don’t capture the full model object, but instead save a representation that can be used to make predictions. One major benefit of these formats is that they are neither environment-specific nor architecture-specific.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Alternatives to pickle and joblib:</strong></p>
<ul>
<li><strong>Examples:</strong> ONNX, PMML</li>
<li>Save a model representation for making predictions</li>
<li>Work across environments and architectures</li>
</ul>
</div>
</div>
</div>
</section>
<section id="qa-how-do-i-speed-up-a-grid-search" class="level2" data-number="10.7">
<h2 data-number="10.7" class="anchored" data-anchor-id="qa-how-do-i-speed-up-a-grid-search"><span class="header-section-number">10.7</span> Q&amp;A: How do I speed up a grid search?</h2>
<p>Let’s recreate the <code>GridSearchCV</code> object, but this time we’ll add the <code>verbose</code> parameter and set it to 1. When we run the search, this parameter will cause two changes to the output:</p>
<ul>
<li>First, it will calculate the number of parameter combinations for you, which is 48. Since this is 5-fold cross-validation, that means the <code>Pipeline</code> will be fit 240 times.</li>
<li>Second, it will report back how long the search took, and sometimes it will give you progress updates along the way.</li>
</ul>
<div id="e1c5fd4e" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(pipe, params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>grid.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting 5 folds for each of 48 candidates, totalling 240 fits</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Parallel(n_jobs=1)]: Done  49 tasks      | elapsed:    0.5s
[Parallel(n_jobs=1)]: Done 199 tasks      | elapsed:    2.4s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="31">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1568d713-2b56-4d1c-b126-430959f8d3f6" type="checkbox"><label class="sk-toggleable__label" for="1568d713-2b56-4d1c-b126-430959f8d3f6">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        (...
                                        LogisticRegression(random_state=1,
                                                           solver='liblinear'))]),
             param_grid={'columntransformer__countvectorizer__ngram_range': [(1,
                                                                              1),
                                                                             (1,
                                                                              2)],
                         'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                              'first'],
                         'columntransformer__simpleimputer__add_indicator': [False,
                                                                             True],
                         'logisticregression__C': [0.1, 1, 10],
                         'logisticregression__penalty': ['l1', 'l2']},
             scoring='accuracy', verbose=1)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7b438e4a-e819-4655-acbc-fdd116d10cb5" type="checkbox"><label class="sk-toggleable__label" for="7b438e4a-e819-4655-acbc-fdd116d10cb5">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bc3353a0-a7e9-4c4c-aafc-21ea6f43319c" type="checkbox"><label class="sk-toggleable__label" for="bc3353a0-a7e9-4c4c-aafc-21ea6f43319c">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e0b35ed9-7ec1-4bf4-b378-4386bdcd9445" type="checkbox"><label class="sk-toggleable__label" for="e0b35ed9-7ec1-4bf4-b378-4386bdcd9445">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7362e2a8-1953-400b-a917-8c730a4252cf" type="checkbox"><label class="sk-toggleable__label" for="7362e2a8-1953-400b-a917-8c730a4252cf">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="96c666b7-b311-4335-a5d8-aaf46b9413cc" type="checkbox"><label class="sk-toggleable__label" for="96c666b7-b311-4335-a5d8-aaf46b9413cc">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2c585201-9660-42c3-8052-988cad8c7992" type="checkbox"><label class="sk-toggleable__label" for="2c585201-9660-42c3-8052-988cad8c7992">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="52da93fe-88c1-4d50-b904-1d43cf52fb0a" type="checkbox"><label class="sk-toggleable__label" for="52da93fe-88c1-4d50-b904-1d43cf52fb0a">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d2b5aaf3-e29a-4fd7-b5d5-68600f08e757" type="checkbox"><label class="sk-toggleable__label" for="d2b5aaf3-e29a-4fd7-b5d5-68600f08e757">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ab5cbace-e439-4426-8cdd-f9851ae0d5d7" type="checkbox"><label class="sk-toggleable__label" for="ab5cbace-e439-4426-8cdd-f9851ae0d5d7">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="514e396f-4928-4a4e-8459-ce4339954d2e" type="checkbox"><label class="sk-toggleable__label" for="514e396f-4928-4a4e-8459-ce4339954d2e">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="079c61fd-8ef1-494a-9ee7-8b71f4e1f711" type="checkbox"><label class="sk-toggleable__label" for="079c61fd-8ef1-494a-9ee7-8b71f4e1f711">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>Now, let’s also add the <code>n_jobs</code> parameter, set it to -1, and re-run the grid search. This instructs scikit-learn to use parallel processing with all of your CPUs to perform the search. If your machine has multiple processors, this will generally be faster, though in this case it took about the same amount of time.</p>
<div id="0a6033dd" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(pipe, params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>, verbose<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                    n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>grid.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting 5 folds for each of 48 candidates, totalling 240 fits</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 8 concurrent workers.
[Parallel(n_jobs=-1)]: Done  34 tasks      | elapsed:    1.9s
[Parallel(n_jobs=-1)]: Done 225 out of 240 | elapsed:    2.5s remaining:    0.2s
[Parallel(n_jobs=-1)]: Done 240 out of 240 | elapsed:    2.5s finished</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="33">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="072be9ad-86cb-4bac-a2a9-583d447acc58" type="checkbox"><label class="sk-toggleable__label" for="072be9ad-86cb-4bac-a2a9-583d447acc58">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        (...
                                        LogisticRegression(random_state=1,
                                                           solver='liblinear'))]),
             n_jobs=-1,
             param_grid={'columntransformer__countvectorizer__ngram_range': [(1,
                                                                              1),
                                                                             (1,
                                                                              2)],
                         'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                              'first'],
                         'columntransformer__simpleimputer__add_indicator': [False,
                                                                             True],
                         'logisticregression__C': [0.1, 1, 10],
                         'logisticregression__penalty': ['l1', 'l2']},
             scoring='accuracy', verbose=1)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0d7d0ec9-376d-4f5c-aa19-0181a8296221" type="checkbox"><label class="sk-toggleable__label" for="0d7d0ec9-376d-4f5c-aa19-0181a8296221">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8bf12e93-367e-4c28-928c-50c822c4ec4c" type="checkbox"><label class="sk-toggleable__label" for="8bf12e93-367e-4c28-928c-50c822c4ec4c">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="58571d1a-9284-43f9-931f-bb19459def58" type="checkbox"><label class="sk-toggleable__label" for="58571d1a-9284-43f9-931f-bb19459def58">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="da68d0af-2079-417e-a616-c30292661c58" type="checkbox"><label class="sk-toggleable__label" for="da68d0af-2079-417e-a616-c30292661c58">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="41cbcb8c-c606-482b-bf71-dae5eb388d70" type="checkbox"><label class="sk-toggleable__label" for="41cbcb8c-c606-482b-bf71-dae5eb388d70">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="61298cb6-dbac-4c0a-855f-63df1f8bc1a5" type="checkbox"><label class="sk-toggleable__label" for="61298cb6-dbac-4c0a-855f-63df1f8bc1a5">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d007f7fc-b374-48aa-926b-70e9512e4d0f" type="checkbox"><label class="sk-toggleable__label" for="d007f7fc-b374-48aa-926b-70e9512e4d0f">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="08801173-dfb5-43d0-98e2-bb1a6e5d4c27" type="checkbox"><label class="sk-toggleable__label" for="08801173-dfb5-43d0-98e2-bb1a6e5d4c27">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="81ae02be-cfbc-4dc2-b20c-f1b7e2270fd1" type="checkbox"><label class="sk-toggleable__label" for="81ae02be-cfbc-4dc2-b20c-f1b7e2270fd1">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2d7e28c5-0ab9-4ec2-a3f6-612249dbb6a4" type="checkbox"><label class="sk-toggleable__label" for="2d7e28c5-0ab9-4ec2-a3f6-612249dbb6a4">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fc388b82-b866-4fc8-8b70-2780271716c6" type="checkbox"><label class="sk-toggleable__label" for="fc388b82-b866-4fc8-8b70-2780271716c6">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>If you find it useful to know how long a search takes, but verbose mode is a bit too verbose for you, another option is to remove the <code>verbose</code> parameter and instead prefix the second line with <code>%time</code>. This is known as an IPython line magic, and it will work as long as you’re using the Jupyter notebook or the IPython interpreter.</p>
<p>All this command does is tell you how long a particular line of code took to run. The number to focus on is the wall time.</p>
<div id="7b5f1cc9" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(pipe, params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time grid.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 217 ms, sys: 9.15 ms, total: 226 ms
Wall time: 729 ms</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="35">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cc0d532a-25e4-4515-bb75-574698dbcfb1" type="checkbox"><label class="sk-toggleable__label" for="cc0d532a-25e4-4515-bb75-574698dbcfb1">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        (...
                                        LogisticRegression(random_state=1,
                                                           solver='liblinear'))]),
             n_jobs=-1,
             param_grid={'columntransformer__countvectorizer__ngram_range': [(1,
                                                                              1),
                                                                             (1,
                                                                              2)],
                         'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                              'first'],
                         'columntransformer__simpleimputer__add_indicator': [False,
                                                                             True],
                         'logisticregression__C': [0.1, 1, 10],
                         'logisticregression__penalty': ['l1', 'l2']},
             scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="35014f45-279f-40dc-9476-8979978b681b" type="checkbox"><label class="sk-toggleable__label" for="35014f45-279f-40dc-9476-8979978b681b">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="42ea0afd-3cf6-4040-a07f-718fbce6a37b" type="checkbox"><label class="sk-toggleable__label" for="42ea0afd-3cf6-4040-a07f-718fbce6a37b">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7472084a-33cc-41e5-bed0-ef561fa6bbc0" type="checkbox"><label class="sk-toggleable__label" for="7472084a-33cc-41e5-bed0-ef561fa6bbc0">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cc7d3090-3a85-479f-b4d6-932e7e672126" type="checkbox"><label class="sk-toggleable__label" for="cc7d3090-3a85-479f-b4d6-932e7e672126">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="40e6c4c2-5f62-41ac-b6af-a2c572de660b" type="checkbox"><label class="sk-toggleable__label" for="40e6c4c2-5f62-41ac-b6af-a2c572de660b">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="75832fa0-6c7d-4ba7-a1a2-42cabeaaaf81" type="checkbox"><label class="sk-toggleable__label" for="75832fa0-6c7d-4ba7-a1a2-42cabeaaaf81">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="61580a58-f352-4156-9e98-70d6e9bddd37" type="checkbox"><label class="sk-toggleable__label" for="61580a58-f352-4156-9e98-70d6e9bddd37">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d6b39832-cb89-46c8-a0b1-0549ca2e919c" type="checkbox"><label class="sk-toggleable__label" for="d6b39832-cb89-46c8-a0b1-0549ca2e919c">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2d403946-243e-439f-9bd9-326759f5b6cf" type="checkbox"><label class="sk-toggleable__label" for="2d403946-243e-439f-9bd9-326759f5b6cf">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="25b3ab1e-daf9-4e52-89bc-970d87cd1e3b" type="checkbox"><label class="sk-toggleable__label" for="25b3ab1e-daf9-4e52-89bc-970d87cd1e3b">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7bcdf1cb-bab3-409a-9335-3f3db286281a" type="checkbox"><label class="sk-toggleable__label" for="7bcdf1cb-bab3-409a-9335-3f3db286281a">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>My general recommendation is to set <code>n_jobs</code> to -1 any time you’re running a grid search, which is what I’ll do for the rest of the book. However, it’s still a good idea to use <code>%time</code> or verbose mode to confirm that parallel processing is actually reducing the search time on your particular machine.</p>
</section>
<section id="qa-how-do-i-tune-a-pipeline-with-randomized-search" class="level2" data-number="10.8">
<h2 data-number="10.8" class="anchored" data-anchor-id="qa-how-do-i-tune-a-pipeline-with-randomized-search"><span class="header-section-number">10.8</span> Q&amp;A: How do I tune a Pipeline with randomized search?</h2>
<p>When you provide a set of parameter values to <code>GridSearchCV</code>, it will cross-validate every possible combination of those parameters. For example, we know that with this set of parameters, cross-validation will run 48 times.</p>
<div id="2229e793" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>{'logisticregression__penalty': ['l1', 'l2'],
 'logisticregression__C': [0.1, 1, 10],
 'columntransformer__pipeline__onehotencoder__drop': [None, 'first'],
 'columntransformer__countvectorizer__ngram_range': [(1, 1), (1, 2)],
 'columntransformer__simpleimputer__add_indicator': [False, True]}</code></pre>
</div>
</div>
<p>Let’s say that we wanted to try additional <code>C</code> values for logistic regression. I’ll make a copy of the <code>params</code> dictionary called <code>more_params</code>, and then modify the <code>C</code> parameter in this dictionary to have 6 possible values instead of 3.</p>
<div id="bbe1f19d" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>more_params <span class="op">=</span> params.copy()</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>more_params[<span class="st">'logisticregression__C'</span>] <span class="op">=</span> [<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since there are twice as many <code>C</code> values, we know that a grid search will take twice as long, meaning it will run cross-validation 96 times. But what if that grid search takes more time than we have available?</p>
<p>An alternative method we can use is called randomized search, which is implemented in the <code>RandomizedSearchCV</code> class. We’ll import it from the <code>model_selection</code> module and then create an instance.</p>
<p>The API is very similar to <code>GridSearchCV</code>, except that you also specify the number of times it should run using the <code>n_iter</code> parameter. In this case, we’ll set the number of iterations to be 10.</p>
<p>Each time it runs, it will pick out a set of parameters at random and cross-validate that parameter set. In other words, it does the same thing as <code>GridSearchCV</code>, except that it picks out random combinations of parameters from the parameter dictionary rather than trying every single combination. Because there’s an element of randomness, we’ll also set the <code>random_state</code> parameter to 1 for reproducibility.</p>
<p>We’ll use the <code>fit</code> method to run the search, and because it will only try 10 combinations instead of 96 combinations, it will run about 10 times faster than a grid search would.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>How to use RandomizedSearchCV:</strong></p>
<ul>
<li><strong><code>n_iter</code>:</strong> Specify the number of randomly-chosen parameter combinations to cross-validate</li>
<li><strong><code>random_state</code>:</strong> Set to any integer for reproducibility</li>
</ul>
</div>
</div>
</div>
<div id="91cee6f2" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> RandomizedSearchCV</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>rand <span class="op">=</span> RandomizedSearchCV(pipe, more_params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                          n_iter<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">1</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>rand.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c3c8a359-1391-406a-b71d-9bc6cfa7c975" type="checkbox"><label class="sk-toggleable__label" for="c3c8a359-1391-406a-b71d-9bc6cfa7c975">RandomizedSearchCV</label><div class="sk-toggleable__content"><pre>RandomizedSearchCV(cv=5,
                   estimator=Pipeline(steps=[('columntransformer',
                                              ColumnTransformer(transformers=[('pipeline',
                                                                               Pipeline(steps=[('simpleimputer',
                                                                                                SimpleImputer(fill_value='missing',
                                                                                                              strategy='constant')),
                                                                                               ('onehotencoder',
                                                                                                OneHotEncoder())]),
                                                                               ['Embarked',
                                                                                'Sex']),
                                                                              ('countvectorizer',
                                                                               CountVectorizer(),
                                                                               'Name'),
                                                                              ('simpleimputer',
                                                                               SimpleImputer(),
                                                                               ['Age',
                                                                                'Far...
                   n_jobs=-1,
                   param_distributions={'columntransformer__countvectorizer__ngram_range': [(1,
                                                                                             1),
                                                                                            (1,
                                                                                             2)],
                                        'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                                             'first'],
                                        'columntransformer__simpleimputer__add_indicator': [False,
                                                                                            True],
                                        'logisticregression__C': [0.01, 0.1, 1,
                                                                  10, 100,
                                                                  1000],
                                        'logisticregression__penalty': ['l1',
                                                                        'l2']},
                   random_state=1, scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="31e9a7e7-ed8a-4e42-8a05-a71deb3660fd" type="checkbox"><label class="sk-toggleable__label" for="31e9a7e7-ed8a-4e42-8a05-a71deb3660fd">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1f072a46-4da5-491e-a487-f064dec1800c" type="checkbox"><label class="sk-toggleable__label" for="1f072a46-4da5-491e-a487-f064dec1800c">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="17c44ef4-099b-477a-9c12-d67ea1cd31fe" type="checkbox"><label class="sk-toggleable__label" for="17c44ef4-099b-477a-9c12-d67ea1cd31fe">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0898b0de-90f4-48ef-90d2-024aa758fe8e" type="checkbox"><label class="sk-toggleable__label" for="0898b0de-90f4-48ef-90d2-024aa758fe8e">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="62661f74-ce05-4e52-8868-f271fcd4d2f4" type="checkbox"><label class="sk-toggleable__label" for="62661f74-ce05-4e52-8868-f271fcd4d2f4">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9d9e4194-dd7e-48f2-84d9-af30e382f5d1" type="checkbox"><label class="sk-toggleable__label" for="9d9e4194-dd7e-48f2-84d9-af30e382f5d1">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5a656977-9e32-4fdf-b192-4fbdecd85a01" type="checkbox"><label class="sk-toggleable__label" for="5a656977-9e32-4fdf-b192-4fbdecd85a01">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4adf64c7-9402-4957-9f32-397a95d51d20" type="checkbox"><label class="sk-toggleable__label" for="4adf64c7-9402-4957-9f32-397a95d51d20">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e5ebab43-5c93-44da-9589-bb98c6fb6190" type="checkbox"><label class="sk-toggleable__label" for="e5ebab43-5c93-44da-9589-bb98c6fb6190">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5799f227-ad34-4368-abae-4d7cb262ccfe" type="checkbox"><label class="sk-toggleable__label" for="5799f227-ad34-4368-abae-4d7cb262ccfe">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="93b3d102-6057-451a-80d2-d7b9400ba578" type="checkbox"><label class="sk-toggleable__label" for="93b3d102-6057-451a-80d2-d7b9400ba578">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>By printing out the results of the search, you can see that it ran 10 times using random combinations of all of those parameters.</p>
<div id="642ab6d2" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> (pd.DataFrame(rand.cv_results_)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>           .<span class="bu">filter</span>(regex<span class="op">=</span><span class="st">'param_|mean_test|rank'</span>))</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>results.columns <span class="op">=</span> results.columns.<span class="bu">str</span>.split(<span class="st">'__'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">penalty</th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">add_indicator</th>
<th data-quarto-table-cell-role="th">drop</th>
<th data-quarto-table-cell-role="th">ngram_range</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>l1</td>
<td>1</td>
<td>True</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.814820</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>l2</td>
<td>10</td>
<td>False</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.809234</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>l1</td>
<td>1000</td>
<td>True</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.811437</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>l2</td>
<td>1000</td>
<td>False</td>
<td>None</td>
<td>(1, 2)</td>
<td>0.810345</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>l1</td>
<td>10</td>
<td>False</td>
<td>first</td>
<td>(1, 2)</td>
<td>0.824889</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>l1</td>
<td>0.1</td>
<td>False</td>
<td>first</td>
<td>(1, 2)</td>
<td>0.777785</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>l2</td>
<td>1</td>
<td>True</td>
<td>None</td>
<td>(1, 2)</td>
<td>0.804739</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>l1</td>
<td>100</td>
<td>True</td>
<td>first</td>
<td>(1, 1)</td>
<td>0.813684</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>l1</td>
<td>100</td>
<td>False</td>
<td>first</td>
<td>(1, 2)</td>
<td>0.827129</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>l2</td>
<td>0.01</td>
<td>True</td>
<td>first</td>
<td>(1, 2)</td>
<td>0.744184</td>
<td>10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You might be surprised to know that the best score it found, 0.827, is almost as high as the best score found by our grid search earlier in the chapter, which was 0.828. That being said, we did try additional <code>C</code> values in our randomized search, so the comparison isn’t entirely fair.</p>
<div id="4ff6b729" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>rand.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>0.8271294959512898</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> 0.828</li>
<li><strong>Randomized search (more <code>C</code> values):</strong> <mark>0.827</mark></li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
<p>Here’s the set of parameters that produced that score.</p>
<div id="1b977e10" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>rand.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>{'logisticregression__penalty': 'l1',
 'logisticregression__C': 100,
 'columntransformer__simpleimputer__add_indicator': False,
 'columntransformer__pipeline__onehotencoder__drop': 'first',
 'columntransformer__countvectorizer__ngram_range': (1, 2)}</code></pre>
</div>
</div>
<p>There are four things I especially like about using a randomized search instead of a grid search:</p>
<p>First, randomized search will usually find the best result (or almost the best result) in far less time than grid search, which is what we saw above. This is because there are often a lot of parameter combinations that will produce similar results to one another.</p>
<p>Second, it’s easier to control the computational budget of a randomized search. You can test how long a small number of searches takes, and then if you have a certain amount of time available for a search, you can simply choose the number of iterations that can be completed within that time period.</p>
<p>Third, randomized search gives you the freedom to tune many more model and transformer parameters without worrying that it will take forever. You can try out a ton of different parameters for a short amount of time, and then narrow down which parameters to focus on based on what seems to be working. (We’ll see this in practice in the next chapter.)</p>
<p>Fourth, randomized search will sometimes produce even better results than grid search because you can try a finer grid. For example, let’s say you were tuning a parameter that allowed continuous values from 0 to 1. If you were using a grid search, you might try the values 0, 0.5, and 1. But if you were using randomized search, you might try the values 0, 0.01, 0.02, and so on. It may turn out that the best value for this parameter is around 0.3, and randomized search could help you to find that out, whereas this grid search would have no chance of finding that out.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Why use RandomizedSearchCV instead of GridSearchCV?</strong></p>
<ul>
<li>Similar results in far less time</li>
<li>Easier to control the computational budget</li>
<li>Freedom to tune many more parameters</li>
<li>Can use a much finer grid</li>
</ul>
</div>
</div>
</div>
<p>If you do need to create a fine grid of numbers for a randomized search, one useful function is NumPy’s <code>linspace</code>. For example, this code specifies that I want 101 equally spaced values, starting with 0 and ending with 1.</p>
<div id="b4898477" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">101</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>array([0.  , 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.1 ,
       0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.2 , 0.21,
       0.22, 0.23, 0.24, 0.25, 0.26, 0.27, 0.28, 0.29, 0.3 , 0.31, 0.32,
       0.33, 0.34, 0.35, 0.36, 0.37, 0.38, 0.39, 0.4 , 0.41, 0.42, 0.43,
       0.44, 0.45, 0.46, 0.47, 0.48, 0.49, 0.5 , 0.51, 0.52, 0.53, 0.54,
       0.55, 0.56, 0.57, 0.58, 0.59, 0.6 , 0.61, 0.62, 0.63, 0.64, 0.65,
       0.66, 0.67, 0.68, 0.69, 0.7 , 0.71, 0.72, 0.73, 0.74, 0.75, 0.76,
       0.77, 0.78, 0.79, 0.8 , 0.81, 0.82, 0.83, 0.84, 0.85, 0.86, 0.87,
       0.88, 0.89, 0.9 , 0.91, 0.92, 0.93, 0.94, 0.95, 0.96, 0.97, 0.98,
       0.99, 1.  ])</code></pre>
</div>
</div>
<p>Another similar function is NumPy’s <code>logspace</code>. This code specifies that I want 6 values, from 10 to the negative 2nd power through 10 to the 3rd power.</p>
<div id="c4fd0d44" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>np.logspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>array([1.e-02, 1.e-01, 1.e+00, 1.e+01, 1.e+02, 1.e+03])</code></pre>
</div>
</div>
<p>If you’re comfortable using the SciPy library, you can instead specify continuous parameters for a randomized search using SciPy distributions. However, I find it much easier to just use NumPy’s <code>linspace</code> and <code>logspace</code> functions.</p>
</section>
<section id="qa-whats-the-target-accuracy-we-are-trying-to-achieve" class="level2" data-number="10.9">
<h2 data-number="10.9" class="anchored" data-anchor-id="qa-whats-the-target-accuracy-we-are-trying-to-achieve"><span class="header-section-number">10.9</span> Q&amp;A: What’s the target accuracy we are trying to achieve?</h2>
<p>When you’re building and tuning a modeling <code>Pipeline</code>, it’s natural to wonder how you’ll know when you’re done. In other words, how good of a model is “good enough”? There are three ways that I tend to think about this question.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>When is a model “good enough”?</strong></p>
<ul>
<li><strong>Useful model:</strong> Outperforms null accuracy</li>
<li><strong>Best possible model:</strong> Usually impossible to know the theoretical maximum accuracy</li>
<li><strong>Practical model:</strong> Continue improving until you run out of resources</li>
</ul>
</div>
</div>
</div>
<p>The first way is to ask the question: What is the minimum accuracy that we need to achieve for our model to be considered useful? In most cases, you want your model to at least outperform null accuracy, which is the accuracy you could achieve by always predicting the most frequent class.</p>
<p>To calculate the null accuracy for our training data, we use the <code>value_counts</code> method on <code>y</code>, and set <code>normalize</code> to <code>True</code> in order to display the counts as a percentage. From the results, we can see that class 0 is the most frequent class, and about 61.6% of the <code>y</code> values are class 0.</p>
<div id="31f103a4" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>y.value_counts(normalize<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>0    0.616162
1    0.383838
Name: Survived, dtype: float64</code></pre>
</div>
</div>
<p>Thus the null accuracy for this problem is 61.6%, since an uninformed model, also known as the null model, could achieve that accuracy simply by predicting class 0 in all cases. In other words, this is the accuracy level that we want to outperform, otherwise the model is not providing any value. Thankfully, all of our <code>Pipeline</code>s are outperforming null accuracy by a considerable amount.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> 0.828</li>
<li><strong>Randomized search (more <code>C</code> values):</strong> 0.827</li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
<li><strong>Null model:</strong> <mark>0.616</mark></li>
</ul>
</div>
</div>
</div>
<p>The second way to think about this question is to ask: What is the maximum accuracy we could eventually reach? For most real problems, it’s impossible to know how accurate your model could be if you did enough tuning and tried enough models. It’s also impossible to know how accurate your model could be if you gathered more samples or more features. The main exception to this is if you’re working on a well-studied research problem, because in that case there may be a state-of-the-art benchmark that everyone is trying to surpass.</p>
<p>Thus in most practical circumstances, you don’t set a target accuracy. Instead, you work to improve the model until you run out of time, money, or ideas.</p>
</section>
<section id="qa-is-it-okay-that-our-model-includes-thousands-of-features" class="level2" data-number="10.10">
<h2 data-number="10.10" class="anchored" data-anchor-id="qa-is-it-okay-that-our-model-includes-thousands-of-features"><span class="header-section-number">10.10</span> Q&amp;A: Is it okay that our model includes thousands of features?</h2>
<p>The <code>pipe</code> object is our <code>Pipeline</code> that hasn’t been tuned by grid search. Recall that you can examine an individual <code>Pipeline</code> step by using the <code>named_steps</code> attribute. In this case, we’ll select the first step, which is our <code>ColumnTransformer</code>.</p>
<div id="958d1d4a" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>pipe.named_steps[<span class="st">'columntransformer'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6f34653a-04e0-4802-b048-1632b8214481" type="checkbox"><label class="sk-toggleable__label" for="6f34653a-04e0-4802-b048-1632b8214481">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7a5b7e36-03e8-4598-bb6c-6867d6f4e11f" type="checkbox"><label class="sk-toggleable__label" for="7a5b7e36-03e8-4598-bb6c-6867d6f4e11f">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2cbe1738-e539-44e1-891d-4f38eb9acf47" type="checkbox"><label class="sk-toggleable__label" for="2cbe1738-e539-44e1-891d-4f38eb9acf47">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="72db979a-9267-41bf-b957-99a42dcb159b" type="checkbox"><label class="sk-toggleable__label" for="72db979a-9267-41bf-b957-99a42dcb159b">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fa01ba3b-3ac9-4db3-9eb3-e397c378763a" type="checkbox"><label class="sk-toggleable__label" for="fa01ba3b-3ac9-4db3-9eb3-e397c378763a">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="032a6176-c5c8-416f-b2a8-659314de00c0" type="checkbox"><label class="sk-toggleable__label" for="032a6176-c5c8-416f-b2a8-659314de00c0">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7877134c-9e56-433b-8f4b-a964adbddee9" type="checkbox"><label class="sk-toggleable__label" for="7877134c-9e56-433b-8f4b-a964adbddee9">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d663c4e0-ddc7-40a8-850d-c26bbff96f06" type="checkbox"><label class="sk-toggleable__label" for="d663c4e0-ddc7-40a8-850d-c26bbff96f06">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4018fd19-81bc-491b-8dd2-d613070f8c16" type="checkbox"><label class="sk-toggleable__label" for="4018fd19-81bc-491b-8dd2-d613070f8c16">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9021f074-d3f0-4a7e-92ac-78b96e25b138" type="checkbox"><label class="sk-toggleable__label" for="9021f074-d3f0-4a7e-92ac-78b96e25b138">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>By passing <code>X</code> to its <code>fit_transform</code> method, we can see that the <code>ColumnTransformer</code> outputs 1518 feature columns. As we saw in <a href="ch08.html#sec-8-4" class="quarto-xref">lesson&nbsp;<span>8.4</span></a>, all except 9 of those features were created from the Name column by <code>CountVectorizer</code>.</p>
<div id="28598c14" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>pipe.named_steps[<span class="st">'columntransformer'</span>].fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>&lt;891x1518 sparse matrix of type '&lt;class 'numpy.float64'&gt;'
    with 7328 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
<p>The cross-validated accuracy of this <code>Pipeline</code> is 0.811, which we’ve been calling the baseline accuracy against which other <code>Pipeline</code>s can be compared.</p>
<div id="3db5fab6" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>cross_val_score(pipe, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>0.8114619295712762</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> 0.828</li>
<li><strong>Randomized search (more <code>C</code> values):</strong> 0.827</li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Baseline (no tuning):</strong> <mark>0.811</mark></li>
<li><strong>Null model:</strong> 0.616</li>
</ul>
</div>
</div>
</div>
<p>Similarly, we can select the <code>ColumnTransformer</code> from our <code>Pipeline</code> that was tuned by grid search. Notice that the <code>ngram_range</code> for <code>CountVectorizer</code> is <code>(1, 2)</code>, meaning <code>CountVectorizer</code> will create features from both unigrams and bigrams in the Name column.</p>
<div id="e09147e0" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_.named_steps[<span class="st">'columntransformer'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3055765a-17a8-4130-a97a-2cb3adf44ba3" type="checkbox"><label class="sk-toggleable__label" for="3055765a-17a8-4130-a97a-2cb3adf44ba3">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer',
                                 CountVectorizer(ngram_range=(1, 2)), 'Name'),
                                ('simpleimputer',
                                 SimpleImputer(add_indicator=True),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b396bcfe-252c-4e18-a4cb-e487dd33433a" type="checkbox"><label class="sk-toggleable__label" for="b396bcfe-252c-4e18-a4cb-e487dd33433a">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c88d4aad-f506-45c5-a0d7-0267a2748de8" type="checkbox"><label class="sk-toggleable__label" for="c88d4aad-f506-45c5-a0d7-0267a2748de8">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="271bf522-b781-46b6-b89b-26cb5d771c91" type="checkbox"><label class="sk-toggleable__label" for="271bf522-b781-46b6-b89b-26cb5d771c91">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="094b07a6-0680-4c7c-b0fc-d3cdb63a7753" type="checkbox"><label class="sk-toggleable__label" for="094b07a6-0680-4c7c-b0fc-d3cdb63a7753">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b51b63ce-deb7-434b-b37e-48ea946ac189" type="checkbox"><label class="sk-toggleable__label" for="b51b63ce-deb7-434b-b37e-48ea946ac189">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer(ngram_range=(1, 2))</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0e2f7e14-6b71-40bd-a2fc-86ab990cad4e" type="checkbox"><label class="sk-toggleable__label" for="0e2f7e14-6b71-40bd-a2fc-86ab990cad4e">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c97d496e-95e1-47e9-9b58-799c5481b398" type="checkbox"><label class="sk-toggleable__label" for="c97d496e-95e1-47e9-9b58-799c5481b398">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(add_indicator=True)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6070ff71-f65d-4ab1-946d-371c3696b9a6" type="checkbox"><label class="sk-toggleable__label" for="6070ff71-f65d-4ab1-946d-371c3696b9a6">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4ec948f9-f35f-4dbb-b959-4ba200f544b2" type="checkbox"><label class="sk-toggleable__label" for="4ec948f9-f35f-4dbb-b959-4ba200f544b2">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>By using <code>fit_transform</code>, we can see that this <code>ColumnTransformer</code> outputs 3671 feature columns. Again, all except 9 of those features were created from the Name column.</p>
<div id="bceafc2f" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_.named_steps[<span class="st">'columntransformer'</span>].fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>&lt;891x3671 sparse matrix of type '&lt;class 'numpy.float64'&gt;'
    with 10191 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
<p>The cross-validated accuracy of this <code>Pipeline</code> is 0.828.</p>
<div id="02a2ab37" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>grid.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>0.828253091456908</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> <mark>0.828</mark></li>
<li><strong>Randomized search (more <code>C</code> values):</strong> 0.827</li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
<li><strong>Null model:</strong> 0.616</li>
</ul>
</div>
</div>
</div>
<p>Finally, let’s compare these two <code>Pipeline</code>s to a <code>Pipeline</code> that doesn’t include the Name column at all. First, we’ll create a <code>ColumnTransformer</code> called <code>no_name_ct</code> that excludes Name.</p>
<div id="5e134f6f" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>no_name_ct <span class="op">=</span> make_column_transformer(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    (imp_ohe, [<span class="st">'Embarked'</span>, <span class="st">'Sex'</span>]),</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    (imp, [<span class="st">'Age'</span>, <span class="st">'Fare'</span>]),</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'passthrough'</span>, [<span class="st">'Parch'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you can see, this <code>ColumnTransformer</code> only outputs 9 feature columns.</p>
<div id="9546662b" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>no_name_ct.fit_transform(X).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>(891, 9)</code></pre>
</div>
</div>
<p>Then, we’ll add <code>no_name_ct</code> to a <code>Pipeline</code> called <code>no_name_pipe</code> and cross-validate it. The accuracy is 0.783, which is significantly lower than the <code>Pipeline</code>s that included the Name column. To be fair, this <code>Pipeline</code> hasn’t been tuned, though honestly there is no hyperparameter tuning we could do to make it perform as well as the <code>Pipeline</code>s that included the Name column.</p>
<div id="7eaea059" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>no_name_pipe <span class="op">=</span> make_pipeline(no_name_ct, logreg)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>cross_val_score(no_name_pipe, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>0.7833908731404181</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> 0.828</li>
<li><strong>Randomized search (more <code>C</code> values):</strong> 0.827</li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
<li><strong>Baseline excluding Name (no tuning):</strong> <mark>0.783</mark></li>
<li><strong>Null model:</strong> 0.616</li>
</ul>
</div>
</div>
</div>
<p>Here are some conclusions that we can draw from this experiment:</p>
<ul>
<li>First, including the Name column in the <code>Pipeline</code> significantly increased the cross-validated accuracy, which means that adding those thousands of feature columns did not result in overfitting. Instead, it tells us that the Name column contains more predictive signal than noise with respect to the target.</li>
<li>More generally, this experiment tells us that having more features than samples does not necessarily result in overfitting.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>What did we learn?</strong></p>
<ul>
<li>Name column contains more predictive signal than noise</li>
<li>More features than samples does not necessarily result in overfitting</li>
</ul>
</div>
</div>
</div>
<p>It’s worth noting that there is additional tuning we could do to <code>CountVectorizer</code> to reduce the number of features it creates. However, there’s no way to know whether that would increase or decrease the <code>Pipeline</code>’s accuracy without actually trying it.</p>
</section>
<section id="qa-how-do-i-examine-the-coefficients-of-a-pipeline" class="level2" data-number="10.11">
<h2 data-number="10.11" class="anchored" data-anchor-id="qa-how-do-i-examine-the-coefficients-of-a-pipeline"><span class="header-section-number">10.11</span> Q&amp;A: How do I examine the coefficients of a Pipeline?</h2>
<p>Recall that once a grid search is complete, <code>GridSearchCV</code> automatically refits the <code>Pipeline</code> on <code>X</code> and <code>y</code> and stores it as an attribute called <code>best_estimator_</code>. Therefore, we can access the model coefficients by first selecting the <code>logisticregression</code> step and then selecting the <code>coef_</code> attribute.</p>
<div id="df2892b9" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_.named_steps[<span class="st">'logisticregression'</span>].coef_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>array([[ 0.56431161,  0.        , -0.08767203, ...,  0.01408723,
        -0.43713268, -0.46358519]])</code></pre>
</div>
</div>
<p>Ideally, we would also be able to get the names of the features that correspond to these coefficients by running the <code>get_feature_names</code> method on the <code>ColumnTransformer</code> step. However, <code>get_feature_names</code> only works if all of the underlying transformers have a <code>get_feature_names</code> method, and that is not the case here.</p>
<div id="32e43e1e" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_.named_steps[<span class="st">'columntransformer'</span>].get_feature_names()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="873db78d" class="cell" data-execution_count="66">
<div class="cell-output cell-output-stdout">
<pre><code>AttributeError: Transformer pipeline does not provide get_feature_names</code></pre>
</div>
</div>
<p>Instead, as we saw previously in <a href="ch08.html#sec-8-4" class="quarto-xref">lesson&nbsp;<span>8.4</span></a>, you would have to inspect the transformers one-by-one in order to determine the feature names.</p>
<div id="bbb9f536" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_.named_steps[<span class="st">'columntransformer'</span>].transformers_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>[('pipeline',
  Pipeline(steps=[('simpleimputer',
                   SimpleImputer(fill_value='missing', strategy='constant')),
                  ('onehotencoder', OneHotEncoder())]),
  ['Embarked', 'Sex']),
 ('countvectorizer', CountVectorizer(ngram_range=(1, 2)), 'Name'),
 ('simpleimputer', SimpleImputer(add_indicator=True), ['Age', 'Fare']),
 ('passthrough', 'passthrough', ['Parch'])]</code></pre>
</div>
</div>
<p>Note that starting in scikit-learn version 1.1, the <code>get_feature_names_out</code> method should work on this <code>ColumnTransformer</code>, since the <code>get_feature_names_out</code> method will be available for all transformers.</p>
</section>
<section id="sec-10-12" class="level2" data-number="10.12">
<h2 data-number="10.12" class="anchored" data-anchor-id="sec-10-12"><span class="header-section-number">10.12</span> Q&amp;A: Should I split the dataset before tuning the Pipeline?</h2>
<p>When we perform a grid search, we’re trying to find the parameters that maximize the cross-validation score on a dataset. Thus, we’re using the same data to accomplish two separate goals:</p>
<ul>
<li>First, to choose the best parameters for the <code>Pipeline</code>, which are stored in the <code>best_params_</code> attribute.</li>
<li>Second, to estimate the future performance of the <code>Pipeline</code>on new data when using these parameters, which is stored in the <code>best_score_</code> attribute.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Goals of a grid search:</strong></p>
<ul>
<li>Choose the best parameters for the Pipeline</li>
<li>Estimate its performance on new data when using these parameters</li>
</ul>
</div>
</div>
</div>
<div id="b182e26b" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>grid.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>{'columntransformer__countvectorizer__ngram_range': (1, 2),
 'columntransformer__pipeline__onehotencoder__drop': None,
 'columntransformer__simpleimputer__add_indicator': True,
 'logisticregression__C': 10,
 'logisticregression__penalty': 'l1'}</code></pre>
</div>
</div>
<div id="ee6d2719" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>grid.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>0.828253091456908</code></pre>
</div>
</div>
<p>Using the same data for these two separate goals actually biases the <code>Pipeline</code> to this dataset and can result in overly optimistic scores.</p>
<p>If your main objective is to choose the best parameters, then this process is totally fine. You’ll just have to accept that its actual performance on new data may be lower than the performance estimated by grid search.</p>
<p>But if you also need a realistic estimate of the <code>Pipeline</code>’s performance on new data, then there’s an alternative process you can use, which I’ll walk you through in this lesson.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Is it okay to use the same data for both goals?</strong></p>
<ul>
<li><strong>Yes:</strong> If your main objective is to choose the best parameters</li>
<li><strong>No:</strong> If you need a realistic estimate of performance on new data</li>
</ul>
</div>
</div>
</div>
<p>To start, we’ll import the <code>train_test_split</code> function from the <code>model_selection</code> module, and use it to split the data into training and testing sets, with 75% of the data as training and 25% of the data as testing. Note that I set the <code>stratify</code> parameter to <code>y</code> so that the class proportions will be approximately equal in the training and testing sets.</p>
<div id="c10d8215" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.25</span>,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>                                                    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>                                                    stratify<span class="op">=</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we’ll create a new <code>GridSearchCV</code> object called <code>training_grid</code>. When we run the grid search, we’ll only pass it the training set so that the tuning process only takes the training set into account.</p>
<div id="0fe51ec5" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>training_grid <span class="op">=</span> GridSearchCV(pipe, params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>,</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>                             n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>training_grid.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f86a8fe0-c678-4c19-be51-e8b282495eaf" type="checkbox"><label class="sk-toggleable__label" for="f86a8fe0-c678-4c19-be51-e8b282495eaf">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        (...
                                        LogisticRegression(random_state=1,
                                                           solver='liblinear'))]),
             n_jobs=-1,
             param_grid={'columntransformer__countvectorizer__ngram_range': [(1,
                                                                              1),
                                                                             (1,
                                                                              2)],
                         'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                              'first'],
                         'columntransformer__simpleimputer__add_indicator': [False,
                                                                             True],
                         'logisticregression__C': [0.1, 1, 10],
                         'logisticregression__penalty': ['l1', 'l2']},
             scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="958ef311-9f28-45c4-854e-94b46d646482" type="checkbox"><label class="sk-toggleable__label" for="958ef311-9f28-45c4-854e-94b46d646482">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2a989b57-1752-482d-84ad-e62b38e2bb04" type="checkbox"><label class="sk-toggleable__label" for="2a989b57-1752-482d-84ad-e62b38e2bb04">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="889c873c-0605-42b7-bfb0-78d194e22ce4" type="checkbox"><label class="sk-toggleable__label" for="889c873c-0605-42b7-bfb0-78d194e22ce4">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="194b1c90-aa3a-4ddc-aead-d54d8608130a" type="checkbox"><label class="sk-toggleable__label" for="194b1c90-aa3a-4ddc-aead-d54d8608130a">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d3410916-f22b-48a2-958e-06b8a96163b7" type="checkbox"><label class="sk-toggleable__label" for="d3410916-f22b-48a2-958e-06b8a96163b7">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f69baa7b-5fc9-474c-8c99-17fee73e753b" type="checkbox"><label class="sk-toggleable__label" for="f69baa7b-5fc9-474c-8c99-17fee73e753b">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a9c4945f-5a54-444f-8f7e-55a379fe220d" type="checkbox"><label class="sk-toggleable__label" for="a9c4945f-5a54-444f-8f7e-55a379fe220d">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="23fd834d-1cd3-42ca-8771-13b2dcc610aa" type="checkbox"><label class="sk-toggleable__label" for="23fd834d-1cd3-42ca-8771-13b2dcc610aa">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c2126656-7bc8-4f62-b61a-c7c3385f7910" type="checkbox"><label class="sk-toggleable__label" for="c2126656-7bc8-4f62-b61a-c7c3385f7910">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c6f048b7-8ef0-46a5-a4de-aa6753007237" type="checkbox"><label class="sk-toggleable__label" for="c6f048b7-8ef0-46a5-a4de-aa6753007237">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d1be5d53-0fc6-4a9f-8f84-c24696f07907" type="checkbox"><label class="sk-toggleable__label" for="d1be5d53-0fc6-4a9f-8f84-c24696f07907">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>Here are the best parameters found by grid search on the training set.</p>
<div id="91dd8cb0" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>training_grid.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>{'columntransformer__countvectorizer__ngram_range': (1, 2),
 'columntransformer__pipeline__onehotencoder__drop': 'first',
 'columntransformer__simpleimputer__add_indicator': False,
 'logisticregression__C': 10,
 'logisticregression__penalty': 'l2'}</code></pre>
</div>
</div>
<p>We’re not actually interested in the best score found during the grid search. Instead, we’re going to use the best parameters found by the grid search to make predictions for the testing set, and then evaluate the accuracy of those predictions. We can do this by passing the testing set to the <code>training_grid</code>’s <code>score</code> method.</p>
<p>The accuracy it outputs is 0.816, which is a more realistic estimate of how the <code>Pipeline</code> will perform on new data, since the testing set is brand new data that the <code>Pipeline</code> has never seen. However, it’s still just a single realization of this model, and so it’s impossible to know how precise this value is.</p>
<div id="3fd02945" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>training_grid.score(X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>0.8161434977578476</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (5 parameters):</strong> 0.828</li>
<li><strong>Randomized search (more <code>C</code> values):</strong> 0.827</li>
<li><strong>Grid search (2 parameters):</strong> 0.818</li>
<li><strong>Grid search (estimate for new data):</strong> <mark>0.816</mark></li>
<li><strong>Baseline (no tuning):</strong> 0.811</li>
<li><strong>Baseline excluding Name (no tuning):</strong> 0.783</li>
<li><strong>Null model:</strong> 0.616</li>
</ul>
</div>
</div>
</div>
<p>Now that we’ve found the best parameters for the <code>Pipeline</code> and estimated its likely performance on new data, our final step is to actually make predictions on new data. Before making predictions, it’s critical that we train the <code>Pipeline</code> on all of our data, meaning the entirety of <code>X</code> and <code>y</code>, otherwise we’re throwing away valuable data.</p>
<p>In other words, we can’t simply use the <code>training_grid</code>’s <code>predict</code> method since it was only refit on <code>X_train</code> and <code>y_train</code>. Instead, we need to save the <code>Pipeline</code> with the best parameters, which we’ll call <code>best_pipe</code>, and fit it to <code>X</code> and <code>y</code>.</p>
<div id="c441daef" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>best_pipe <span class="op">=</span> training_grid.best_estimator_</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>best_pipe.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="04c14223-24d4-40fc-aced-708ccadbfc3d" type="checkbox"><label class="sk-toggleable__label" for="04c14223-24d4-40fc-aced-708ccadbfc3d">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('simpleimputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehotencoder',
                                                                   OneHotEncoder(drop='first'))]),
                                                  ['Embarked', 'Sex']),
                                                 ('countvectorizer',
                                                  CountVectorizer(ngram_range=(1,
                                                                               2)),
                                                  'Name'),
                                                 ('simpleimputer',
                                                  SimpleImputer(),
                                                  ['Age', 'Fare']),
                                                 ('passthrough', 'passthrough',
                                                  ['Parch'])])),
                ('logisticregression',
                 LogisticRegression(C=10, random_state=1, solver='liblinear'))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="693c7df4-4d20-4535-aedb-64c485d3b8e9" type="checkbox"><label class="sk-toggleable__label" for="693c7df4-4d20-4535-aedb-64c485d3b8e9">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder(drop='first'))]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer',
                                 CountVectorizer(ngram_range=(1, 2)), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7d0bd647-6573-4687-bb09-7450f9c36c61" type="checkbox"><label class="sk-toggleable__label" for="7d0bd647-6573-4687-bb09-7450f9c36c61">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="95b6c486-237a-41a1-8b13-8639338e4a86" type="checkbox"><label class="sk-toggleable__label" for="95b6c486-237a-41a1-8b13-8639338e4a86">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1fdec960-ba04-42ea-9b1c-3ef3b94d5ff7" type="checkbox"><label class="sk-toggleable__label" for="1fdec960-ba04-42ea-9b1c-3ef3b94d5ff7">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop='first')</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9255e590-c41c-4ebb-8180-89be33fbb687" type="checkbox"><label class="sk-toggleable__label" for="9255e590-c41c-4ebb-8180-89be33fbb687">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1b231822-6a13-40bf-a4b8-0c24c51e047a" type="checkbox"><label class="sk-toggleable__label" for="1b231822-6a13-40bf-a4b8-0c24c51e047a">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer(ngram_range=(1, 2))</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e6c6968f-8991-4ef3-8fb3-6f7e93879c41" type="checkbox"><label class="sk-toggleable__label" for="e6c6968f-8991-4ef3-8fb3-6f7e93879c41">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c5b7f340-4f68-41e4-80f9-4b6721931719" type="checkbox"><label class="sk-toggleable__label" for="c5b7f340-4f68-41e4-80f9-4b6721931719">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c74bded6-d5b8-49c6-94ef-052475715766" type="checkbox"><label class="sk-toggleable__label" for="c74bded6-d5b8-49c6-94ef-052475715766">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a0c2ffb4-1094-4c1a-ad35-b227be16bf9f" type="checkbox"><label class="sk-toggleable__label" for="a0c2ffb4-1094-4c1a-ad35-b227be16bf9f">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d89bd480-1a0b-46a3-a817-8fac7406a4ab" type="checkbox"><label class="sk-toggleable__label" for="d89bd480-1a0b-46a3-a817-8fac7406a4ab">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(C=10, random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>Now we can make predictions on new data.</p>
<div id="5e53549e" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>best_pipe.predict(X_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>array([0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1,
       1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1,
       1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1,
       1, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1,
       1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0,
       0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,
       1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1,
       1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1,
       0, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0,
       1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1,
       1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1,
       0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0,
       0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1,
       0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0,
       1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0,
       0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0,
       1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1,
       0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1])</code></pre>
</div>
</div>
<p>If you decide that you’re going to follow the process that I’ve just outlined, then there are two guidelines that are important to follow:</p>
<p>First, you should only use the testing set for evaluating <code>Pipeline</code> performance one time. If you keep tuning the <code>Pipeline</code> again and again, each time checking its performance on the testing set, you’re essentially tuning the <code>Pipeline</code> to the particulars of the testing set. At that point, it no longer functions as an independent data source and thus its performance estimates will become less reliable.</p>
<p>Second, it’s important that you have enough data overall in order for the training and testing sets to both be sufficiently large once the dataset has been split:</p>
<ul>
<li>If the training set is too small, then the grid search won’t have enough data to find the optimal tuning parameters.</li>
<li>If the testing set is too small, then it won’t be able to provide a reliable estimate of <code>Pipeline</code> performance.</li>
</ul>
<p>Both of these situations would defeat the purpose of splitting the dataset, and thus this approach is best when you have a large enough dataset. Unfortunately, it’s difficult to say in the abstract how much data is “enough”, since that depends on the particulars of the dataset and the problem.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Guidelines for using this process:</strong></p>
<ul>
<li><strong>Only use the testing set once:</strong>
<ul>
<li>If used multiple times, performance estimates will become less reliable</li>
</ul></li>
<li><strong>You must have enough data:</strong>
<ul>
<li>If training set is too small, grid search won’t find the optimal parameters</li>
<li>If testing set is too small, it won’t provide a reliable performance estimate</li>
</ul></li>
</ul>
</div>
</div>
</div>
</section>
<section id="qa-what-is-regularization" class="level2" data-number="10.13">
<h2 data-number="10.13" class="anchored" data-anchor-id="qa-what-is-regularization"><span class="header-section-number">10.13</span> Q&amp;A: What is regularization?</h2>
<p>Earlier in this chapter, we tuned the regularization parameters of logistic regression. In this lesson, I’ll briefly explain what regularization actually is.</p>
<p>Regularization is a process that constrains the size of a model’s coefficients in order to minimize overfitting. Overfitting is when your model fits too closely to patterns in the training data, which causes your model not to perform well when it makes predictions on new data.</p>
<p>Regularization minimizes overfitting by reducing the variance of the model. Thus if you believe a model is too complex, regularization will reduce the error due to variance more than it increases the error due to bias, resulting in a model that is more likely to generalize to new data.</p>
<p>In simpler terms, regularization makes your model a bit less flexible so that it’s more likely to follow the true patterns in the data and less likely to follow the noise. Regularization is especially useful when you have outliers in the training data, because regularization decreases the influence that outliers have on the model.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Brief explanation of regularization:</strong></p>
<ul>
<li>Constrains the size of model coefficients to minimize overfitting</li>
<li>Reduces the variance of an overly complex model to help the model generalize</li>
<li>Decreases model flexibility so that it follows the true patterns in the data</li>
</ul>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mlbook\.dataschool\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ch09.html" class="pagination-link" aria-label="Workflow review #2">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Workflow review #2</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ch11.html" class="pagination-link" aria-label="Comparing linear and non-linear models">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing linear and non-linear models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Kevin Markham. All Rights Reserved.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>