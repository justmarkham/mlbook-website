<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kevin Markham">
<meta name="description" content="A practical guide to help you transition from Machine Learning novice to skilled Machine Learning practitioner.">

<title>13&nbsp; Feature selection – Master Machine Learning with scikit-learn</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ch14.html" rel="next">
<link href="./ch12.html" rel="prev">
<link href="./favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-e32d5626311174d9f6538aca58dc36c7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://cdn.usefathom.com/script.js" data-site="AWKMQOCB" defer=""></script>


<meta property="og:title" content="13&nbsp; Feature selection – Master Machine Learning with scikit-learn">
<meta property="og:description" content="A Practical Guide to Building Better Models with Python">
<meta property="og:image" content="https://mlbook.dataschool.io/logo.png">
<meta property="og:site_name" content="Master Machine Learning with scikit-learn">
<meta property="og:image:height" content="141">
<meta property="og:image:width" content="266">
<meta name="twitter:title" content="13&nbsp; Feature selection – Master Machine Learning with scikit-learn">
<meta name="twitter:description" content="A Practical Guide to Building Better Models with Python">
<meta name="twitter:image" content="https://mlbook.dataschool.io/logo.png">
<meta name="twitter:image-height" content="141">
<meta name="twitter:image-width" content="266">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ch13.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Feature selection</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Master Machine Learning with scikit-learn</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Review of the Machine Learning workflow</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Encoding categorical features</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Improving your workflow with ColumnTransformer and Pipeline</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Workflow review #1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Encoding text data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Handling missing values</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Fixing common workflow problems</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Workflow review #2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Evaluating and tuning a Pipeline</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing linear and non-linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Ensembling multiple models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch13.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Feature selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Feature standardization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Feature engineering with custom transformers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Workflow review #3</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">High-cardinality categorical features</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch18.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Class imbalance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch19.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Class imbalance walkthrough</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch20.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Going further</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-to-feature-selection" id="toc-introduction-to-feature-selection" class="nav-link active" data-scroll-target="#introduction-to-feature-selection"><span class="header-section-number">13.1</span> Introduction to feature selection</a></li>
  <li><a href="#intrinsic-methods-l1-regularization" id="toc-intrinsic-methods-l1-regularization" class="nav-link" data-scroll-target="#intrinsic-methods-l1-regularization"><span class="header-section-number">13.2</span> Intrinsic methods: L1 regularization</a></li>
  <li><a href="#filter-methods-statistical-test-based-scoring" id="toc-filter-methods-statistical-test-based-scoring" class="nav-link" data-scroll-target="#filter-methods-statistical-test-based-scoring"><span class="header-section-number">13.3</span> Filter methods: Statistical test-based scoring</a></li>
  <li><a href="#filter-methods-model-based-scoring" id="toc-filter-methods-model-based-scoring" class="nav-link" data-scroll-target="#filter-methods-model-based-scoring"><span class="header-section-number">13.4</span> Filter methods: Model-based scoring</a></li>
  <li><a href="#filter-methods-summary" id="toc-filter-methods-summary" class="nav-link" data-scroll-target="#filter-methods-summary"><span class="header-section-number">13.5</span> Filter methods: Summary</a></li>
  <li><a href="#wrapper-methods-recursive-feature-elimination" id="toc-wrapper-methods-recursive-feature-elimination" class="nav-link" data-scroll-target="#wrapper-methods-recursive-feature-elimination"><span class="header-section-number">13.6</span> Wrapper methods: Recursive feature elimination</a></li>
  <li><a href="#qa-how-do-i-see-which-features-were-selected" id="toc-qa-how-do-i-see-which-features-were-selected" class="nav-link" data-scroll-target="#qa-how-do-i-see-which-features-were-selected"><span class="header-section-number">13.7</span> Q&amp;A: How do I see which features were selected?</a></li>
  <li><a href="#qa-are-the-selected-features-the-most-important-features" id="toc-qa-are-the-selected-features-the-most-important-features" class="nav-link" data-scroll-target="#qa-are-the-selected-features-the-most-important-features"><span class="header-section-number">13.8</span> Q&amp;A: Are the selected features the “most important” features?</a></li>
  <li><a href="#qa-is-it-okay-for-feature-selection-to-remove-one-hot-encoded-categories" id="toc-qa-is-it-okay-for-feature-selection-to-remove-one-hot-encoded-categories" class="nav-link" data-scroll-target="#qa-is-it-okay-for-feature-selection-to-remove-one-hot-encoded-categories"><span class="header-section-number">13.9</span> Q&amp;A: Is it okay for feature selection to remove one-hot encoded categories?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Feature selection</span></h1>
<p class="subtitle lead">A Practical Guide to Building Better Models with Python</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction-to-feature-selection" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="introduction-to-feature-selection"><span class="header-section-number">13.1</span> Introduction to feature selection</h2>
<p>Feature selection is the process of removing uninformative features from your model. These are features that are not helping your model to make better predictions. In other words, uninformative features are adding “noise” to your model, rather than “signal”.</p>
<p>There are a few reasons you might want to add feature selection to your workflow:</p>
<ul>
<li>Model accuracy can often be improved by removing uninformative features.</li>
<li>Models are generally easier to interpret when they include fewer features.</li>
<li>When you have fewer features, models will take less time to train and it may cost less to gather and store the data that is required to train them.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Potential benefits of feature selection:</strong></p>
<ul>
<li>Higher accuracy</li>
<li>Greater interpretability</li>
<li>Faster training</li>
<li>Lower costs</li>
</ul>
</div>
</div>
</div>
<p>As I mentioned at the start of the book, there are many valid methods for feature selection, including human intuition, domain knowledge, and data exploration. In this chapter, we’re going to do feature selection using automated methods that we can include in our <code>Pipeline</code>.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Feature selection methods:</strong></p>
<ul>
<li>Human intuition</li>
<li>Domain knowledge</li>
<li>Data exploration</li>
<li>Automated methods</li>
</ul>
</div>
</div>
</div>
<p>There are three types of automated methods that we’ll cover in this chapter: intrinsic methods, filter methods, and wrapper methods.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Methods for automated feature selection:</strong></p>
<ul>
<li>Intrinsic methods</li>
<li>Filter methods</li>
<li>Wrapper methods</li>
</ul>
</div>
</div>
</div>
<p>For the purposes of simplicity and training speed, we’ll use our logistic regression <code>Pipeline</code> as the starting point for the next few chapters. However, everything you’re learning could also be applied to the random forest <code>Pipeline</code> or the ensemble <code>Pipeline</code>.</p>
</section>
<section id="intrinsic-methods-l1-regularization" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="intrinsic-methods-l1-regularization"><span class="header-section-number">13.2</span> Intrinsic methods: L1 regularization</h2>
<p>An intrinsic feature selection method is one in which feature selection happens automatically as part of the model building process. These are also known as implicit methods or embedded methods.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>What are intrinsic methods?</strong></p>
<ul>
<li>Feature selection happens automatically during model building</li>
<li>Also called: implicit methods, embedded methods</li>
</ul>
</div>
</div>
</div>
<p>We’ve actually already used an intrinsic feature selection method in the book. Recall that in chapter 10, we tuned our logistic regression <code>Pipeline</code> using a grid search. Here were the best parameters.</p>
<div id="a1498461" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>grid.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>{'columntransformer__countvectorizer__ngram_range': (1, 2),
 'columntransformer__pipeline__onehotencoder__drop': None,
 'columntransformer__simpleimputer__add_indicator': True,
 'logisticregression__C': 10,
 'logisticregression__penalty': 'l1'}</code></pre>
</div>
</div>
<p>Notice the <code>C</code> and <code>penalty</code> parameters of logistic regression. The L1 penalty is the type of regularization that was used, and the <code>C</code> value indicates the amount of regularization.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>LogisticRegression tuning parameters:</strong></p>
<ul>
<li><strong><code>penalty</code>:</strong> Type of regularization</li>
<li><strong><code>C</code>:</strong> Amount of regularization</li>
</ul>
</div>
</div>
</div>
<p>In general, regularization shrinks model coefficients in order to minimize overfitting to the training data and improve the model’s ability to generalize to new data.</p>
<p>One notable aspect of L1 regularization in particular is that as the amount of regularization increases, some coefficients will be shrunk all the way to zero, which means they will be excluded from the model. In other words, L1 regularization automatically does feature selection.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>How does L1 regularization do feature selection?</strong></p>
<ul>
<li>Regularization shrinks model coefficients to help the model to generalize</li>
<li>L1 regularization shrinks some coefficients to zero, which removes those features</li>
</ul>
</div>
</div>
</div>
<p>To see an example of this, let’s take a look at the coefficients of the best model found by grid search, which is stored in the <code>best_estimator_</code> attribute. Notice that the second coefficient is zero, which means that the L1 regularization caused that feature to be removed from the model.</p>
<div id="eefaf72f" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_.named_steps[<span class="st">'logisticregression'</span>].coef_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>array([[ 0.56431161,  0.        , -0.08767203, ...,  0.01408723,
        -0.43713268, -0.46358519]])</code></pre>
</div>
</div>
<p>By checking the shape of the inner array, we can see that there are 3671 features.</p>
<div id="adcac0b3" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_.named_steps[<span class="st">'logisticregression'</span>].coef_[<span class="dv">0</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>(3671,)</code></pre>
</div>
</div>
<p>We can then check how many of the coefficients are zero. It turns out that 3103 coefficients were set to zero, which means that L1 regularization removed those features, leaving only 568 of the features.</p>
<p>Note that as the amount of regularization increases, more coefficients will be shrunk to zero and thus more features will be removed from the model. In the case of logistic regression, you increase the amount of regularization by decreasing the value of <code>C</code>.</p>
<div id="68429331" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(grid.best_estimator_.named_steps[<span class="st">'logisticregression'</span>].coef_[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>3103</code></pre>
</div>
</div>
<p>Let’s compare this to our logistic regression <code>Pipeline</code> that was not tuned by grid search. You can see that it uses L2 regularization.</p>
<div id="ddfda8b4" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pipe.named_steps[<span class="st">'logisticregression'</span>].get_params()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>{'C': 1.0,
 'class_weight': None,
 'dual': False,
 'fit_intercept': True,
 'intercept_scaling': 1,
 'l1_ratio': None,
 'max_iter': 100,
 'multi_class': 'auto',
 'n_jobs': None,
 'penalty': 'l2',
 'random_state': 1,
 'solver': 'liblinear',
 'tol': 0.0001,
 'verbose': 0,
 'warm_start': False}</code></pre>
</div>
</div>
<p>Although L2 regularization does shrink coefficients, we can confirm that it does not shrink them all the way to zero, and thus it does not perform feature selection.</p>
<p>Keep in mind that although L1 regularization produced a better performing model in this situation, that will not always be the case. It’s a good idea to always try both types of regularization and see which one works better.</p>
<div id="8d8e0db5" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(pipe.named_steps[<span class="st">'logisticregression'</span>].coef_[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>0</code></pre>
</div>
</div>
<p>To wrap up this section, let’s talk about some advantages and disadvantages of intrinsic feature selection methods:</p>
<ul>
<li>The main advantages are speed and simplicity: Since feature selection is implictly performed during model fitting, no additional feature selection process needs to be added to the workflow, which tends to save a lot of computational time.</li>
<li>The main disadvantage is that it’s model-dependent: The model that is best for your particular problem may not perform intrinsic feature selection.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Advantages and disadvantages of intrinsic methods:</strong></p>
<ul>
<li><strong>Advantages:</strong>
<ul>
<li>No added computation</li>
<li>No added steps</li>
</ul></li>
<li><strong>Disadvantages:</strong>
<ul>
<li>Model-dependent</li>
</ul></li>
</ul>
</div>
</div>
</div>
</section>
<section id="filter-methods-statistical-test-based-scoring" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="filter-methods-statistical-test-based-scoring"><span class="header-section-number">13.3</span> Filter methods: Statistical test-based scoring</h2>
<p>The next type of feature selection method we’ll cover is filter methods.</p>
<p>A filter method starts by scoring every single feature to quantify its potential relationship with the target column. Then, the features are ranked by their scores, and only the top scoring features are provided to the model. Thus, they’re called filter methods because they filter out what they believe to be the least informative features and then pass on the more informative features to the model.</p>
<p>As you’ll see in this section, filter methods vary in terms of the processes they use to score the features.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>How filter methods work:</strong></p>
<ol type="1">
<li>Each feature is scored by its relationship to the target</li>
<li>Top scoring features (most informative features) are provided to the model</li>
</ol>
</div>
</div>
</div>
<p>Our starting point for this section will be the logistic regression <code>Pipeline</code> that has not been tuned by grid search. The reason for this is because we want to tune all of the <code>Pipeline</code> steps simultaneously, rather than tuning the transformers and model first and then adding feature selection.</p>
<p>In other words, the presence of a feature selection process may alter the optimal parameters for the transformers and the model, and thus we need to tune all three steps at once. Right now it’s a two-step <code>Pipeline</code>, but there will be three steps once we add feature selection to the <code>Pipeline</code>.</p>
<div id="f9b19535" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c855b549-f2f5-4fc7-b574-1610b13e8342" type="checkbox"><label class="sk-toggleable__label" for="c855b549-f2f5-4fc7-b574-1610b13e8342">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('simpleimputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehotencoder',
                                                                   OneHotEncoder())]),
                                                  ['Embarked', 'Sex']),
                                                 ('countvectorizer',
                                                  CountVectorizer(), 'Name'),
                                                 ('simpleimputer',
                                                  SimpleImputer(),
                                                  ['Age', 'Fare']),
                                                 ('passthrough', 'passthrough',
                                                  ['Parch'])])),
                ('logisticregression',
                 LogisticRegression(random_state=1, solver='liblinear'))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="10da6d5c-8fc5-4426-9453-8933fa2077f6" type="checkbox"><label class="sk-toggleable__label" for="10da6d5c-8fc5-4426-9453-8933fa2077f6">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6c9e0298-b157-4ccf-8983-0e3b8664d67a" type="checkbox"><label class="sk-toggleable__label" for="6c9e0298-b157-4ccf-8983-0e3b8664d67a">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="913f7dd0-219a-4ab6-853b-c4b5c0ef1c7b" type="checkbox"><label class="sk-toggleable__label" for="913f7dd0-219a-4ab6-853b-c4b5c0ef1c7b">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b37e7531-830b-4bbf-a5f0-e55795f509cd" type="checkbox"><label class="sk-toggleable__label" for="b37e7531-830b-4bbf-a5f0-e55795f509cd">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="051f6163-43e2-45df-b24f-c121df65a0b7" type="checkbox"><label class="sk-toggleable__label" for="051f6163-43e2-45df-b24f-c121df65a0b7">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ff6f553e-15c4-4ba0-affd-c6c12879c0c8" type="checkbox"><label class="sk-toggleable__label" for="ff6f553e-15c4-4ba0-affd-c6c12879c0c8">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="49c93d89-13df-4607-a387-58fa5c4874de" type="checkbox"><label class="sk-toggleable__label" for="49c93d89-13df-4607-a387-58fa5c4874de">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cca3e642-681b-4cb5-b6b7-00d75d6acc02" type="checkbox"><label class="sk-toggleable__label" for="cca3e642-681b-4cb5-b6b7-00d75d6acc02">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="dacb0a51-28f6-46ea-9909-304c4cb30e9e" type="checkbox"><label class="sk-toggleable__label" for="dacb0a51-28f6-46ea-9909-304c4cb30e9e">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="709fde5c-405a-437f-bfd6-6c8bb0cc00d7" type="checkbox"><label class="sk-toggleable__label" for="709fde5c-405a-437f-bfd6-6c8bb0cc00d7">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="735ed96d-3bed-42ec-94dd-cb46f1b15052" type="checkbox"><label class="sk-toggleable__label" for="735ed96d-3bed-42ec-94dd-cb46f1b15052">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>Let’s cross-validate this <code>Pipeline</code> to generate a “baseline” accuracy that we want to improve upon, which is 0.811.</p>
<div id="bd151ea5" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>cross_val_score(pipe, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>0.8114619295712762</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (VC):</strong> 0.834</li>
<li><strong>Grid search (RF):</strong> 0.829</li>
<li><strong>Grid search (LR):</strong> 0.828</li>
<li><strong>Baseline (VC):</strong> 0.818</li>
<li><strong>Baseline (LR):</strong> <mark>0.811</mark></li>
<li><strong>Baseline (RF):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
<p>The first filter method we’ll use is <code>SelectPercentile</code>. <code>SelectPercentile</code> scores features using univariate statistical tests:</p>
<ul>
<li>You specify a statistical test, and it uses that test to score each feature independently.</li>
<li>Then, it passes on to the model a certain percentage (that you specify) of the best scoring features.</li>
</ul>
<p>Thus, the assumption behind <code>SelectPercentile</code> is that a statistical test can assess the strength of the relationship between a feature and the target, and that if a feature appears to be independent of the target, then it is uninformative for the purpose of classification.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>How SelectPercentile works:</strong></p>
<ol type="1">
<li>Scores each feature using the statistical test you specify</li>
<li>Passes to the model the percentage of features you specify</li>
</ol>
</div>
</div>
</div>
<p>Let’s see how <code>SelectPercentile</code> works. After importing <code>SelectPercentile</code> and <code>chi2</code> from the <code>feature_selection</code> module, we’ll create an instance of <code>SelectPercentile</code> called <code>selection</code>.</p>
<p>First, we pass it the statistical test. In this case we’re using chi-squared, but other tests are available in scikit-learn.</p>
<p>Then, we pass it the percentile. We’re arbitrarily using 50 to keep 50% of the features, but this is a parameter you should tune. And to be clear, lower values for this parameter keep fewer features, so for example a value of 10 would only keep 10% percent of the features.</p>
<div id="2a47b335" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> SelectPercentile, chi2</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>selection <span class="op">=</span> SelectPercentile(chi2, percentile<span class="op">=</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we create a <code>Pipeline</code> called <code>fs_pipe</code> in which feature selection is after the <code>ColumnTransformer</code> but before the model. Thus, it will perform feature selection on the transformed features, not the original features.</p>
<div id="166eba7f" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fs_pipe <span class="op">=</span> make_pipeline(ct, selection, logreg)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fs_pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d03c8c68-c98e-4d82-a211-9016074b49ac" type="checkbox"><label class="sk-toggleable__label" for="d03c8c68-c98e-4d82-a211-9016074b49ac">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('simpleimputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehotencoder',
                                                                   OneHotEncoder())]),
                                                  ['Embarked', 'Sex']),
                                                 ('countvectorizer',
                                                  CountVectorizer(), 'Name'),
                                                 ('simpleimputer',
                                                  SimpleImputer(),
                                                  ['Age', 'Fare']),
                                                 ('passthrough', 'passthrough',
                                                  ['Parch'])])),
                ('selectpercentile',
                 SelectPercentile(percentile=50,
                                  score_func=<function chi2="" at="" 0x11f6b7700="">)),
                ('logisticregression',
                 LogisticRegression(random_state=1, solver='liblinear'))])</function></pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cb225d29-2682-43aa-8456-2bedb42d50b1" type="checkbox"><label class="sk-toggleable__label" for="cb225d29-2682-43aa-8456-2bedb42d50b1">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8af0fff9-6085-4918-ba13-9c75cef7b21c" type="checkbox"><label class="sk-toggleable__label" for="8af0fff9-6085-4918-ba13-9c75cef7b21c">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c7a962dd-c67e-4a49-85c8-a41338b9c496" type="checkbox"><label class="sk-toggleable__label" for="c7a962dd-c67e-4a49-85c8-a41338b9c496">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d42020fa-c4d6-4513-854d-1786874ff9d0" type="checkbox"><label class="sk-toggleable__label" for="d42020fa-c4d6-4513-854d-1786874ff9d0">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6edb1e40-9ebb-496b-865d-064f74ab003a" type="checkbox"><label class="sk-toggleable__label" for="6edb1e40-9ebb-496b-865d-064f74ab003a">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c3bd70c0-11b4-4270-9abe-ceb6433dcfb7" type="checkbox"><label class="sk-toggleable__label" for="c3bd70c0-11b4-4270-9abe-ceb6433dcfb7">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4a0daf68-622b-4ec5-b952-d4a0bb0c1db2" type="checkbox"><label class="sk-toggleable__label" for="4a0daf68-622b-4ec5-b952-d4a0bb0c1db2">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cdbc1632-28d8-444a-8632-d764783bbff7" type="checkbox"><label class="sk-toggleable__label" for="cdbc1632-28d8-444a-8632-d764783bbff7">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="005580e0-ad03-4b57-978b-cfe7efd50158" type="checkbox"><label class="sk-toggleable__label" for="005580e0-ad03-4b57-978b-cfe7efd50158">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="084c7fa3-9c27-41db-8338-2ac017655c88" type="checkbox"><label class="sk-toggleable__label" for="084c7fa3-9c27-41db-8338-2ac017655c88">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f2d9423d-dde2-4aaa-8e01-06e7b94351bf" type="checkbox"><label class="sk-toggleable__label" for="f2d9423d-dde2-4aaa-8e01-06e7b94351bf">SelectPercentile</label><div class="sk-toggleable__content"><pre>SelectPercentile(percentile=50, score_func=<function chi2="" at="" 0x11f6b7700="">)</function></pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="657824ed-3a4d-482e-8d8b-66a43bcfb1f7" type="checkbox"><label class="sk-toggleable__label" for="657824ed-3a4d-482e-8d8b-66a43bcfb1f7">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>Because we’ve included feature selection within the <code>Pipeline</code>, we can continue to cross-validate the entire process to see the impact of feature selection on model accuracy. When we run cross-validation on the new <code>Pipeline</code>, the score has improved to 0.819.</p>
<div id="74e20ca1" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cross_val_score(fs_pipe, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>0.8193019898311469</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (VC):</strong> 0.834</li>
<li><strong>Grid search (RF):</strong> 0.829</li>
<li><strong>Grid search (LR):</strong> 0.828</li>
<li><strong>Baseline (LR with <code>SelectPercentile</code>):</strong> <mark>0.819</mark></li>
<li><strong>Baseline (VC):</strong> 0.818</li>
<li><strong>Baseline (LR):</strong> 0.811</li>
<li><strong>Baseline (RF):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
<p>It’s worth noting that there’s an alternative to <code>SelectPercentile</code> called <code>SelectKBest</code>. <code>SelectKBest</code> is nearly identical, except that you specify a number of features to keep rather than a percentage.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>SelectPercentile vs SelectKBest:</strong></p>
<ul>
<li><strong><code>SelectPercentile</code>:</strong> Specify percentage of features to keep</li>
<li><strong><code>SelectKBest</code>:</strong> Specify number of features to keep</li>
</ul>
</div>
</div>
</div>
</section>
<section id="filter-methods-model-based-scoring" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="filter-methods-model-based-scoring"><span class="header-section-number">13.4</span> Filter methods: Model-based scoring</h2>
<p>The other filter method we’ll use is called <code>SelectFromModel</code>. Whereas <code>SelectPercentile</code> scores features using a statistical test, <code>SelectFromModel</code> actually uses a model to score features:</p>
<ul>
<li>First, you specify a model to use only for feature selection. That model is fit on all of the features, and the <code>coef_</code> or <code>feature_importances_</code> attribute of the model is used as the scores.</li>
<li>Then, it passes on to your prediction model all of the features that score above a certain threshold (that you specify).</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>How SelectFromModel works:</strong></p>
<ol type="1">
<li>Scores each feature using the model you specify
<ul>
<li>Model is fit on all features</li>
<li>Coefficients or feature importances are used as scores</li>
</ul></li>
<li>Passes to the prediction model features that score above a threshold you specify</li>
</ol>
</div>
</div>
</div>
<p>Thus for a model to be used by <code>SelectFromModel</code>, it has to calculate either coefficients or feature importances. Models that can be used by <code>SelectFromModel</code> include logistic regression, linear SVC, and tree-based models.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Models that can be used by SelectFromModel:</strong></p>
<ul>
<li>Logistic regression</li>
<li>Linear SVC</li>
<li>Tree-based models</li>
<li>Any other model with coefficients or feature importances</li>
</ul>
</div>
</div>
</div>
<p>To be clear, <code>SelectFromModel</code> is a filter method (not an intrinsic method) because it’s filtering which features are passed to your separate prediction model.</p>
<p>Let’s see how all of this fits together. We’re going to start by using logistic regression for feature selection. We’ll create a new instance of logistic regression called <code>logreg_selection</code> that’s only going to be used for feature selection. It’s completely separate from the logistic regression model we’re using to make predictions.</p>
<div id="f660c530" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>logreg_selection <span class="op">=</span> LogisticRegression(solver<span class="op">=</span><span class="st">'liblinear'</span>, penalty<span class="op">=</span><span class="st">'l1'</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                                      random_state<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we’ll import <code>SelectFromModel</code> from the <code>feature_selection</code> module and create an instance called <code>selection</code>.</p>
<p>First, we pass it the model we’re using for selection. Second, we pass it a threshold. This can be the mean or median of the scores, though you can optionally include a scaling factor (such as 1.5 times mean). All features above this threshold will be passed to the prediction model, thus setting a higher threshold means fewer features will be kept.</p>
<div id="b4d77b5c" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> SelectFromModel</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>selection <span class="op">=</span> SelectFromModel(logreg_selection, threshold<span class="op">=</span><span class="st">'mean'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we’ll update <code>fs_pipe</code> to use the new feature selection object. Notice that logistic regression appears twice: one instance is being used only for feature selection, and the other instance is being used only for prediction.</p>
<div id="7ea09ebb" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fs_pipe <span class="op">=</span> make_pipeline(ct, selection, logreg)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>fs_pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="aec5398b-845d-4637-a17d-aa41944b184f" type="checkbox"><label class="sk-toggleable__label" for="aec5398b-845d-4637-a17d-aa41944b184f">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('simpleimputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehotencoder',
                                                                   OneHotEncoder())]),
                                                  ['Embarked', 'Sex']),
                                                 ('countvectorizer',
                                                  CountVectorizer(), 'Name'),
                                                 ('simpleimputer',
                                                  SimpleImputer(),
                                                  ['Age', 'Fare']),
                                                 ('passthrough', 'passthrough',
                                                  ['Parch'])])),
                ('selectfrommodel',
                 SelectFromModel(estimator=LogisticRegression(penalty='l1',
                                                              random_state=1,
                                                              solver='liblinear'),
                                 threshold='mean')),
                ('logisticregression',
                 LogisticRegression(random_state=1, solver='liblinear'))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="56490270-0247-4899-86bc-90f0f8deec43" type="checkbox"><label class="sk-toggleable__label" for="56490270-0247-4899-86bc-90f0f8deec43">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e1fac315-2b6e-4ccc-a65d-2f9496fd71fc" type="checkbox"><label class="sk-toggleable__label" for="e1fac315-2b6e-4ccc-a65d-2f9496fd71fc">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4beaa173-519d-4cc6-9d82-0d1aec87a284" type="checkbox"><label class="sk-toggleable__label" for="4beaa173-519d-4cc6-9d82-0d1aec87a284">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="130bc180-e032-4740-8f6e-2855426d75da" type="checkbox"><label class="sk-toggleable__label" for="130bc180-e032-4740-8f6e-2855426d75da">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="267e470e-ce88-492c-bed4-6cbf0dea9822" type="checkbox"><label class="sk-toggleable__label" for="267e470e-ce88-492c-bed4-6cbf0dea9822">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="58b13bec-eba5-4edc-b521-6299a5d516bf" type="checkbox"><label class="sk-toggleable__label" for="58b13bec-eba5-4edc-b521-6299a5d516bf">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="99983c14-931d-4400-8410-b30cc54d6f06" type="checkbox"><label class="sk-toggleable__label" for="99983c14-931d-4400-8410-b30cc54d6f06">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1046daf2-a084-4ab7-9c1e-a796d6978123" type="checkbox"><label class="sk-toggleable__label" for="1046daf2-a084-4ab7-9c1e-a796d6978123">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c3ddd54d-9bc9-4a8b-83d1-8f3969b93b08" type="checkbox"><label class="sk-toggleable__label" for="c3ddd54d-9bc9-4a8b-83d1-8f3969b93b08">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="75c2fada-c199-456d-a3fd-c3285d1fe2b1" type="checkbox"><label class="sk-toggleable__label" for="75c2fada-c199-456d-a3fd-c3285d1fe2b1">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6de19b30-8860-41c5-9ea6-eb68647d2142" type="checkbox"><label class="sk-toggleable__label" for="6de19b30-8860-41c5-9ea6-eb68647d2142">selectfrommodel: SelectFromModel</label><div class="sk-toggleable__content"><pre>SelectFromModel(estimator=LogisticRegression(penalty='l1', random_state=1,
                                             solver='liblinear'),
                threshold='mean')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="95e39d73-1281-4ccb-8661-9752353d6c7a" type="checkbox"><label class="sk-toggleable__label" for="95e39d73-1281-4ccb-8661-9752353d6c7a">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(penalty='l1', random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ec8aeab0-6b31-4872-ae64-0b7831522101" type="checkbox"><label class="sk-toggleable__label" for="ec8aeab0-6b31-4872-ae64-0b7831522101">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>When we cross-validate the updated <code>Pipeline</code>, the score has improved again, to 0.826.</p>
<div id="6aee5b80" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>cross_val_score(fs_pipe, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>0.8260121775155358</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (VC):</strong> 0.834</li>
<li><strong>Grid search (RF):</strong> 0.829</li>
<li><strong>Grid search (LR):</strong> 0.828</li>
<li><strong>Baseline (LR with <code>SelectFromModel</code> LR):</strong> <mark>0.826</mark></li>
<li><strong>Baseline (LR with <code>SelectPercentile</code>):</strong> 0.819</li>
<li><strong>Baseline (VC):</strong> 0.818</li>
<li><strong>Baseline (LR):</strong> 0.811</li>
<li><strong>Baseline (RF):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
<p>Now let’s try using a tree-based model with <code>SelectFromModel</code>. We’ll use <code>ExtraTreesClassifier</code>, which is an ensemble of decision trees similar to random forests. After importing it from the <code>ensemble</code> module, we’ll create an instance to use for feature selection called <code>et_selection</code>.</p>
<div id="4f4ce923" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> ExtraTreesClassifier</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>et_selection <span class="op">=</span> ExtraTreesClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we’ll update both the feature selection object and the <code>Pipeline</code>. Notice that <code>ExtraTreesClassifier</code> has replaced logistic regression as the second step in the <code>Pipeline</code>.</p>
<div id="a2837e7a" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>selection <span class="op">=</span> SelectFromModel(et_selection, threshold<span class="op">=</span><span class="st">'mean'</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>fs_pipe <span class="op">=</span> make_pipeline(ct, selection, logreg)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>fs_pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="48910e6f-ea1d-4159-8420-25d80e9e0a31" type="checkbox"><label class="sk-toggleable__label" for="48910e6f-ea1d-4159-8420-25d80e9e0a31">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('simpleimputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehotencoder',
                                                                   OneHotEncoder())]),
                                                  ['Embarked', 'Sex']),
                                                 ('countvectorizer',
                                                  CountVectorizer(), 'Name'),
                                                 ('simpleimputer',
                                                  SimpleImputer(),
                                                  ['Age', 'Fare']),
                                                 ('passthrough', 'passthrough',
                                                  ['Parch'])])),
                ('selectfrommodel',
                 SelectFromModel(estimator=ExtraTreesClassifier(random_state=1),
                                 threshold='mean')),
                ('logisticregression',
                 LogisticRegression(random_state=1, solver='liblinear'))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="097832b9-0d88-493d-9176-c3b1cb01f550" type="checkbox"><label class="sk-toggleable__label" for="097832b9-0d88-493d-9176-c3b1cb01f550">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8932996e-1822-4a12-b4b9-f329f4762937" type="checkbox"><label class="sk-toggleable__label" for="8932996e-1822-4a12-b4b9-f329f4762937">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d7fce88b-ee33-40ba-80a2-4acf198105a8" type="checkbox"><label class="sk-toggleable__label" for="d7fce88b-ee33-40ba-80a2-4acf198105a8">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="33286b42-659d-4a9b-bc67-60765ef25c8a" type="checkbox"><label class="sk-toggleable__label" for="33286b42-659d-4a9b-bc67-60765ef25c8a">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f2ce5df8-05bc-4cc2-aa62-13c3b4e3150d" type="checkbox"><label class="sk-toggleable__label" for="f2ce5df8-05bc-4cc2-aa62-13c3b4e3150d">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="324ff84f-1ea2-4b1d-9907-c98572acdbd0" type="checkbox"><label class="sk-toggleable__label" for="324ff84f-1ea2-4b1d-9907-c98572acdbd0">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="634ea5db-0262-4368-9494-7f156161115f" type="checkbox"><label class="sk-toggleable__label" for="634ea5db-0262-4368-9494-7f156161115f">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b0bd2fc8-c50d-4753-9a2e-7e6f4866984f" type="checkbox"><label class="sk-toggleable__label" for="b0bd2fc8-c50d-4753-9a2e-7e6f4866984f">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6139ee2c-fd90-48f6-8f2d-ef0fbe9e8b39" type="checkbox"><label class="sk-toggleable__label" for="6139ee2c-fd90-48f6-8f2d-ef0fbe9e8b39">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bddab8d3-e0b4-4f59-b6bf-b75ce89fa9c7" type="checkbox"><label class="sk-toggleable__label" for="bddab8d3-e0b4-4f59-b6bf-b75ce89fa9c7">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a0be7020-7483-4aca-b99c-072e48dc104b" type="checkbox"><label class="sk-toggleable__label" for="a0be7020-7483-4aca-b99c-072e48dc104b">selectfrommodel: SelectFromModel</label><div class="sk-toggleable__content"><pre>SelectFromModel(estimator=ExtraTreesClassifier(random_state=1),
                threshold='mean')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0fd62afd-a289-4fe3-8aa4-3b5d139dde2d" type="checkbox"><label class="sk-toggleable__label" for="0fd62afd-a289-4fe3-8aa4-3b5d139dde2d">ExtraTreesClassifier</label><div class="sk-toggleable__content"><pre>ExtraTreesClassifier(random_state=1)</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d6a7c7f6-cc17-4c1d-a8f8-db74417679b1" type="checkbox"><label class="sk-toggleable__label" for="d6a7c7f6-cc17-4c1d-a8f8-db74417679b1">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>When we cross-validate the updated <code>Pipeline</code>, the resulting score is 0.815, which is not quite as good.</p>
<div id="84d26f39" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>cross_val_score(fs_pipe, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>0.8148013307388112</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (VC):</strong> 0.834</li>
<li><strong>Grid search (RF):</strong> 0.829</li>
<li><strong>Grid search (LR):</strong> 0.828</li>
<li><strong>Baseline (LR with <code>SelectFromModel</code> LR):</strong> 0.826</li>
<li><strong>Baseline (LR with <code>SelectPercentile</code>):</strong> 0.819</li>
<li><strong>Baseline (VC):</strong> 0.818</li>
<li><strong>Baseline (LR with <code>SelectFromModel</code> ET):</strong> <mark>0.815</mark></li>
<li><strong>Baseline (LR):</strong> 0.811</li>
<li><strong>Baseline (RF):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
<p>As I mentioned earlier in this chapter, it’s important to tune the feature selection parameters, the transformer parameters, and the model parameters all at the same time. We’ll do this using a grid search.</p>
<p>To start, we’ll make a copy of our <code>params</code> dictionary called <code>fs_params</code>. We want to add a new entry in order to tune the threshold parameter of <code>SelectFromModel</code>. For the dictionary key, we specify the step name, which is <code>selectfrommodel</code> (all lowercase), followed by two underscores, followed by the parameter name. For the values, we’ll pass a list of mean, 1.5 times the mean, and negative infinity, which means don’t remove any features.</p>
<div id="4a903ada" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fs_params <span class="op">=</span> params.copy()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>fs_params[<span class="st">'selectfrommodel__threshold'</span>] <span class="op">=</span> [<span class="st">'mean'</span>, <span class="st">'1.5*mean'</span>, <span class="op">-</span>np.inf]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s review the <code>fs_params</code> dictionary to see everything we’re tuning.</p>
<div id="fef52e80" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fs_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>{'logisticregression__penalty': ['l1', 'l2'],
 'logisticregression__C': [0.1, 1, 10],
 'columntransformer__pipeline__onehotencoder__drop': [None, 'first'],
 'columntransformer__countvectorizer__ngram_range': [(1, 1), (1, 2)],
 'columntransformer__simpleimputer__add_indicator': [False, True],
 'selectfrommodel__threshold': ['mean', '1.5*mean', -inf]}</code></pre>
</div>
</div>
<p>We’ll create a new instance of <code>GridSearchCV</code> called <code>fs_grid</code>, and make sure to pass it the <code>fs_pipe</code> and <code>fs_params</code> objects. Then we’ll run the grid search.</p>
<div id="8c04da99" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fs_grid <span class="op">=</span> GridSearchCV(fs_pipe, fs_params, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                       n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>fs_grid.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e2c68386-6165-4292-92f2-fb6b962aac87" type="checkbox"><label class="sk-toggleable__label" for="e2c68386-6165-4292-92f2-fb6b962aac87">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[('columntransformer',
                                        ColumnTransformer(transformers=[('pipeline',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(fill_value='missing',
                                                                                                        strategy='constant')),
                                                                                         ('onehotencoder',
                                                                                          OneHotEncoder())]),
                                                                         ['Embarked',
                                                                          'Sex']),
                                                                        ('countvectorizer',
                                                                         CountVectorizer(),
                                                                         'Name'),
                                                                        ('simpleimputer',
                                                                         SimpleImputer(),
                                                                         ['Age',
                                                                          'Fare']),
                                                                        (...
             param_grid={'columntransformer__countvectorizer__ngram_range': [(1,
                                                                              1),
                                                                             (1,
                                                                              2)],
                         'columntransformer__pipeline__onehotencoder__drop': [None,
                                                                              'first'],
                         'columntransformer__simpleimputer__add_indicator': [False,
                                                                             True],
                         'logisticregression__C': [0.1, 1, 10],
                         'logisticregression__penalty': ['l1', 'l2'],
                         'selectfrommodel__threshold': ['mean', '1.5*mean',
                                                        -inf]},
             scoring='accuracy')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="54993157-eef9-4864-82b5-900c127be404" type="checkbox"><label class="sk-toggleable__label" for="54993157-eef9-4864-82b5-900c127be404">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="acf2d090-f004-4b3c-be5e-5674f451f8ed" type="checkbox"><label class="sk-toggleable__label" for="acf2d090-f004-4b3c-be5e-5674f451f8ed">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="85c5a626-5745-464b-8ae9-1cd51f9c9085" type="checkbox"><label class="sk-toggleable__label" for="85c5a626-5745-464b-8ae9-1cd51f9c9085">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cc993413-6a38-4f2b-8b47-132fc48bf4a0" type="checkbox"><label class="sk-toggleable__label" for="cc993413-6a38-4f2b-8b47-132fc48bf4a0">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c50447a2-94ab-4dfc-8e06-6d1c7210a4a8" type="checkbox"><label class="sk-toggleable__label" for="c50447a2-94ab-4dfc-8e06-6d1c7210a4a8">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4af496b4-9689-487f-851d-8e46659668aa" type="checkbox"><label class="sk-toggleable__label" for="4af496b4-9689-487f-851d-8e46659668aa">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="591c1e89-e880-4bf8-848a-567e4a1cf4dd" type="checkbox"><label class="sk-toggleable__label" for="591c1e89-e880-4bf8-848a-567e4a1cf4dd">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b8c6e6d9-1f2d-403f-b123-ceda5658986f" type="checkbox"><label class="sk-toggleable__label" for="b8c6e6d9-1f2d-403f-b123-ceda5658986f">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d10c61fe-4a9c-47c6-a7c2-d570efe70bb4" type="checkbox"><label class="sk-toggleable__label" for="d10c61fe-4a9c-47c6-a7c2-d570efe70bb4">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fe3f95fd-d4b6-402a-b5f2-f9ee90d09de5" type="checkbox"><label class="sk-toggleable__label" for="fe3f95fd-d4b6-402a-b5f2-f9ee90d09de5">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="00a1c829-c291-4d64-b420-76e05bf63edd" type="checkbox"><label class="sk-toggleable__label" for="00a1c829-c291-4d64-b420-76e05bf63edd">selectfrommodel: SelectFromModel</label><div class="sk-toggleable__content"><pre>SelectFromModel(estimator=ExtraTreesClassifier(random_state=1),
                threshold='mean')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b8eeaccd-343b-4f4d-8011-ac1b357bf4f1" type="checkbox"><label class="sk-toggleable__label" for="b8eeaccd-343b-4f4d-8011-ac1b357bf4f1">ExtraTreesClassifier</label><div class="sk-toggleable__content"><pre>ExtraTreesClassifier(random_state=1)</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d207a989-e932-4366-9aef-0a4b20b98d6b" type="checkbox"><label class="sk-toggleable__label" for="d207a989-e932-4366-9aef-0a4b20b98d6b">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>This search results in a score of 0.832, which is one of our best scores so far.</p>
<div id="fb26e92c" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fs_grid.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>0.8316301550436258</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (VC):</strong> 0.834</li>
<li><strong>Grid search (LR with <code>SelectFromModel</code> ET):</strong> <mark>0.832</mark></li>
<li><strong>Grid search (RF):</strong> 0.829</li>
<li><strong>Grid search (LR):</strong> 0.828</li>
<li><strong>Baseline (LR with <code>SelectFromModel</code> LR):</strong> 0.826</li>
<li><strong>Baseline (LR with <code>SelectPercentile</code>):</strong> 0.819</li>
<li><strong>Baseline (VC):</strong> 0.818</li>
<li><strong>Baseline (LR with <code>SelectFromModel</code> ET):</strong> 0.815</li>
<li><strong>Baseline (LR):</strong> 0.811</li>
<li><strong>Baseline (RF):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
<p>By examining the parameters, we can see that increasing the <code>SelectFromModel</code> threshold and thus keeping fewer features helped the model to perform better.</p>
<div id="807956a9" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fs_grid.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>{'columntransformer__countvectorizer__ngram_range': (1, 2),
 'columntransformer__pipeline__onehotencoder__drop': None,
 'columntransformer__simpleimputer__add_indicator': False,
 'logisticregression__C': 10,
 'logisticregression__penalty': 'l1',
 'selectfrommodel__threshold': '1.5*mean'}</code></pre>
</div>
</div>
</section>
<section id="filter-methods-summary" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="filter-methods-summary"><span class="header-section-number">13.5</span> Filter methods: Summary</h2>
<p>To wrap up this section, let’s talk about some advantages and disadvantages of filter methods.</p>
<p>The main advantage is that filter methods tend to run very quickly, though it’s worth noting that some statistical tests used with <code>SelectPercentile</code> and ensemble methods used with <code>SelectFromModel</code> can run quite slowly.</p>
<p>The main disadvantage is that there’s a disconnect between how features are being scored and their predictive value. In other words, the chi-squared scores or coefficient values or feature importance scores are not a perfect measure of whether a particular feature will help a model make more accurate predictions. Thus, it’s entirely possible for informative features to receive low scores and be removed from a model, and for uninformative features to receive high scores and be kept in a model. One particular case of note is that the feature importance scores generated by tree-based models will be artificially low for any features which are highly correlated, which may result in important features being removed.</p>
<p>The other disadvantage of filter methods is that scores are calculated only once. This ignores the fact that as you remove certain features, the importance of other features may change. This drawback will be addressed by wrapper methods, which we’ll discuss in the next lesson.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Advantages and disadvantages of filter methods:</strong></p>
<ul>
<li><strong>Advantages:</strong>
<ul>
<li>Runs quickly (usually)</li>
</ul></li>
<li><strong>Disadvantages:</strong>
<ul>
<li>Scores are not always correlated with predictive value</li>
<li>Scores are calculated only once</li>
</ul></li>
</ul>
</div>
</div>
</div>
</section>
<section id="wrapper-methods-recursive-feature-elimination" class="level2" data-number="13.6">
<h2 data-number="13.6" class="anchored" data-anchor-id="wrapper-methods-recursive-feature-elimination"><span class="header-section-number">13.6</span> Wrapper methods: Recursive feature elimination</h2>
<p>The final type of feature selection we’ll cover is wrapper methods.</p>
<p>In contrast to the filter methods we’ve seen, in which features are scored only once, wrapper methods perform an iterative search in which features are scored multiple times. More specifically, a wrapper method evaluates a subset of features and then uses the results of that evaluation to help it decide which subset to evaluate next, repeating this process until some stopping criteria is met.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Filter methods vs wrapper methods:</strong></p>
<ul>
<li><strong>Filter methods:</strong> Features are scored once</li>
<li><strong>Wrapper methods:</strong> Features are scored multiple times</li>
</ul>
</div>
</div>
</div>
<p>The wrapper method we’ll use in this section is Recursive Feature Elimination, which is available in scikit-learn as the <code>RFE</code> class. The way <code>RFE</code> starts is the same as <code>SelectFromModel</code>:</p>
<ul>
<li>You specify a model to use only for feature selection.</li>
<li>That model is fit on all of the features.</li>
<li>The coefficients or feature importances of the model are used as scores.</li>
</ul>
<p>However, this is the point at which <code>SelectFromModel</code> and <code>RFE</code> diverge:</p>
<ul>
<li><code>SelectFromModel</code> would now pass to your prediction model all of the features that score above a certain threshold.</li>
<li><code>RFE</code>, on the other hand, removes the single worst scoring feature, refits the feature selection model, and recalculates the feature scores. It repeats this process, recursively eliminating one feature at a time, until it reaches the number of features that you specify. Those remaining features are the ones that will be passed to the prediction model.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>How RFE works:</strong></p>
<ol type="1">
<li>Scores each feature using the model you specify
<ul>
<li>Model is fit on all features</li>
<li>Coefficients or feature importances are used as scores</li>
</ul></li>
<li>Removes the single worst scoring feature</li>
<li>Repeats steps 1 and 2 until it reaches the number of features you specify</li>
<li>Passes the remaining features to the prediction model</li>
</ol>
</div>
</div>
</div>
<p>In other words, <code>SelectFromModel</code> will always just score your features a single time, whereas <code>RFE</code> will score your features potentially hundreds or thousands of times, depending on how many features you want to eliminate. That is obviously more computationally expensive, though it may better capture the relationships between features.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>SelectFromModel vs RFE:</strong></p>
<ul>
<li><strong><code>SelectFromModel</code>:</strong> Scores your features a single time</li>
<li><strong><code>RFE</code>:</strong> Scores your features many times
<ul>
<li>More computationally expensive</li>
<li>May better capture the relationships between features</li>
</ul></li>
</ul>
</div>
</div>
</div>
<p>Let’s try using <code>RFE</code>. We start by importing it from the <code>feature_selection</code> module, and then create an instance called <code>selection</code>. We’re actually going to reuse <code>logreg_selection</code> as our feature selection model.</p>
<p>We’re also going to specify a step size of 10. By default, <code>RFE</code> will remove 1 feature at a time, and will stop once it has eliminated half of the features. Since there are about 1500 features, the default settings would require about 750 model fits. By setting a step size of 10, <code>RFE</code> will remove 10 features at a time, which reduces the amount of computation by a factor of 10.</p>
<div id="1a4f580f" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> RFE</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>selection <span class="op">=</span> RFE(logreg_selection, step<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll update the <code>fs_pipe</code> object to use the new feature selection object.</p>
<div id="7088977c" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fs_pipe <span class="op">=</span> make_pipeline(ct, selection, logreg)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>fs_pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cb1c9761-7146-46a4-ae12-745c844c3d7f" type="checkbox"><label class="sk-toggleable__label" for="cb1c9761-7146-46a4-ae12-745c844c3d7f">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('simpleimputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehotencoder',
                                                                   OneHotEncoder())]),
                                                  ['Embarked', 'Sex']),
                                                 ('countvectorizer',
                                                  CountVectorizer(), 'Name'),
                                                 ('simpleimputer',
                                                  SimpleImputer(),
                                                  ['Age', 'Fare']),
                                                 ('passthrough', 'passthrough',
                                                  ['Parch'])])),
                ('rfe',
                 RFE(estimator=LogisticRegression(penalty='l1', random_state=1,
                                                  solver='liblinear'),
                     step=10)),
                ('logisticregression',
                 LogisticRegression(random_state=1, solver='liblinear'))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fef60553-7c78-420d-b24d-1ca26a76e682" type="checkbox"><label class="sk-toggleable__label" for="fef60553-7c78-420d-b24d-1ca26a76e682">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['Embarked', 'Sex']),
                                ('countvectorizer', CountVectorizer(), 'Name'),
                                ('simpleimputer', SimpleImputer(),
                                 ['Age', 'Fare']),
                                ('passthrough', 'passthrough', ['Parch'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f5ea16ff-2c99-4759-bf72-cd1118e57049" type="checkbox"><label class="sk-toggleable__label" for="f5ea16ff-2c99-4759-bf72-cd1118e57049">pipeline</label><div class="sk-toggleable__content"><pre>['Embarked', 'Sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="553743cb-55c5-417e-beb1-977c86123240" type="checkbox"><label class="sk-toggleable__label" for="553743cb-55c5-417e-beb1-977c86123240">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4ec590c2-df6b-470c-bc22-a7b8f6546ff3" type="checkbox"><label class="sk-toggleable__label" for="4ec590c2-df6b-470c-bc22-a7b8f6546ff3">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8729e19b-664e-4cee-bd2a-f7c6c4af197a" type="checkbox"><label class="sk-toggleable__label" for="8729e19b-664e-4cee-bd2a-f7c6c4af197a">countvectorizer</label><div class="sk-toggleable__content"><pre>Name</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="879e046a-85f2-4569-a563-85255be317c9" type="checkbox"><label class="sk-toggleable__label" for="879e046a-85f2-4569-a563-85255be317c9">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="77cc2922-7bd5-40d4-8208-120432c6f0be" type="checkbox"><label class="sk-toggleable__label" for="77cc2922-7bd5-40d4-8208-120432c6f0be">simpleimputer</label><div class="sk-toggleable__content"><pre>['Age', 'Fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="15aa6eb5-51a1-4f66-98e6-c14d03ccb56c" type="checkbox"><label class="sk-toggleable__label" for="15aa6eb5-51a1-4f66-98e6-c14d03ccb56c">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9a36db9f-218d-40a3-888d-76e9937f6cab" type="checkbox"><label class="sk-toggleable__label" for="9a36db9f-218d-40a3-888d-76e9937f6cab">passthrough</label><div class="sk-toggleable__content"><pre>['Parch']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7a257952-df06-44c9-a576-05cf6f64449a" type="checkbox"><label class="sk-toggleable__label" for="7a257952-df06-44c9-a576-05cf6f64449a">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b1da673e-bc15-4d91-a249-0baf620e2b5d" type="checkbox"><label class="sk-toggleable__label" for="b1da673e-bc15-4d91-a249-0baf620e2b5d">rfe: RFE</label><div class="sk-toggleable__content"><pre>RFE(estimator=LogisticRegression(penalty='l1', random_state=1,
                                 solver='liblinear'),
    step=10)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f6ca36ef-45dc-48cf-81b7-13ab7463cf59" type="checkbox"><label class="sk-toggleable__label" for="f6ca36ef-45dc-48cf-81b7-13ab7463cf59">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(penalty='l1', random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f9bfa93f-d547-4647-8628-fd2e361d9b16" type="checkbox"><label class="sk-toggleable__label" for="f9bfa93f-d547-4647-8628-fd2e361d9b16">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=1, solver='liblinear')</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>When we cross-validate it, we see that its score is 0.814, which is barely better than our baseline of 0.811.</p>
<div id="155f93f5" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>cross_val_score(fs_pipe, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>0.8136965664427847</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Pipeline accuracy scores:</strong></p>
<ul>
<li><strong>Grid search (VC):</strong> 0.834</li>
<li><strong>Grid search (LR with <code>SelectFromModel</code> ET):</strong> 0.832</li>
<li><strong>Grid search (RF):</strong> 0.829</li>
<li><strong>Grid search (LR):</strong> 0.828</li>
<li><strong>Baseline (LR with <code>SelectFromModel</code> LR):</strong> 0.826</li>
<li><strong>Baseline (LR with <code>SelectPercentile</code>):</strong> 0.819</li>
<li><strong>Baseline (VC):</strong> 0.818</li>
<li><strong>Baseline (LR with <code>SelectFromModel</code> ET):</strong> 0.815</li>
<li><strong>Baseline (LR with <code>RFE</code> LR):</strong> <mark>0.814</mark></li>
<li><strong>Baseline (LR):</strong> 0.811</li>
<li><strong>Baseline (RF):</strong> 0.811</li>
</ul>
</div>
</div>
</div>
<p>Of course, it’s possible that the accuracy would improve if we tuned the number of features kept by <code>RFE</code>, or if we tried different models with <code>RFE</code>.</p>
<p>It’s hard to talk about the advantages and disadvantages of wrapper methods in general because of the diversity of wrapper methods. Instead, let’s wrap up this section by talking about the advantages and disadvantages of <code>RFE</code> specifically:</p>
<ul>
<li>The main advantage of <code>RFE</code> is that it recalculates feature scores as features are removed. This is beneficial because as features are removed, the importance of other features may change, which <code>RFE</code> takes into account (whereas filter methods do not).</li>
<li>However, <code>RFE</code> has the same disadvantage as filter methods, in that there’s a disconnect between how features are being scored and their predictive value. In other words, informative features might be removed and uninformative features might be kept by <code>RFE</code>.</li>
<li>Another disadvantage of <code>RFE</code> is that it’s computationally expensive, especially if you’re removing a lot of features.</li>
<li>A final disadvantage of <code>RFE</code> is that it uses a “greedy” approach to feature selection, which means that it takes whatever action seems best at the time, even if a different action might ultimately lead to better results at the end of the process. There are non-greedy approaches to feature selection, though none of them are currently available in scikit-learn.</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Advantages and disadvantages of RFE:</strong></p>
<ul>
<li><strong>Advantages:</strong>
<ul>
<li>Captures the relationships between features</li>
</ul></li>
<li><strong>Disadvantages:</strong>
<ul>
<li>Scores are not always correlated with predictive value</li>
<li>Computationally expensive</li>
<li>Does not look ahead when removing features (“greedy” approach)</li>
</ul></li>
</ul>
</div>
</div>
</div>
</section>
<section id="qa-how-do-i-see-which-features-were-selected" class="level2" data-number="13.7">
<h2 data-number="13.7" class="anchored" data-anchor-id="qa-how-do-i-see-which-features-were-selected"><span class="header-section-number">13.7</span> Q&amp;A: How do I see which features were selected?</h2>
<p>Recall that the <code>fs_pipe</code> object has three steps: a <code>ColumnTransformer</code>, a feature selector, and a logistic regression model.</p>
<div id="87ea0914" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>fs_pipe.named_steps.keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>dict_keys(['columntransformer', 'rfe', 'logisticregression'])</code></pre>
</div>
</div>
<p>We can use slicing to select the <code>ColumnTransformer</code> step, and then we can run <code>fit_transform</code> to see that it outputs 1518 feature columns.</p>
<div id="a0b777ca" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>fs_pipe[<span class="dv">0</span>].fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>&lt;891x1518 sparse matrix of type '&lt;class 'numpy.float64'&gt;'
    with 7328 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
<p>If we select the first two steps and then run <code>fit_transform</code>, we can see that the feature selection step reduced the number of feature columns from 1518 to 759. Note that we have to pass both <code>X</code> and <code>y</code> to <code>fit_transform</code> since the feature selection process requires knowledge of the target values.</p>
<div id="5ba985be" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fs_pipe[<span class="dv">0</span>:<span class="dv">2</span>].fit_transform(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>&lt;891x759 sparse matrix of type '&lt;class 'numpy.float64'&gt;'
    with 6008 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
<p>If we then select the feature selection step and run the <code>get_support</code> method, it returns a boolean array which includes a <code>True</code> for every feature which was kept and a <code>False</code> for every feature which was removed.</p>
<div id="53093bb6" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fs_pipe[<span class="dv">1</span>].get_support()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>array([ True,  True,  True, ...,  True,  True,  True])</code></pre>
</div>
</div>
<p>As you can see, that array has 1518 elements, and 759 of those elements are <code>True</code>.</p>
<div id="ac08b41b" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(fs_pipe[<span class="dv">1</span>].get_support())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>1518</code></pre>
</div>
</div>
<div id="22b3aa62" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fs_pipe[<span class="dv">1</span>].get_support().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>759</code></pre>
</div>
</div>
<p>Ideally, you would be able to use this array to filter the list of all features down to a list of the selected features. However, this is not a straightforward process because the <code>get_feature_names</code> method of <code>ColumnTransformer</code> only works if all of the underlying transformers have a <code>get_feature_names</code> method, and that is not the case here.</p>
<div id="dec0d5a3" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>fs_pipe[<span class="dv">0</span>].get_feature_names()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fa613e83" class="cell" data-execution_count="41">
<div class="cell-output cell-output-stdout">
<pre><code>AttributeError: Transformer pipeline does not provide get_feature_names</code></pre>
</div>
</div>
<p>As such, you would have to inspect the transformers one-by-one to figure out the 1518 column names, as shown previously in <a href="ch08.html#sec-8-4" class="quarto-xref">lesson&nbsp;<span>8.4</span></a>, and then you could filter that list down to the 759 selected features using the boolean array.</p>
<p>Note that starting in scikit-learn version 1.1, the <code>get_feature_names_out</code> method should work on this <code>ColumnTransformer</code>, since the <code>get_feature_names_out</code> method will be available for all transformers.</p>
</section>
<section id="qa-are-the-selected-features-the-most-important-features" class="level2" data-number="13.8">
<h2 data-number="13.8" class="anchored" data-anchor-id="qa-are-the-selected-features-the-most-important-features"><span class="header-section-number">13.8</span> Q&amp;A: Are the selected features the “most important” features?</h2>
<p>After using any feature selection procedure, it’s hard to say whether the selected feature set is truly the best set of features, or whether there might be another feature set that performs just as well.</p>
<p>For example, one high-performing feature set might include feature A, while another high-performing feature set might exclude feature A but include features B and C which are highly correlated with A. This is especially likely any time the number of features is much greater than the number of samples.</p>
<p>As such, feature selection is not an optimal tool for determining feature importance.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Feature selection vs feature importance:</strong></p>
<ul>
<li>Multiple sets of features may perform similarly</li>
<li>Especially likely if there are many more features than samples (<code>p &gt;&gt; n</code>)</li>
<li>Thus, feature selection does not necessarily determine feature importance</li>
</ul>
</div>
</div>
</div>
</section>
<section id="qa-is-it-okay-for-feature-selection-to-remove-one-hot-encoded-categories" class="level2" data-number="13.9">
<h2 data-number="13.9" class="anchored" data-anchor-id="qa-is-it-okay-for-feature-selection-to-remove-one-hot-encoded-categories"><span class="header-section-number">13.9</span> Q&amp;A: Is it okay for feature selection to remove one-hot encoded categories?</h2>
<p>The feature selection process examines each feature independently, which means that it does not know that there are groups of feature columns that originated from the same feature. As a result, feature selection might remove some of the columns that resulted from one-hot encoding a column, and keep others.</p>
<p>However, I don’t see this as necessarily being problematic. Each one-hot encoded column can be thought of as independent from all others, since it merely represents the presence or absence of a particular value for a categorical column. If the presence or absence of “Embarked from C” has a relationship with the target but the presence or absence of “Embarked from Q” does not, then I would agree with one of those columns being removed while the other remains.</p>
<p>This is similar to how I think of the features output by <code>CountVectorizer</code>: Some text features have a relationship with the target and should be kept, while others do not have a relationship with the target and should be removed.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Feature selection of one-hot encoded categories:</strong></p>
<ul>
<li>Feature selection examines each feature column independently (regardless of its “origin”)</li>
<li>Each one-hot encoded column is conceptually independent from the others</li>
<li>Thus, it’s acceptable for feature selection to ignore the origin of each column when removing features</li>
</ul>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mlbook\.dataschool\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ch12.html" class="pagination-link" aria-label="Ensembling multiple models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Ensembling multiple models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ch14.html" class="pagination-link" aria-label="Feature standardization">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Feature standardization</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Kevin Markham. All Rights Reserved.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>